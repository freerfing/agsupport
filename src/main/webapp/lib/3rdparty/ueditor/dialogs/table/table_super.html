<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>table</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" type="text/css" href="../../themes/default/ueditor.css"/>
    <script type="text/javascript" src="../internal.js"></script>
</head>
<body>
    <div id="table_set" style="float:left;">
        <table style="font-size:12px; border:1px dotted #ddd;width:100%">
            <tr>
                <td>表格宽度</td>
                <td><input type="text" id="width" onchange="editor.execCommand( 'settablestyle',getOpt );" /> px</td>
            </tr>
            <tr>
                <td>表格边框</td>
                <td>
                    <input id="border" type="text" onchange="editor.execCommand( 'settablestyle',getOpt );" style="width:43px;" /> px
                    颜色<input id="border-color" type="text"  onchange="alert(1)"  style="width:58px;"/><input type="button" value="取色" onclick="show(this);" >
                </td>
              </tr>
            <tr>
                <td>表格背景</td>
                <td><input id="background" type="text" onchange="editor.execCommand( 'settablestyle',getOpt );" /><input type="button" value="取色"  onclick="show(this);"></td>
            </tr>
            <tr>
                <td>单元格边框</td>
                <td>
                    <select name="border_collapse" id="border_collapse" onchange="editor.execCommand( 'settablestyle',getOpt );">
                        <option value="collapse">合并</option>
                        <option value="separate">分离</option>
                    </select>
                    间距<input id="border_spacing" type="text" onchange="editor.execCommand( 'settablestyle',getOpt )" style="width:66px"/> px
                </td>
            </tr>
            <tr>
                <td>表格标题</td>
                <td><input id="table_title" type="checkbox" onchange="editor.execCommand('addCaption',this.value)"/></td>
            </tr>
        </table>
        <!--<button id="setTableProperty" onclick="editor.execCommand( 'settablestyle',defaultOpt );showTableProperty(false);">全部还原</button><br/>-->
    </div>

    <script type="text/javascript">
        function g(id){
            return document.getElementById(id);
        }
        var colorpicker = new parent.baidu.editor.ui.Popup({
            content: new parent.baidu.editor.ui.ColorPicker({
                noColorText: '清除颜色'
            })
        });
        colorpicker.render();
        colorpicker.content._onTableClick = function(evt){
            var tgt = evt.target || evt.srcElement;
            var color = tgt.getAttribute('data-color');
            g('border-color').value = color;
            colorpicker.hide();
            
        };

        parent.baidu.editor.dom.domUtils.on(document, 'mousedown', function (evt){
            parent.baidu.editor.ui.Popup.postHide(evt.target || evt.srcElement);
        });
        function show(el){
            colorpicker.showAnchor(el);
        }

        


        //获得table
        var tmp = parent.editor.selection.getRange(),
            currentTable = parent.baidu.editor.dom.domUtils.findParentByTagName(tmp.endContainer, 'table', true);
        var dwidth = currentTable.offsetWidth,
            dbgcolor = currentTable.bgColor,
            dborder_collapse = currentTable.style.borderCollapse,
            dborder_spacing  = currentTable.cellSpacing,
            dborder = dwidth-currentTable.clientWidth,
            defaultOpt = {
                "border":(dborder || 1) +"px solid #000",
                "background":dbgcolor || "white",
                "border-collapse":dborder_collapse || "collapse",
                "border-spacing":(dborder_spacing || 0) +"px",
                "width":dwidth
            };

        function showTableProperty( table ){
            var width = table.offsetWidth,
                bgcolor = table.bgColor,
                border_collapse = table.style.borderCollapse,
                border_spacing  = table.cellSpacing ,
                border_color = table.style.borderColor,
                caption_checked = table.caption ? true:false;

            g('border').value = (width-table.clientWidth);
            g('border-color').value = border_color;
            g('background').value = bgcolor;
            g('width').value = width;
            var select = g('border_collapse');
            for(var i=0;i<select.options.length;i++){
                 if(select.options[i].value == border_collapse){
                     select.options[i].selected = true;
                     break;
                 }
             }
            g('border_spacing').value = border_spacing.replace("px","");
            g('table_title').checked = caption_checked;
        }
        showTableProperty(currentTable);

        function getOpt(){
            var border = (g('border').value || 1) + "px solid #000",
                background = g('background').value || "white",
                select = g("border_collapse"),
                collapse=select.options[select.selectedIndex].value ||"collapse",
                cellSpacing = (g('border_spacing').value ||0) + "px",
                width = g('width').value;
            return {
                "border":border,
                "background":background,
                "border-collapse":collapse,
                "border-spacing":cellSpacing,
                "width":width
            };
        }
        dialog.oncancel=function(){
            editor.execCommand('settablestyle',defaultOpt);

        }

    </script>

</body>
</html>
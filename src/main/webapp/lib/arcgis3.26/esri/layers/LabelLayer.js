// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.26/esri/copyright.txt for details.
//>>built
require({cache:{"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./support/expressionUtils ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),function(t,q,n,A,B,r,m,b,a,c,g,d,f,e,k,l,x,u,h,y,v){t=t(null,{declaredClass:"esri.PopupInfo",
_reExprField:/^\s*expression\//i,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(a,b){if(a){q.mixin(this,b);this.info=a;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var p=this._fieldLabels={},c=this._fieldsMap={};this.info.fieldInfos&&n.forEach(this.info.fieldInfos,function(a){var b=a.fieldName.toLowerCase(),w=this._isExpressionField(b)?this.getExpressionInfo(b):null;p[b]=w?w.title:a.label;
c[b]=a},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return A.fromJson(A.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(a){var p;n.some(this.info&&this.info.fieldInfos,function(b){b.fieldName===a&&(p=b);return!!p});return p},getExpressionInfo:function(a){if(this._isExpressionField(a)){a=a.replace(this._reExprField,"");a=a.toLowerCase();var p;n.some(this.info.expressionInfos,
function(b){b.name.toLowerCase()===a&&(p=b);return!!p});return p}},hasGeometryOperations:function(){return n.some(this.info.expressionInfos,function(a){return h.hasGeometryOperations(a.expression)})},getComponents:function(a){var p=this.info,b={};p.fieldInfos&&(p=n.filter(p.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<p.length&&(b.relatedInfo=this._getRelatedRecords({graphic:a,fieldsInfo:p}));this._needFullResolutionFeature(a)&&(b.fullResolutionFeature=
this._getFullResolutionFeature(a));return e(b).then(q.hitch(this,function(p){return this._getPopupValues(a,p.fullResolutionFeature)}))},getAttachments:function(a){var b=a.getSourceLayer();a=a.attributes;if(this.info.showAttachments&&b&&b.hasAttachments&&b.objectIdField&&(a=a&&a[b.objectIdField]))return b.queryAttachmentInfos(a)},_needFullResolutionFeature:function(a){return(a=a.getSourceLayer())?"esriGeometryPoint"!==a.geometryType&&"function"===typeof a.getMaxAllowableOffset&&0<a.getMaxAllowableOffset()&&
this.hasGeometryOperations():!1},_getFullResolutionFeature:function(a){var b=a.getSourceLayer(),p=b.objectIdField;a=(a=a.attributes)&&p&&a[p];if(null==a)return null;var c=new k;c.objectIds=[a];c.maxAllowableOffset=0;c.outFields=[p];return b.queryFeatures(c).then(function(a){return a.features&&a.features[0]})},_isExpressionField:function(a){return this._reExprField.test(a)},_compileExpressions:function(a){var b={};n.forEach(a,function(a){var c=a.returnType&&a.returnType.toLowerCase();b[a.name]=y.createAttributeCache({valueExpression:a.expression},
"number"!==c)});return b},_fetchAttributes:function(a,b){var p=q.clone(a.attributes)||{},f=b&&b.geometry,e=this._exprPrefix,g=this._exprCache;n.forEach(this.info.expressionInfos,function(b){var w=e+b.name;b=(b=g[b.name])?a._getDataValue(b.attributeInfo,b,h,null,f):null;"string"===typeof b&&(b=c.encode(b));p[w]=b});return p},_getPopupValues:function(a,b,c){var p=this.info,h=a.getSourceLayer(),f=this._fetchAttributes(a,b),w=q.clone(f);b=p.fieldInfos;var e="",d="",k,C,l,D,v,m=h&&h._getDateOpts&&h._getDateOpts().properties,
m=m&&m.slice(0),u={dateFormat:{properties:m,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(D in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(D)){var y=this._relatedInfo[D],x=this._relatedLayersInfo[D];y&&(n.forEach(y.relatedFeatures,function(a){for(v in a.attributes)if(a.attributes.hasOwnProperty(v)&&"esriRelCardinalityOneToOne"===x.relation.cardinality){var b=this._toRelatedFieldName([x.relation.id,v]);f[b]=w[b]=a.attributes[v]}},
this),n.forEach(y.relatedStatsFeatures,function(a){for(v in a.attributes)if(a.attributes.hasOwnProperty(v)){var b=this._toRelatedFieldName([x.relation.id,v]);f[b]=w[b]=a.attributes[v]}},this))}b&&n.forEach(b,function(a){C=a.fieldName;var b=this._getLayerFieldInfo(h,C);b&&(C=a.fieldName=b.name);w[C]=this._formatValue(w[C],C,u);m&&a.format&&a.format.dateFormat&&(a=n.indexOf(m,C),-1<a&&m.splice(a,1))},this);if(h){D=h.types;var r=(y=h.typeIdField)&&f[y];for(C in f)if(f.hasOwnProperty(C)&&-1===C.indexOf(this._relatedFieldPrefix)&&
(l=f[C],g.isDefined(l))){var B=this._getDomainName(h,a,D,r,C,l);g.isDefined(B)?w[C]=B:C===y&&(B=this._getTypeName(h,a,l),g.isDefined(B)&&(w[C]=B))}}p.title&&(e=this._processFieldsInLinks(this._fixTokens(p.title,h),f),e=q.trim(this._removeEmptyHref(g.substitute(w,e,u)||"")));if(c)return{title:e};p.description&&(d=this._processFieldsInLinks(this._fixTokens(p.description,h),f),d=q.trim(this._removeEmptyHref(g.substitute(w,d,u)||"")));b&&(k=[],n.forEach(b,function(a){(C=a.fieldName)&&a.visible&&k.push([this._fieldLabels[C.toLowerCase()]||
C,g.substitute(w,"${"+C+"}",u)||""])},this));var t,A;p.mediaInfos&&(t=[],n.forEach(p.mediaInfos,function(a){A=0;l=a.value;switch(a.type){case "image":var b=l.sourceURL,b=b&&q.trim(this._removeEmptyHref(g.substitute(f,this._fixTokens(b,h))));A=!!b;break;case "piechart":case "linechart":case "columnchart":case "barchart":var c,b=l.normalizeField;l.fields=n.map(l.fields,function(a){return(c=this._getLayerFieldInfo(h,a))?c.name:a},this);b&&(c=this._getLayerFieldInfo(h,b),l.normalizeField=c?c.name:b);
A=n.some(l.fields,function(a){return g.isDefined(f[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(A){a=q.clone(a);l=a.value;var b=a.title?this._processFieldsInLinks(this._fixTokens(a.title,h),f):"",p=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,h),f):"";a.title=b?q.trim(this._removeEmptyHref(g.substitute(w,b,u)||"")):"";a.caption=p?q.trim(this._removeEmptyHref(g.substitute(w,p,u)||"")):"";if("image"===a.type)l.sourceURL=g.substitute(f,
this._fixTokens(l.sourceURL,h)),l.linkURL&&(l.linkURL=q.trim(g.substitute(f,this._fixTokens(l.linkURL,h))||""));else{var e,d;n.forEach(l.fields,function(a,b){if(-1!==a.indexOf(this._relatedFieldPrefix))d=this._getRelatedChartInfos(a,l,f,u),d instanceof Array?l.fields=d:l.fields[b]=d;else{var w=f[a],w=void 0===w?null:w;e=f[l.normalizeField]||0;w&&e&&(w/=e);l.fields[b]={y:w,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(w,a,u,!!e)}}},this)}t.push(a)}},this));return{title:e,
description:d,hasDescription:!!p.description,fields:k&&k.length?k:null,mediaInfos:t&&t.length?t:null,formatted:w,editSummary:h&&h.getEditSummary?h.getEditSummary(a):""}},_getRelatedChartInfos:function(a,b,c,h){var f,p,w,e,d,k;f=[];k=this._fromRelatedFieldName(a);d=k[0];p=this._relatedInfo[d];d=this._relatedLayersInfo[d];p&&n.forEach(p.relatedFeatures,function(p){p=p.attributes;var d,C;for(C in p)if(p.hasOwnProperty(C)&&C===k[1]){d={};e=p[C];b.normalizeField&&(w=-1!==b.normalizeField.indexOf(this._relatedFieldPrefix)?
p[this._fromRelatedFieldName(b.normalizeField)[1]]:c[b.normalizeField]);e&&w&&(e/=w);if(b.tooltipField)if(-1!==b.tooltipField.indexOf(this._relatedFieldPrefix)){var l=this._fromRelatedFieldName(b.tooltipField)[1],D=g.isDefined(p[l])?this._formatValue(p[l],b.tooltipField,h,!!w):l;d.tooltip=D+":\x3cbr/\x3e"+this._formatValue(e,l,h,!!w)}else d.tooltip=(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(e,b.tooltipField,h,!!w);else d.tooltip=e;d.y=e;f.push(d)}},this);return"esriRelCardinalityOneToMany"===
d.relation.cardinality||"esriRelCardinalityManyToMany"===d.relation.cardinality?f:f[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",
shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",
longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_fixTokens:function(a,b){var c=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,p,h){a=c._getLayerFieldInfo(b,h);return"$"+(a?"{"+a.name+"}":p)})},_encodeAttributes:function(a){a=q.clone(a)||{};var b,c;for(b in a)(c=a[b])&&"string"===typeof c&&(c=encodeURIComponent(c).replace(/\'/g,
"\x26apos;"),a[b]=c);return a},_processFieldsInLinks:function(a,b){var c=this._encodeAttributes(b);b=q.hitch(this,this._addValuesToHref,b,c);a&&(a=a.replace(this._reHref,b).replace(this._reHrefApos,b));return a},_addValuesToHref:function(a,b,c,h){h=h&&q.trim(h);return c=g.substitute(h&&0===h.indexOf("${")?a:b,c)},_getLayerFieldInfo:function(a,b){return a&&a.getField?a.getField(b):null},_formatValue:function(a,b,c,h){var f=this._fieldsMap[b.toLowerCase()],e=f&&f.format;b=-1!==n.indexOf(c.dateFormat.properties,
b);var w="number"===typeof a&&!b&&(!e||!e.dateFormat);if(!g.isDefined(a)||!f||!g.isDefined(e))return w?this._forceLTR(a):a;var p="",f=[],d=e.hasOwnProperty("places")||e.hasOwnProperty("digitSeparator"),k=e.hasOwnProperty("digitSeparator")?e.digitSeparator:!0;if(d&&!b)p="NumberFormat",f.push("places: "+(g.isDefined(e.places)&&(!h||0<e.places)?Number(e.places):"Infinity")),f.length&&(p+="("+f.join(",")+")");else if(e.dateFormat)p="DateFormat"+this._insertOffset(this._dateFormats[e.dateFormat]||this._dateFormats.shortDateShortTime);
else return w?this._forceLTR(a):a;var l=this._applyFormatting(a,p,c);d&&-1<a.constructor.toString().indexOf("Array")&&(l="",n.forEach(a,q.hitch(this,function(a,b){b&&(l+=" ");l+=this._applyFormatting(a,p,c)})));d&&!k&&v.group&&(l=l.replace(new RegExp("\\"+v.group,"g"),""));b&&(l='\x3cspan class\x3d"esriDateValue"\x3e'+l+"\x3c/span\x3e");return w?this._forceLTR(l):l},_applyFormatting:function(a,b,c){return g.substitute({myKey:a},"${myKey:"+b+"}",c)||""},_forceLTR:function(a){var c=b("ie");return c&&
10>=c?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=g.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,b,c,h,f,e){return(a=a.getDomain&&a.getDomain(f,{feature:b}))&&a.codedValues?a.getName(e):null},_getTypeName:function(a,b,c){return(a=a.getType&&a.getType(b))&&a.name},_getRelatedRecords:function(a){var b=a.graphic,c;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=
this._getRelatedLayersInfo(a).then(q.hitch(this,function(a){for(c in a)a.hasOwnProperty(c)&&a[c]&&(this._relatedLayersInfo[c].relatedLayerInfo=a[c])})));return this._relatedLayersInfoPromise.then(q.hitch(this,function(){return this._queryRelatedLayers(b)})).then(q.hitch(this,function(a){this._setRelatedRecords(b,a);return a}))},_getRelatedLayersInfo:function(b){var c=b.fieldsInfo,h,e,d={};h=b.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});n.forEach(c,function(a){var b,
c,e,f;b=this._fromRelatedFieldName(a.fieldName);c=b[0];b=b[1];c&&(!this._relatedLayersInfo[c]&&h&&h.relationships&&(n.some(h.relationships,function(a){if(a.id==c)return f=a,!0}),f&&(this._relatedLayersInfo[c]={relation:f,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[c]&&(this._relatedLayersInfo[c].relatedFields.push(b),a.statisticType&&(e=new u,e.statisticType=a.statisticType,e.onStatisticField=b,e.outStatisticFieldName=b,this._relatedLayersInfo[c].outStatistics.push(e))))},this);for(e in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(e)&&
this._relatedLayersInfo[e]&&(b=this._relatedLayersInfo[e].relation,b=h.url.replace(/[0-9]+$/,b.relatedTableId),this._relatedLayersInfo[e].relatedLayerUrl=b,d[e]=f({url:b,content:{f:"json"},callbackParamName:"callback"}));return a(d)},_queryRelatedLayers:function(b){var c={},h;for(h in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(h)&&(c[h]=this._queryRelatedLayer({graphic:b,relatedInfo:this._relatedLayersInfo[h]}));return a(c)},_queryRelatedLayer:function(b){var c,h,e,f,d,w,g,p,v,
u,y,x,r;c=b.graphic;h=c.getSourceLayer();e=h.url.match(/[0-9]+$/g)[0];y=b.relatedInfo;u=y.relatedLayerInfo;x=y.relatedLayerUrl;b=y.relation;n.some(u.relationships,function(a){if(a.relatedTableId===parseInt(e,10))return f=a,!0},this);f&&(d=new k,n.some(u.fields,function(a){if(a.name===f.keyField)return p=-1!==n.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),f.relationshipTableId&&f.keyFieldInRelationshipTable?
(r=new m,this._queryRelatedRecords(c,f).then(q.hitch(this,function(a){var b;(b=a[c.attributes[h.objectIdField]])?(a=n.map(b.features,function(a){return a.attributes[u.objectIdField]},this),y.outStatistics&&0<y.outStatistics.length&&u.supportsStatistics&&(v=new k,v.objectIds=a,v.outFields=d.outFields,v.outStatistics=y.outStatistics),v&&(w=new l(x),w.execute(v).then(q.hitch(this,function(a){var c=[];c.push(b);c.push(a);r.resolve(c)})))):r.resolve()}))):(g="string"===p?f.keyField+"\x3d'"+c.attributes[b.keyField]+
"'":f.keyField+"\x3d"+c.attributes[b.keyField],d.where=g,d.outFields=y.relatedFields,y.outStatistics&&0<y.outStatistics.length&&u.supportsStatistics&&(v=new k,v.where=d.where,v.outFields=d.outFields,v.outStatistics=y.outStatistics),w=new l(x),g=[],g.push(w.execute(d)),v&&g.push(w.execute(v))));return g?a(g):r?r.promise:void 0},_setRelatedRecords:function(a,b){this._relatedInfo=[];for(var c in b)b.hasOwnProperty(c)&&b[c]&&(a=b[c],this._relatedInfo[c]={},this._relatedInfo[c].relatedFeatures=a[0].features,
g.isDefined(a[1])&&(this._relatedInfo[c].relatedStatsFeatures=a[1].features))},_handlerErrorResponse:function(a,b){a.reject(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b},_queryRelatedRecords:function(a,b){var c=a.getSourceLayer(),h=new x;h.outFields=["*"];h.relationshipId=b.id;h.objectIds=[a.attributes[c.objectIdField]];
return c.queryRelatedFeatures(h)},_removeEmptyHref:function(a){return a.replace(/href=(""|'')/gi,"")}});r("extend-esri")&&(d.PopupInfo=d.PopupInfoTemplate=t);return t})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(t){var q=t.getObject("dojox.html.entities",!0),n=function(n,r){var m,b;if(r._encCache&&r._encCache.regexp&&r._encCache.mapper&&r.length==r._encCache.length)m=r._encCache.mapper,b=r._encCache.regexp;else{m={};b=["["];var a;for(a=0;a<r.length;a++)m[r[a][0]]="\x26"+
r[a][1]+";",b.push(r[a][0]);b.push("]");b=new RegExp(b.join(""),"g");r._encCache={mapper:m,regexp:b,length:r.length}}return n=n.replace(b,function(a){return m[a]})},A=function(n,r){var m,b;if(r._decCache&&r._decCache.regexp&&r._decCache.mapper&&r.length==r._decCache.length)m=r._decCache.mapper,b=r._decCache.regexp;else{m={};b=["("];var a;for(a=0;a<r.length;a++){var c="\x26"+r[a][1]+";";a&&b.push("|");m[c]=r[a][0];b.push(c)}b.push(")");b=new RegExp(b.join(""),"g");r._decCache={mapper:m,regexp:b,length:r.length}}return n=
n.replace(b,function(a){return m[a]})};q.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];q.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4",
"acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce",
"Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],
["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393",
"Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],
["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044",
"frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],
["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309",
"rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019",
"rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];q.encode=function(t,r){t&&(r?t=n(t,r):(t=n(t,q.html),t=n(t,q.latin)));return t};q.decode=function(n,r){n&&(r?n=A(n,r):(n=A(n,q.html),n=A(n,q.latin)));return n};return q})},"esri/promiseList":function(){define(["dojo/_base/array","dojo/Deferred","dojo/when"],function(t,q,n){var A=t.forEach;return function(t){function r(b,
c){a[c]=b;d.progress([b,c]);0===--f&&d.resolve(a)}var m,b;t instanceof Array?b=t:t&&"object"===typeof t&&(m=t);var a,c=[];if(m){b=[];for(var g in m)Object.hasOwnProperty.call(m,g)&&(c.push(g),b.push(m[g]));a={}}else b&&(a=[]);if(!b||!b.length)return(new q).resolve(a);var d=new q;d.promise.always(function(){a=c=null});var f=b.length;A(b,function(a,b){m||c.push(b);n(a,function(a){d.isFulfilled()||r(a,c[b])},function(a){d.isFulfilled()||r(a,c[b])})});return d.promise}})},"esri/tasks/QueryTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/DeferredList ../kernel ../sniff ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),
function(t,q,n,A,B,r,m,b,a,c,g,d,f,e,k){var l=a("esri-pbf"),x=q(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(a){this._handleSuccess=n.hitch(this,this._handleSuccess);this._handleError=n.hitch(this,this._handleError);n.mixin(this,a);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var a=new B(this._canceler);this._fetchDfd=a;this._result=null;this._sendRequest();
return a.promise},_canceler:function(a){var b=a._pendingRequest,c;a.isFulfilled()||!b||b.isFulfilled()||(b.cancel(),c=b.results&&b.results[1]);a._pendingRequest=null;return c},_sendRequest:function(a){var b=this.query;this.pagination&&(this._startPage=b.resultOffset=null==a?0:a,b.resultRecordCount=this.pageSize);a=this.requestOptions;this._fetchDfd._pendingRequest=c({url:this.url,content:b,handleAs:"pbf"===b.f?"arraybuffer":"json",callbackParamName:"callback",timeout:a&&a.timeout},a);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},
_handleSuccess:function(a){this.pagination?(a.exceededTransferLimit&&this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=this._result.features.concat(a.features):this._result=a,this._fetchDfd.progress(a),a.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(a),this._fetchDfd.resolve(a))},_handleError:function(a){this._fetchDfd.reject(a)}}),u=q(e,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],
"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(a,b){this._handler=n.hitch(this,this._handler);this._relationshipQueryHandler=n.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=n.hitch(this,this._executeForIdsHandler);this._countHandler=n.hitch(this,this._countHandler);this._extentHandler=n.hitch(this,this._extentHandler);this.source=b&&b.source;this.gdbVersion=b&&b.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",
c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(a,b,f,e,d){var h=
d.assembly;a=this._encode(n.mixin({},this._url.query,{f:e&&e.format||"json"},a.toJson(h&&h[0])));var g=this._handler,k=this._errorHandler;this.source&&(e={source:this.source.toJson()},a.layer=r.toJson(e));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);var p="pbf"===a.f;if(p){var w;l||(w="QueryTask.execute: 'pbf' format is not supported in your browser.");if(w)return a=new B,a.addErrback(function(a){k(a,f,d.dfd)}),a.reject(Error(w)),a}w=this.requestOptions;w=c({url:this._url.path+"/query",content:a,
callbackParamName:"callback",handleAs:p?"arraybuffer":"json",timeout:w&&w.timeout},w);a=[w];p&&a.push(u.loadPBFReader());(new m(a)).then(function(a){d.dfd.isFulfilled()||(a=a[0],a[0]?g(a[1],p,b,f,d.dfd):k(a[1],f,d.dfd))});return w},rawExecute:function(a,b,c){b=b||{};a=this._encode(n.mixin({},this._url.query,{f:b.format||"json"},a.toJson(c.assembly&&c.assembly[0])));this.source&&(a.layer=r.toJson({source:this.source.toJson()}));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return(new x({url:this._url.path+
"/query",query:a,requestOptions:this.requestOptions,pagination:b.pagination,pageSize:b.pageSize})).execute().then(null,null,function(a){c.dfd.progress(a)}).then(n.hitch(this,function(a){this._successHandler([a],"onRawExecuteComplete",null,c.dfd)})).otherwise(n.hitch(this,function(a){this._errorHandler(a,null,c.dfd)}))},executeRelationshipQuery:function(a,b,f){a=this._encode(n.mixin({},this._url.query,{f:"json"},a.toJson()));var e=this._relationshipQueryHandler,d=this._errorHandler;this.gdbVersion&&
(a.gdbVersion=this.gdbVersion);var h=new B(g._dfdCanceller),k=this.requestOptions;h._pendingDfd=c({url:this._url.path+"/queryRelatedRecords",content:a,callbackParamName:"callback",timeout:k&&k.timeout,load:function(a,c){e(a,c,b,f,h)},error:function(a){d(a,f,h)}},k);return h},executeForIds:function(a,b,f,e){var d=e.assembly;a=this._encode(n.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},a.toJson(d&&d[0])));var h=this._executeForIdsHandler,g=this._errorHandler;this.source&&(d={source:this.source.toJson()},
a.layer=r.toJson(d));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);d=this.requestOptions;return c({url:this._url.path+"/query",content:a,callbackParamName:"callback",timeout:d&&d.timeout,load:function(a,c){h(a,c,b,f,e.dfd)},error:function(a){g(a,f,e.dfd)}},d)},executeForCount:function(a,b,f,e){var d=e.assembly;a=this._encode(n.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJson(d&&d[0])));var h=this._countHandler,g=this._errorHandler;this.source&&(d={source:this.source.toJson()},
a.layer=r.toJson(d));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);d=this.requestOptions;return c({url:this._url.path+"/query",content:a,callbackParamName:"callback",timeout:d&&d.timeout,load:function(a,c){h(a,c,b,f,e.dfd)},error:function(a){g(a,f,e.dfd)}},d)},executeForExtent:function(a,b,f,e){var d=e.assembly;a=this._encode(n.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},a.toJson(d&&d[0])));var h=this._extentHandler,g=this._errorHandler;this.source&&(d={source:this.source.toJson()},
a.layer=r.toJson(d));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);d=this.requestOptions;return c({url:this._url.path+"/query",content:a,callbackParamName:"callback",timeout:d&&d.timeout,load:function(a,c){h(a,c,b,f,e.dfd)},error:function(a){g(a,f,e.dfd)}},d)},_handler:function(a,b,c,f,e){try{a&&b&&(a=u.pbfDeps.optimizedFeatures.convertToFeatureSet(u.pbfDeps.pbfQueryUtils.parsePBFFeatureQuery(a)));var d=new k(a);this._successHandler([d],"onComplete",c,e)}catch(F){this._errorHandler(F,f,e)}},_relationshipQueryHandler:function(a,
b,c,f,e){try{var d=a.geometryType,h=a.spatialReference,g={};A.forEach(a.relatedRecordGroups,function(a){var b={};b.geometryType=d;b.spatialReference=h;b.features=a.relatedRecords;b=new k(b);if(null!=a.objectId)g[a.objectId]=b;else for(var c in a)a.hasOwnProperty(c)&&"relatedRecords"!==c&&(g[a[c]]=b)});this._successHandler([g],"onExecuteRelationshipQueryComplete",c,e)}catch(z){this._errorHandler(z,f,e)}},_executeForIdsHandler:function(a,b,c,f,e){try{this._successHandler([a.objectIds],"onExecuteForIdsComplete",
c,e)}catch(D){this._errorHandler(D,f,e)}},_countHandler:function(a,b,c,f,e){try{var d,g=a.features,h=a.objectIds;if(h)d=h.length;else{if(g)throw Error("Unable to perform query. Please check your parameters.");d=a.count}this._successHandler([d],"onExecuteForCountComplete",c,e)}catch(z){this._errorHandler(z,f,e)}},_extentHandler:function(a,b,c,f,e){try{a.extent&&(a.extent=new d(a.extent)),this._successHandler([a],"onExecuteForExtentComplete",c,e)}catch(D){this._errorHandler(D,f,e)}}});u.loadPBFReader=
function(){var a=new B;u.pbfDeps?a.resolve():t(["./support/pbfDeps"],function(b){u.pbfDeps=b;a.isFulfilled()||a.resolve()});return a.promise};f._createWrappers(u);a("extend-esri")&&n.setObject("tasks.QueryTask",u,b);return u})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(t,q,n){t.DeferredList=function(t,B,r,m,b){var a=[];q.call(this);var c=this;0!==t.length||B||this.resolve([0,[]]);var g=0;n.forEach(t,function(b,f){function e(b,e){a[f]=[b,e];
g++;g===t.length&&c.resolve(a)}b.then(function(a){B?c.resolve([f,a]):e(!0,a)},function(a){r?c.reject(a):e(!1,a);if(m)return null;throw a;})})};t.DeferredList.prototype=new q;t.DeferredList.prototype.gatherResults=function(q){q=new t.DeferredList(q,!1,!0,!1);q.addCallback(function(t){var r=[];n.forEach(t,function(m){r.push(m[1])});return r});return q};return t.DeferredList})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),
function(t,q,n,A,B,r,m,b){t=t(b,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(a,b){a&&q.isString(a)&&(this._url=m.urlToObject(this.url=a));b&&b.requestOptions&&(this.requestOptions=b.requestOptions);this.normalization=!0;this._errorHandler=q.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var a=this._url,b=/^http:/i;this.url&&(this.url=this.url.replace(b,"https:"));a&&a.path&&(a.path=a.path.replace(b,"https:"))},
_encode:function(a,b,g){var c,f,e={},k,l;for(k in a)if("declaredClass"!==k&&(c=a[k],f=typeof c,null!==c&&void 0!==c&&"function"!==f))if(q.isArray(c))for(e[k]=[],l=c.length,f=0;f<l;f++)e[k][f]=this._encode(c[f]);else"object"===f?c.toJson&&(f=c.toJson(g&&g[k]),"esri.tasks.FeatureSet"===c.declaredClass&&f.spatialReference&&(f.sr=f.spatialReference,delete f.spatialReference),e[k]=b?f:n.toJson(f)):e[k]=c;return e},_successHandler:function(a,b,g,d){b&&this[b].apply(this,a);g&&g.apply(null,a);d&&r._resDfd(d,
a)},_errorHandler:function(a,b,g){this.onError(a);b&&b(a);g&&g.errback(a)},setNormalization:function(a){this.normalization=a},onError:function(){}});A("extend-esri")&&(B.Task=t);return t})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(t,q,n,A,B,r,m,b,a,c,g,d){t=t(null,{declaredClass:"esri.tasks.FeatureSet",
constructor:function(a,c){if(a){q.mixin(this,a);var e=this.features=this.features||[],f=a.spatialReference,f=this.spatialReference=g.createInstance(b.simpleConstructor,f),x=g.getGeometryType(a.geometryType);this.geometryType=a.geometryType;a.fields&&(this.fields=a.fields);a=g.supportsLazyUnquantization(this.geometryType);var u=g.unquantizeFunction(this.geometryType,this.transform),h=!!(c&&a&&u),y=x&&(h?x.accessorConstructor:x.simpleConstructor);n.forEach(e,function(a,c){var k=g.createInstance(m.simpleConstructor),
l=a.geometry;if(x&&l){var p=k.geometry=g.createInstance(y,h?null:l);p.setSpatialReference(l.spatialReference?g.createInstance(b.simpleConstructor,l.spatialReference):f);h&&p.setupLazyUnquantization(u,l)}k.symbol=a.symbol?d.fromJson(a.symbol):null;k.attributes=a.attributes;e[c]=k});h||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(b){var c={};this.displayFieldName&&(c.displayFieldName=this.displayFieldName);this.fields&&
(c.fields=this.fields);this.spatialReference?c.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(c.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(c.geometryType=g.getJsonType(this.features[0].geometry)),c.features=a._encodeGraphics(this.features,b));c.geometryType=c.geometryType||this.geometryType;c.exceededTransferLimit=this.exceededTransferLimit;c.transform=this.transform;return r.fixJson(c)},
_hydrate:function(){g.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(a){if(!this.geometryType)return this.transform=null,this;var b=a.translate[0],c=a.translate[1],f=a.scale[0],d=a.scale[1],g=this.features,h=function(a,b,c){var e,f,d,g,h,k,l=[];e=0;for(f=a.length;e<f;e++)if(d=a[e],0<e){if(k=b(d[0]),d=c(d[1]),k!==g||d!==h)l.push([k-g,d-h]),g=k,h=d}else g=b(d[0]),h=c(d[1]),l.push([g,h]);return 0<l.length?l:null},m=function(a,b,c){if("esriGeometryPoint"===
a)return function(a){a.x=b(a.x);a.y=c(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var e,f,d,g,k;d=a.rings||a.paths;k=[];e=0;for(f=d.length;e<f;e++)g=d[e],(g=h(g,b,c))&&k.push(g);return 0<k.length?(a.rings?a.rings=k:a.paths=k,a):null};if("esriGeometryMultipoint"===a)return function(a){var e;e=h(a.points,b,c);return 0<e.length?(a.points=e,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-
b)/f)},function(a){return Math.round((c-a)/d)}),v,p;v=0;for(p=g.length;v<p;v++)g[v].geometry&&(m(g[v].geometry)||g[v].setGeometry(null));this.transform=a;return this}});t.createGraphics=function(a){var c=a.geometryType,f=g.createInstance(b.simpleConstructor,a.spatialReference),d=g.getGeometryType(c).accessorConstructor,x=g.unquantizeFunction(c,a.transform);return n.map(a.features,function(a,b){b=g.createInstance(m.simpleConstructor);var c=a.geometry;if(c){var e=b.geometry=g.createInstance(d);e.setSpatialReference(f);
e.setupLazyUnquantization(x,c)}b.attributes=a.attributes;return b})};t.createPolygon=function(a,b,d){var e;a&&(e=g.createInstance(c.accessorConstructor),e.setSpatialReference(b),b=g.unquantizeFunction("esriGeometryPolygon",d),e.setupLazyUnquantization(b,a));return e};A("extend-esri")&&q.setObject("tasks.FeatureSet",t,B);return t})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(t,q,n,A,B){t=t(null,{declaredClass:"esri.tasks.RelationshipQuery",
definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,orderByFields:null,toJson:function(){var r={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},m=this.objectIds,b=this.outFields,a=this.outSpatialReference,c=this.orderByFields;m&&(r.objectIds=m.join(","));b&&(r.outFields=b.join(","));
a&&(r.outSR=a.wkid||n.toJson(a.toJson()));c&&(r.orderByFields=c.join(","));r._ts=this._ts;return r}});A("extend-esri")&&q.setObject("tasks.RelationshipQuery",t,B);return t})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(t,q,n,A){t=t(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,
maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});n("extend-esri")&&q.setObject("tasks.StatisticDefinition",t,A);return t})},"esri/core/timerUtils":function(){define([],function(){function t(n){var m,b=n.length;for(m=0;m<b;m++)n[m]()}var q={LOW:1,HIGH:2},n,A={};A[q.LOW]=[];A[q.HIGH]=[];var B=function(){clearTimeout(n);n=null;var r=A[q.HIGH];A[q.HIGH]=[];t(r);r=A[q.LOW];A[q.LOW]=[];t(r)};return{priority:q,callbackQueue:A,setTimeout:function(r,
m){r=[m,A[m].push(r)-1];n||(n=setTimeout(B,0));return r},clearTimeout:function(n){n&&A[n[0]].splice(n[1],1)}}})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),function(t,q,n,A,B,r){t=t(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=
this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(m,b){this._labelLayer=b;this._xmin=m.extent.xmin;this._xmax=m.extent.xmax;this._ymin=m.extent.ymin;this._ymax=m.extent.ymax;this._scale=(this._xmax-this._xmin)/m.width},_process:function(m){this._preparedLabels=m;this._placedLabels=[];var b;for(m=this._preparedLabels.length-1;0<=m;m--){var a=this._preparedLabels[m],c=Math.min(a.labelWidth,a.labelHeight),g=a.labelWidth+0*c,c=a.labelHeight+0*c,d=(b=a.options)&&void 0!==
b.lineLabelPlacement?b.lineLabelPlacement:"PlaceAtCenter",f=b&&void 0!==b.lineLabelPosition?b.lineLabelPosition:"Above",e=b&&void 0!==b.pointPriorities?b.pointPriorities:"AboveRight",k=[2,2,1,3,0,2,3,3,2];"AboveLeft"==e?k=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==e?k=[2,1,2,2,0,2,3,3,3]:"AboveRight"==e?k=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==e?k=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==e?k=[0,0,0,0,1,0,0,0,0]:"CenterRight"==e?k=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==e?k=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==e?k=[3,3,3,2,
0,2,2,1,2]:"BelowRight"==e&&(k=[3,3,2,3,0,2,2,2,1]);var l=b&&void 0!==b.labelRotation?b.labelRotation:!0,e=Math.PI/180*a.angle;b=b&&void 0!==b.howManyLabels?b.howManyLabels:"OneLabel";if("point"==a.geometry.type)this._generatePointPositions(a,a.geometry.x,a.geometry.y,a.text,e,g,c,a.symbolWidth,a.symbolHeight,k);else if("multipoint"==a.geometry.type)for(d=a.geometry,f=0;f<d.points.length;f++)this._generatePointPositions(a,d.points[f][0],d.points[f][1],a.text,e,g,c,a.symbolWidth,a.symbolHeight,k);
else"polyline"==a.geometry.type?this._generateLinePositions(a,a.geometry,a.text,g,c,2*a.symbolHeight+c,d,f,l):"polygon"==a.geometry.type&&this._generatePolygonPositions(a,b,a.geometry,a.text,e,g,c)}return this._placedLabels},_generatePointPositions:function(m,b,a,c,g,d,f,e,k,l){e=(e+d)*this._scale;k=(k+f)*this._scale;var x,u;for(x=1;3>=x;x++)for(u=1;9>=u;u++)if(l[u-1]==x)switch(u){case 1:if(this._findPlace(m,c,b-e,a+k,g,d,f))return;break;case 2:if(this._findPlace(m,c,b,a+k,g,d,f))return;break;case 3:if(this._findPlace(m,
c,b+e,a+k,g,d,f))return;break;case 4:if(this._findPlace(m,c,b-e,a,g,d,f))return;break;case 5:if(this._findPlace(m,c,b,a,g,d,f))return;break;case 6:if(this._findPlace(m,c,b+e,a,g,d,f))return;break;case 7:if(this._findPlace(m,c,b-e,a-k,g,d,f))return;break;case 8:if(this._findPlace(m,c,b,a-k,g,d,f))return;break;case 9:if(this._findPlace(m,c,b+e,a-k,g,d,f))return}},_generateLinePositions:function(m,b,a,c,g,d,f,e,k){var l=c*this._scale*c*this._scale,x,u,h;for(x=0;x<b.paths.length;x++){var y=b.paths[x],
v=y.length,p=Math.floor((v-1)/2),n=0!==(v-1)%2?1:-1;"PlaceAtStart"==f&&(p=0,n=1);"PlaceAtEnd"==f&&(p=v-2,n=-1);for(;0<=p&&p<v-1;){for(u=p;u<v;u++){var r=y[p][0],t=y[p][1],q=y[u][0]-r,z=y[u][1]-t;if(q*q+z*z>l){for(var w=Math.atan2(z,q);w>Math.PI/2;)w-=Math.PI;for(;w<-(Math.PI/2);)w+=Math.PI;var E=Math.sin(w),G=Math.cos(w),I=0,J=0;"Above"==e&&(I=d*E*this._scale,J=d*G*this._scale);"Below"==e&&(I=-d*E*this._scale,J=-d*G*this._scale);if(1==u-p){if(this._clipLine(r,t,y[u][0],y[u][1])&&(r=this._x1-this._x0,
h=this._y1-this._y0,r*r+h*h>l&&(u=Math.atan2(h,r),q=c/2+2*g,t=q*this._scale*Math.cos(u),q=q*this._scale*Math.sin(u),"PlaceAtStart"==f?(r=this._x0+t,h=this._y0+q):"PlaceAtEnd"==f?(r=this._x1-t,h=this._y1-q):(r=this._x0+r/2,h=this._y0+h/2),this._findPlace(m,a,r-I,h+J,k?-u:0,c,g))))return}else{var K=0;for(h=p;h<=u;h++)K=Math.max(K,Math.abs((y[h][1]-t)*G-(y[h][0]-r)*E));if(K<g&&this._findPlace(m,a,r+q/2-I,t+z/2+J,k?-w:0,c,g))return}break}}p+=n}}},_generatePolygonPositions:function(m,b,a,c,g,d,f){var e;
if("ManyLabels"==b)for(b=0;b<a.rings.length;b++)e=a.rings[b],r.prototype.isClockwise(e)&&(e=this._findCentroid(e,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(m,c,e[0],e[1],g,d,f));else{e=this._findCentroidForFeature(a,this._xmin,this._ymin,this._xmax,this._ymax);var k=e[1],l=0;for(b=0;10>b;b++){l+=f/4;e=this._findCentroidForFeature(a,this._xmin,k+(l-f/4),this._xmax,k+(l+f/4));if(this._findPlace(m,c,e[0],e[1],g,d,f))break;e=this._findCentroidForFeature(a,this._xmin,k-(l+f/4),this._xmax,
k-(l-f/4));if(this._findPlace(m,c,e[0],e[1],g,d,f))break}}},_findCentroid:function(m,b,a,c,g){var d=m.length,f=[0,0],e=0,k=m[0][0],l=m[0][1];k>c&&(k=c);k<b&&(k=b);l>g&&(l=g);l<a&&(l=a);for(var x=1;x<d-1;x++){var u=m[x][0],h=m[x][1],y=m[x+1][0],v=m[x+1][1];u>c&&(u=c);u<b&&(u=b);h>g&&(h=g);h<a&&(h=a);y>c&&(y=c);y<b&&(y=b);v>g&&(v=g);v<a&&(v=a);var p=(u-k)*(v-l)-(y-k)*(h-l);f[0]+=p*(k+u+y);f[1]+=p*(l+h+v);e+=p}f[0]/=3*e;f[1]/=3*e;if(isNaN(f[0])||isNaN(f[1]))return f;a=[];this._fillBuffer(m,a,f);f[0]=
this._sortBuffer(a,f[0],b,c);return f},_findCentroidForFeature:function(m,b,a,c,g){for(var d,f=0,e=[0,0],k=0;k<m.rings.length;k++){var l=m.rings[k],x=l.length,u=l[0][0],h=l[0][1];u>c&&(u=c);u<b&&(u=b);h>g&&(h=g);h<a&&(h=a);for(d=1;d<x-1;d++){var y=l[d][0],v=l[d][1],p=l[d+1][0],n=l[d+1][1];y>c&&(y=c);y<b&&(y=b);v>g&&(v=g);v<a&&(v=a);p>c&&(p=c);p<b&&(p=b);n>g&&(n=g);n<a&&(n=a);var r=(y-u)*(n-h)-(p-u)*(v-h);e[0]+=r*(u+y+p);e[1]+=r*(h+v+n);f+=r}}e[0]/=3*f;e[1]/=3*f;if(isNaN(e[0])||isNaN(e[1]))return e;
a=[];for(d=0;d<m.rings.length;d++)this._fillBuffer(m.rings[d],a,e);e[0]=this._sortBuffer(a,e[0],b,c);return e},_fillBuffer:function(m,b,a){for(var c=m.length-1,g=m[0][1]>=m[c][1]?1:-1,d=0;d<=c;d++){var f=d,e=d+1;d==c&&(e=0);var k=m[f][0],f=m[f][1],l=m[e][0],e=m[e][1],n=e>=f?1:-1;if(f<=a[1]&&a[1]<=e||e<=a[1]&&a[1]<=f)a[1]!=f&&a[1]!=e?(b.push((a[1]-f)*(l-k)/(e-f)+k),g=n):a[1]==f&&a[1]!=e?(g!=n&&b.push(k),g=n):a[1]!=f&&a[1]==e?(b.push(l),g=n):a[1]==f&&a[1]==e&&(1==g&&b.push(k),b.push(l),g=n)}},_sortBuffer:function(m,
b,a,c){var g=m.length;m.sort();if(0<g){for(var d=0,f=b=0;f<g-1;f+=2){var e=Math.abs(m[f+1]-m[f]);!(m[f]<=a&&m[f+1]<=a||m[f]>=c&&m[f+1]>=c)&&e>d&&(d=e,b=f)}g=m[b];m=m[b+1];g>c&&(g=c);g<a&&(g=a);m>c&&(m=c);m<a&&(m=a);b=(g+m)/2}return b},_findPlace:function(m,b,a,c,g,d,f){if(isNaN(a)||isNaN(c))return!1;for(var e=0;e<this._placedLabels.length;e++){var k=this._placedLabels[e].angle,l=this._placedLabels[e].width*this._scale,n=this._placedLabels[e].height*this._scale,u=this._placedLabels[e].x-a,h=this._placedLabels[e].y-
c;if(0===g&&0===k){if(this._findPlace2(-d*this._scale,-f*this._scale,d*this._scale,f*this._scale,u-l,h-n,u+l,h+n))return!1}else{var y=new B(-d*this._scale,-f*this._scale,d*this._scale,f*this._scale,null),v=0,p=1;0!==g&&(v=Math.sin(g),p=Math.cos(g));var t=u*p-h*v,u=u*v+h*p,k=k-g,v=Math.sin(k),p=Math.cos(k),q=-l*p- -n*v,h=-l*v+-n*p,k=+l*p- -n*v,F=+l*v+-n*p,l=t+q,n=u-h,v=t+k,p=u-F,q=t-q,h=u+h,t=t-k,u=u+F,k=new r;k.addRing([[l,n],[v,p],[q,h],[t,u],[l,n]]);if(y.intersects(k))return!1}}for(;g>Math.PI/2;)g-=
Math.PI;for(;g<-(Math.PI/2);)g+=Math.PI;e={};e.layer=m;e.text=b;e.angle=g;e.x=a;e.y=c;e.width=d;e.height=f;this._placedLabels.push(e);return!0},_findPlace2:function(m,b,a,c,g,d,f,e){return(m>=g&&m<=f||a>=g&&a<=f||m<=g&&a>=f)&&(b>=d&&b<=e||c>=d&&c<=e||b<=d&&c>=e)?!0:!1},_clipLine:function(m,b,a,c){for(var g=this._code(m,b),d=this._code(a,c);0!==g||0!==d;){if(0!==(g&d))return!1;var f=a-m,e=c-b;0!==g?(m<this._xmin?(b+=e*(this._xmin-m)/f,m=this._xmin):m>this._xmax?(b+=e*(this._xmax-m)/f,m=this._xmax):
b<this._ymin?(m+=f*(this._ymin-b)/e,b=this._ymin):b>this._ymax&&(m+=f*(this._ymax-b)/e,b=this._ymax),g=this._code(m,b)):(a<this._xmin?(c+=e*(this._xmin-a)/f,a=this._xmin):a>this._xmax?(c+=e*(this._xmax-a)/f,a=this._xmax):c<this._ymin?(a+=f*(this._ymin-c)/e,c=this._ymin):c>this._ymax&&(a+=f*(this._ymax-c)/e,c=this._ymax),d=this._code(a,c))}this._x0=m;this._y0=b;this._x1=a;this._y1=c;return!0},_code:function(m,b){var a=0;m<this._xmin&&(a+=8);m>this._xmax&&(a+=4);b<this._ymin&&(a+=2);b>this._ymax&&(a+=
1);return a}});n("extend-esri")&&q.setObject("layers.labelLayerUtils.DynamicLabelClass",t,A);return t})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(t,q,n,A,B,r,m){return t(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=
this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(b,a){this._labelLayer=a;this._map=b;this._xmin=b.extent.xmin;this._xmax=b.extent.xmax;this._ymin=b.extent.ymin;this._ymax=b.extent.ymax;this._scale=(this._xmax-this._xmin)/b.width},_process:function(b){var a,c,g,d,f,e,k,l,n;this._preparedLabels=b;this._placedLabels=[];for(b=this._preparedLabels.length-1;0<=b;b--){a=this._preparedLabels[b];f=a.labelWidth;
e=a.labelHeight;l=(k=a.options)&&k.lineLabelPlacement?k.lineLabelPlacement:"PlaceAtCenter";n=k&&k.lineLabelPosition?k.lineLabelPosition:"Above";c=k&&k.labelRotation?k.labelRotation:!0;g=Math.PI/180*a.angle;d=k&&k.howManyLabels?k.howManyLabels:"OneLabel";var u=[];if("point"===a.geometry.type)this._generatePointPositions(a.geometry.x,a.geometry.y,a.text,g,f,e,a.symbolWidth,a.symbolHeight,k,u);else if("multipoint"===a.geometry.type)for(c=0;c<a.geometry.points.length;c++)this._generatePointPositions(a.geometry.points[c][0],
a.geometry.points[c][1],a.text,g,f,e,a.symbolWidth,a.symbolHeight,k,u);else if("polyline"===a.geometry.type)if("PlaceAtStart"===l)this._generateLinePositionsPlaceAtStart(a.geometry,!0,a.text,f,e,2*a.symbolHeight+e,l,n,c,u);else if("PlaceAtEnd"===l)this._generateLinePositionsPlaceAtEnd(a.geometry,!0,a.text,f,e,2*a.symbolHeight+e,l,n,c,u);else{k=[];var h=a.geometry.getExtent(),y=this._map.extent;if(h.getWidth()<f*this._scale/this._OVERRUN&&h.getHeight()<f*this._scale/this._OVERRUN)continue;else.5*h.getWidth()<
y.getWidth()&&.5*h.getHeight()<y.getHeight()?this._generateLinePositionsPlaceAtCenter(a.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,a.text,f,e,2*a.symbolHeight+e,l,n,c,k):this._generateLinePositionsPlaceAtCenter(a.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,a.text,f,e,2*a.symbolHeight+e,l,n,c,k);this._postSorting(y,k,u)}else if("polygon"===a.geometry.type){l=[];for(c=0;c<a.geometry.rings.length;c++)n=a.geometry.rings[c],1<a.geometry.rings.length&&
!m.prototype.isClockwise(n)||(k=this._calcRingExtent(n),k.xmax-k.xmin<4*f*this._scale/this._OVERRUN&&k.ymax-k.ymin<4*e*this._scale/this._OVERRUN||l.push(n));l.sort(function(a,b){return b.length-a.length});for(c=0;c<l.length;c++)this._generatePolygonPositionsForManyLabels(l[c],a.geometry.spatialReference,a.text,g,f,e,u)}for(c=0;c<u.length&&(l=u[c].x,n=u[c].y,void 0!==u[c].angle&&(g=u[c].angle),k=this._findPlace(a,a.text,l,n,g,f,e),"OneLabel"!==d||!k||!this._labelLayer._isWithinScreenArea(new r(l,n,
a.geometry.spatialReference)));c++);}return this._placedLabels},_generatePointPositions:function(b,a,c,g,d,f,e,k,l,m){c=l&&l.pointPriorities?l.pointPriorities:"AboveRight";d=(e+d)*this._scale;f=(k+f)*this._scale;switch(c.toLowerCase()){case "aboveleft":b-=d;a+=f;break;case "abovecenter":a+=f;break;case "aboveright":b+=d;a+=f;break;case "centerleft":b-=d;break;case "centercenter":break;case "centerright":b+=d;break;case "belowleft":b-=d;a-=f;break;case "belowcenter":a-=f;break;case "belowright":b+=
d;a-=f;break;default:return}m.push({x:b,y:a})},_generateLinePositionsPlaceAtStart:function(b,a,c,g,d,f,e,k,l,m){e=g*this._scale;var n=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,h,y,v,p,r,t,q,x;for(h=0;h<b.paths.length;h++){var z=b.paths[h],w=e,E=0;for(y=0;y<z.length-1;y++)v=z[y][0],p=z[y][1],r=z[y+1][0],t=z[y+1][1],q=r-v,x=t-p,q=Math.sqrt(q*q+x*x),E+q>w?(E=this._generatePositionsOnLine(b.spatialReference,a,w,n,E,v,p,r,t,c,g,d,f,k,l,m),w=n):E+=q}},_generateLinePositionsPlaceAtEnd:function(b,
a,c,g,d,f,e,k,l,m){e=g*this._scale;var n=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,h,y,v,p,r,t,q,x;for(h=0;h<b.paths.length;h++){var z=b.paths[h],w=e,E=0;for(y=z.length-2;0<=y;y--)v=z[y+1][0],p=z[y+1][1],r=z[y][0],t=z[y][1],q=r-v,x=t-p,q=Math.sqrt(q*q+x*x),E+q>w?(E=this._generatePositionsOnLine(b.spatialReference,a,w,n,E,v,p,r,t,c,g,d,f,k,l,m),w=n):E+=q}},_generateLinePositionsPlaceAtCenter:function(b,a,c,g,d,f,e,k,l,m,n){var h,u,v,p,r,t,q,x;for(k=0;k<b.paths.length;k++){var z=
b.paths[k];if(!(2>z.length)){if(2==z.length){p=z[0];h=z[1];v=p[0];p=p[1];z=h[0];t=h[1];r=(z-v)*(z-v)+(t-p)*(t-p);q=Math.atan2(t-p,z-v);t=Math.cos(q);q=Math.sin(q);z=[];x=v;for(var w=p;(x-v)*(x-v)+(w-p)*(w-p)<r;)z.push([x,w]),x+=c/2*t,w+=c/2*q;z.push(h)}var E=0;for(h=0;h<z.length-1;h++)v=z[h][0],p=z[h][1],r=z[h+1][0],t=z[h+1][1],q=r-v,x=t-p,E+=Math.sqrt(q*q+x*x);for(h=w=0;h<z.length-1;h++){v=z[h][0];p=z[h][1];r=z[h+1][0];t=z[h+1][1];q=r-v;x=t-p;q=Math.sqrt(q*q+x*x);if(w+q>E/2)break;w+=q}h==z.length-
1&&h--;v=z[h][0];p=z[h][1];r=z[h+1][0];t=z[h+1][1];q=r-v;x=t-p;w=E/2-w;q=Math.atan2(x,q);x=v+w*Math.cos(q);q=p+w*Math.sin(q);v=this._angleAndShifts(v,p,r,t,e,l,m);n.push({x:x+v.shiftX,y:q+v.shiftY,angle:v.angle});var E=x,G=q,w=0;for(u=h;u<z.length-1;u++)u==h?(v=E,p=G):(v=z[u][0],p=z[u][1]),r=z[u+1][0],t=z[u+1][1],q=r-v,x=t-p,q=Math.sqrt(q*q+x*x),w=w+q>c?this._generatePositionsOnLine(b.spatialReference,a,c,c,w,v,p,r,t,g,d,f,e,l,m,n):w+q;w=0;for(u=h;0<=u;u--)u==h?(v=E,p=G):(v=z[u+1][0],p=z[u+1][1]),
r=z[u][0],t=z[u][1],q=r-v,x=t-p,q=Math.sqrt(q*q+x*x),w=w+q>c?this._generatePositionsOnLine(b.spatialReference,a,c,c,w,v,p,r,t,g,d,f,e,l,m,n):w+q}}},_generatePositionsOnLine:function(b,a,c,g,d,f,e,k,l,m,n,h,q,r,p,t){m=Math.atan2(l-e,k-f);n=f;h=e;var u=n,v=h;do if(d=c-d,n+=d*Math.cos(m),h+=d*Math.sin(m),this._belongs(n,h,f,e,k,l))d=this._angleAndShifts(f,e,k,l,q,r,p),c=n+d.shiftX,v=h+d.shiftY,a?this._labelLayer._isWithinScreenArea(new B(c,v,c,v,b))&&t.push({x:c,y:v,angle:d.angle}):t.push({x:c,y:v,angle:d.angle}),
u=n,v=h,d=0,c=g;else return b=k-u,l-=v,Math.sqrt(b*b+l*l);while(1)},_postSorting:function(b,a,c){if(b&&0<a.length){var g=.5*(b.xmin+b.xmax);b=.5*(b.ymin+b.ymax);for(var d=a[0].x,f=a[0].y,e=Math.sqrt((d-g)*(d-g)+(f-b)*(f-b)),k=a[0].angle,l=0;l<a.length;l++){var m=a[l].x,n=a[l].y,h=Math.sqrt((m-g)*(m-g)+(n-b)*(n-b));h<e&&(d=m,f=n,e=h,k=a[l].angle)}c.push({x:d,y:f,angle:k})}},_belongs:function(b,a,c,g,d,f){if(d==c&&f==g)return!1;if(d>c){if(b>d||b<c)return!1}else if(b<d||b>c)return!1;if(f>g){if(a>f||
a<g)return!1}else if(a<f||a>g)return!1;return!0},_angleAndShifts:function(b,a,c,g,d,f,e){for(b=Math.atan2(g-a,c-b);b>Math.PI/2;)b-=Math.PI;for(;b<-(Math.PI/2);)b+=Math.PI;g=Math.sin(b);var k=Math.cos(b);c=a=0;"Above"==f&&(a=d*g*this._scale,c=d*k*this._scale);"Below"==f&&(a=-d*g*this._scale,c=-d*k*this._scale);d=[];d.angle=e?-b:0;d.shiftX=-a;d.shiftY=c;return d},_generatePolygonPositionsForManyLabels:function(b,a,c,g,d,f,e){d=this._findCentroidForRing(b);g=d[0];var k=d[1],l=this._calcRingExtent(b);
d=l.xmin;f=l.ymin;var m=l.xmax,l=l.ymax,n=(l-f)/(this._map.height*this._scale);if(!(10<(m-d)/(this._map.width*this._scale)&&10<n)){var h=!0;if(m-d>this._map.width*this._scale||l-f>this._map.height*this._scale)h=!1;var n=this._map.width*this._scale*(h?.1875:.5),h=this._map.height*this._scale*(h?.1875:.5),q=!0,r=!0,p=0;do{k+=(p%2?-1:1)*p*h;if(this._scanRingByX(c,a,b,g,k,d,m,n,e))break;k<f&&(q=!1);k>l&&(r=!1);p++}while(q||r)}},_scanRingByX:function(b,a,c,g,d,f,e,k,l){var m=!0,n=!0,h=0,q=1E3;do{g+=(h%
2?-1:1)*h*k;var r=this._movePointInsideRing(c,g,d),p=this._labelLayer._isWithinScreenArea(new B(r,d,r,d,a)),t=this._isPointWithinRing(b,c,r,d);if(p&&t)return l.push({x:r,y:d}),!0;g<f&&(m=!1);g>e&&(n=!1);h++;q--;if(0>=q)return!0}while(m||n);return!1},_movePointInsideRing:function(b,a,c){for(var g=[],d=b.length-1,f=b[0][1]>=b[d][1]?1:-1,e=0;e<=d;e++){var k=e,l=e+1;e==d&&(l=0);var m=b[k][0],k=b[k][1],n=b[l][0],l=b[l][1],h=l>=k?1:-1;if(k<=c&&c<=l||l<=c&&c<=k)c!=k&&c!=l?(g.push((c-k)*(n-m)/(l-k)+m),f=
h):c==k&&c!=l?(f!=h&&g.push(m),f=h):c!=k&&c==l?(g.push(n),f=h):c==k&&c==l&&(1==f&&g.push(m),g.push(n),f=h)}g.sort(function(a,b){return a-b});b=g.length;if(0<b){for(e=c=a=0;e<b-1;e+=2)d=Math.abs(g[e+1]-g[e]),d>a&&(a=d,c=e);a=(g[c]+g[c+1])/2}return a},_calcRingExtent:function(b){var a,c;c=new B;for(a=0;a<b.length-1;a++){var g=b[a][0],d=b[a][1];if(void 0===c.xmin||g<c.xmin)c.xmin=g;if(void 0===c.ymin||d<c.ymin)c.ymin=d;if(void 0===c.xmax||g>c.xmax)c.xmax=g;if(void 0===c.ymax||d>c.ymax)c.ymax=d}return c},
_isPointWithinPolygon:function(b,a,c,g){var d;for(d=0;d<a.rings.length;d++)if(this._isPointWithinRing(b,a.rings[d],c,g))return!0;return!1},_isPointWithinRing:function(b,a,c,g){var d,f,e,k,l=[],m=a.length;for(b=0;b<m-1;b++)if(d=a[b][0],f=a[b][1],e=a[b+1][0],k=a[b+1][1],d!=e||f!=k){if(f==k)if(g==f)l.push(d);else continue;d==e?(f<k&&g>=f&&g<k&&l.push(d),f>k&&g<=f&&g>k&&l.push(d)):(f=(e-d)/(k-f)*(g-f)+d,d<e&&f>=d&&f<e&&l.push(f),d>e&&f<=d&&f>e&&l.push(f))}l.sort(function(a,b){return a-b});for(b=0;b<l.length-
1;b++)if(d=l[b],e=l[b+1],c>=d&&c<e)if(b%2)break;else return!0;return!1},_findCentroidForRing:function(b){for(var a=b.length,c=[0,0],g=0,d=b[0][0],f=b[0][1],e=1;e<a-1;e++){var k=b[e][0],l=b[e][1],m=b[e+1][0],n=b[e+1][1],h=(k-d)*(n-f)-(m-d)*(l-f);c[0]+=h*(d+k+m);c[1]+=h*(f+l+n);g+=h}c[0]/=3*g;c[1]/=3*g;return c},_findCentroidForFeature:function(b){for(var a=0,c=[0,0],g=0;g<b.rings.length;g++)for(var d=b.rings[g],f=d.length,e=d[0][0],k=d[0][1],l=1;l<f-1;l++){var m=d[l][0],n=d[l][1],h=d[l+1][0],q=d[l+
1][1],r=(m-e)*(q-k)-(h-e)*(n-k);c[0]+=r*(e+m+h);c[1]+=r*(k+n+q);a+=r}c[0]/=3*a;c[1]/=3*a;return c},_findPlace:function(b,a,c,g,d,f,e){if(isNaN(c)||isNaN(g))return!1;for(var k=0;k<this._placedLabels.length;k++){var l=this._placedLabels[k].angle,n=this._placedLabels[k].width*this._scale,q=this._placedLabels[k].height*this._scale,h=this._placedLabels[k].x-c,r=this._placedLabels[k].y-g;if(0===d&&0===l){if(this._findPlace2(-f*this._scale,-e*this._scale,f*this._scale,e*this._scale,h-n,r-q,h+n,r+q))return!1}else{var t=
new B(-f*this._scale,-e*this._scale,f*this._scale,e*this._scale,null),p=0,A=1;0!==d&&(p=Math.sin(d),A=Math.cos(d));var D=h*A-r*p,h=h*p+r*A,l=l-d,p=Math.sin(l),A=Math.cos(l),F=-n*A- -q*p,r=-n*p+-q*A,l=+n*A- -q*p,H=+n*p+-q*A,n=D+F,q=h-r,p=D+l,A=h-H,F=D-F,r=h+r,D=D-l,h=h+H,l=new m;l.addRing([[n,q],[p,A],[F,r],[D,h],[n,q]]);if(t.intersects(l))return!1}}for(;d>Math.PI/2;)d-=Math.PI;for(;d<-(Math.PI/2);)d+=Math.PI;k={};k.layer=b;k.text=a;k.angle=d;k.x=c;k.y=g;k.width=f;k.height=e;this._placedLabels.push(k);
return!0},_findPlace2:function(b,a,c,g,d,f,e,k){return(b>=d&&b<=e||c>=d&&c<=e||b<=d&&c>=e)&&(a>=f&&a<=k||g>=f&&g<=k||a<=f&&g>=k)?!0:!1}})})},"*noref":1}});
define("esri/layers/LabelLayer","require dojo/_base/declare dojo/_base/lang dojo/number dojo/i18n!dojo/cldr/nls/number dojo/_base/array dojo/_base/connect dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../core/timerUtils ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./support/attributeUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ./GraphicsLayer ./LabelClass ../renderers/SimpleRenderer ../support/expressionUtils".split(" "),function(t,
q,n,A,B,r,m,b,a,c,g,d,f,e,k,l,x,u,h,y,v,p,C,D,F,H){function z(a){return"sizeInfo"===a.type}t=q(C,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=n.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
n.hitch(this,"_handleLevelChange")));var b=this.inherited(arguments);this.refresh();return b},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)m.disconnect(this._mapEventHandlers[a]);this.refresh();e.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,c,e){if(!this.getFeatureLayer(a.layerId)){var d=[];d.push(a.on("update-end",
n.hitch(this,"refresh")));d.push(a.on("suspend",n.hitch(this,"refresh")));d.push(a.on("resume",n.hitch(this,"refresh")));d.push(a.on("edits-complete",n.hitch(this,"refresh")));d.push(a.on("labeling-info-change",n.hitch(this,"refresh")));d.push(a.on("time-extent-change",n.hitch(this,"refresh")));d.push(a.on("show-labels-change",n.hitch(this,"refresh")));d.push(a.on("feature-reduction-change",n.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:c,LabelingOptions:e,
LabelRenderer:b,EventHandlers:d});this.featureLayers.push(a);this.refresh()}},getFeatureLayer:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return c;return null},removeFeatureLayer:function(a){var b;a=this.getFeatureLayer(a);if(void 0!==a&&(b=r.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)m.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,
1);this.refresh()}},removeAllFeatureLayers:function(){var a;for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)m.disconnect(this._featureLayerInfos[a].EventHandlers[b]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return this._featureLayerInfos[b];
return null},refresh:function(){null==this._refreshHandle&&(this._refreshHandle=e.setTimeout(this._refreshLabels,e.priority.LOW))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var b,c,e,d,f,g=[],h,w="DYNAMIC"===this._engineType?new k:new l;if(this._map){w.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(c=this.featureLayers[a],c.visible&&c.showLabels&&c.visibleAtMapScale&&!c._suspended)if(b=
this._featureLayerInfos[a],f=this._convertOptions(null),b.LabelRenderer){if(g=c.labelingInfo)if(h=g[0])d=this._getLabelExpression(h),f=this._convertOptions(h);e=b.LabelRenderer;b.LabelExpressionInfo&&(d=b.LabelExpressionInfo);b.LabelingOptions&&(f=this._convertOptions(null),void 0!==b.LabelingOptions.pointPriorities&&(g=b.LabelingOptions.pointPriorities,f.pointPriorities="above-center"==g||"AboveCenter"==g||"esriServerPointLabelPlacementAboveCenter"==g?"AboveCenter":"above-left"==g||"AboveLeft"==
g||"esriServerPointLabelPlacementAboveLeft"==g?"AboveLeft":"above-right"==g||"AboveRight"==g||"esriServerPointLabelPlacementAboveRight"==g?"AboveRight":"below-center"==g||"BelowCenter"==g||"esriServerPointLabelPlacementBelowCenter"==g?"BelowCenter":"below-left"==g||"BelowLeft"==g||"esriServerPointLabelPlacementBelowLeft"==g?"BelowLeft":"below-right"==g||"BelowRight"==g||"esriServerPointLabelPlacementBelowRight"==g?"BelowRight":"center-center"==g||"CenterCenter"==g||"esriServerPointLabelPlacementCenterCenter"==
g?"CenterCenter":"center-left"==g||"CenterLeft"==g||"esriServerPointLabelPlacementCenterLeft"==g?"CenterLeft":"center-right"==g||"CenterRight"==g||"esriServerPointLabelPlacementCenterRight"==g?"CenterRight":"AboveRight"),void 0!==b.LabelingOptions.lineLabelPlacement&&(f.lineLabelPlacement=b.LabelingOptions.lineLabelPlacement),void 0!==b.LabelingOptions.lineLabelPosition&&(f.lineLabelPosition=b.LabelingOptions.lineLabelPosition),void 0!==b.LabelingOptions.labelRotation&&(f.labelRotation=b.LabelingOptions.labelRotation),
void 0!==b.LabelingOptions.howManyLabels&&(f.howManyLabels=b.LabelingOptions.howManyLabels));e instanceof D&&(d=this._getLabelExpression(e),e=new F(e.symbol),f=this._convertOptions(e));this._addLabels(c,e,d,f)}else if(g=c.labelingInfo)for(b=g.length-1;0<=b;b--)if(h=g[b])e=new D(h instanceof D?h.toJson():h),d=this._getLabelExpression(h),f=this._convertOptions(h),this._addLabels(c,e,d,f);d=w._process(this._preparedLabels);this.clear();this.drawLabels(this._map,d)}},drawLabels:function(a,b){this._scale=
(a.extent.xmax-a.extent.xmin)/a.width;var c;for(c=0;c<b.length;c++){var e=b[c],f=e.x,g=e.y,h=e.text,k=e.angle,l=e.layer.labelSymbol;"polyline"==e.layer.geometry.type&&e.layer.options.labelRotation&&l.setAngle(180/Math.PI*k);l.setText(h);e=f;l instanceof u&&(f=l.getHeight(),e-=.25*f*this._scale*Math.sin(k),g-=.33*f*this._scale);k=new d(new v(e,g,a.extent.spatialReference));k.setSymbol(l);this.add(k)}},_addLabels:function(a,b,c,e){var d,f,g,h;if(this._isWithinScaleRange(b.minScale,b.maxScale)&&c&&""!==
c){var k=this._map,l=!a.url&&!k.spatialReference.equals(a.spatialReference);for(d=0;d<a.graphics.length;d++)if(f=a.graphics[d],!1!==f.visible&&!f._suspended){g=f.geometry;if(l){if(!p.canProject(g,k))continue;g=p.project(g,k)}g&&this._isWhere(b.where,f.attributes)&&this._isWithinScreenArea(g)&&(h=this._buildLabelText(c,f,a.fields,e),this._addLabel(h,b,a.renderer,f,e,g,k))}}},_isWithinScreenArea:function(a){a="point"===a.type?new y(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();if(void 0===a)return!1;
a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var c=this._map.getScale();return 0<a&&c>=a||0<b&&c<b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var c=a.split(" ");if(3===c.length)return this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2]));if(7===c.length){var e=this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2])),d=c[3],f=this._sqlEquation(b[this._removeQuotes(c[4])],c[5],this._removeQuotes(c[6]));
switch(d){case "AND":return e&&f;case "OR":return e||f}}}return!1}catch(L){console.log("Error.: can't parse \x3d "+a)}},_sqlEquation:function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1},_removeQuotes:function(a){var b=a.indexOf('"'),c=a.lastIndexOf('"');if(-1!=b&&-1!=c)return a.substr(1,a.length-2);b=a.indexOf("'");c=a.lastIndexOf("'");
return-1!=b&&-1!=c?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||r.filter(a.visualVariables,z)[0]:null},_addLabel:function(b,c,e,f,d,g,k){var l,m,p,q;if(b&&""!==n.trim(b)&&c){b=b.replace(/\s+/g," ");l=c.getSymbol(f);l instanceof u?(l=new u(l.toJson()),l.setVerticalAlignment("baseline"),l.setHorizontalAlignment("center")):l=l instanceof h?new h(l.toJson()):new u;l.setText(b);c.symbol=l;if(p=this._getProportionalSize(c.sizeInfo,f.attributes))l instanceof u?l.setSize(p):l instanceof
h&&(l.setWidth(p),l.setHeight(p));q=p=0;if(e){m=e.getSymbol(f);var r=this._getSizeInfo(e);if((e=r?e.getSize(f,{sizeInfo:r,resolution:k.getResolutionInMeters()}):f.size)&&null!==e)p=q=e;else if(m)if("simplemarkersymbol"==m.type)q=p=m.size;else if("picturemarkersymbol"==m.type)p=m.width,q=m.height;else if("simplelinesymbol"==m.type||"cartographiclinesymbol"==m.type)p=m.width}e={};e.graphic=f;e.options=d;e.geometry=g;e.labelRenderer=c;e.labelSymbol=l;e.labelWidth=l.getWidth()/2;e.labelHeight=l.getHeight()/
2;e.symbolWidth=a.normalizedLength(p)/2;e.symbolHeight=a.normalizedLength(q)/2;e.text=b;e.angle=l.angle;this._preparedLabels.push(e)}},_buildLabelText:function(a,b,c,e){if(e.hasExpression)return a=e.arcadeCache,b=b._getDataValue(a.attributeInfo,a,H),g.isDefined(b)?""+b:"";var d=b.attributes;return a.replace(/{[^}]*}/g,function(a){var b,h=a;for(b=0;b<c.length;b++)if("{"+c[b].name+"}"==a){var h=d[c[b].name],k=c[b].domain;if(k&&n.isObject(k)){if("codedValue"==k.type&&e.useCodedValues)for(b=h,a=0;a<k.codedValues.length;a++)if(k.codedValues[a].code==
b){h=k.codedValues[a].name;break}break}k=c[b].type;if(e.fieldInfos){var l=e.fieldInfos;for(b=0;b<l.length;b++)if("{"+l[b].fieldName+"}"==a){a=l[b].format;"esriFieldTypeDate"==k?(a="DateFormat"+f.prototype._dateFormats[a.dateFormat?a.dateFormat:"shortDate"])&&(h=g.substitute({myKey:h},"${myKey:"+a+"}")):"esriFieldTypeInteger"!=k&&"esriFieldTypeSingle"!=k&&"esriFieldTypeSmallInteger"!=k&&"esriFieldTypeLong"!=k&&"esriFieldTypeDouble"!=k||!a||(h=A.format(h,{places:a.places}),a.digitSeparator||B.group&&
(h=h.replace(new RegExp("\\"+B.group,"g"),"")));break}}break}else h="";return null==h?"":h})},_getLabelExpression:function(a){var b="";a.labelExpressionInfo?b=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&(b=this._convertLabelExpression(a.labelExpression));return b},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(/\[/g,"{").replace(/\]/g,"}")},_getProportionalSize:function(a,
b){if(!a)return null;b=g.substitute(b,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&b)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(b-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=!0,c="shortDate",e=null,f=null,d="",g=!0,h,k;if(a&&(a.format&&(c=a.format.dateFormat,e={places:a.format.places,digitSeparator:a.format.digitSeparator}),f=a.fieldInfos,d=a.labelPlacement,null!=a.useCodedValues&&(b=
a.useCodedValues),a=a.labelExpressionInfo)){var l=a.expression;l&&!a.value&&(k=!0,h=x.createAttributeCache({valueExpression:l},!0))}if("always-horizontal"==d||"esriServerPolygonPlacementAlwaysHorizontal"==d)g=!1;return{useCodedValues:b,dateFormat:c,numberFormat:e,fieldInfos:f,pointPriorities:"above-center"==d||"esriServerPointLabelPlacementAboveCenter"==d?"AboveCenter":"above-left"==d||"esriServerPointLabelPlacementAboveLeft"==d?"AboveLeft":"above-right"==d||"esriServerPointLabelPlacementAboveRight"==
d?"AboveRight":"below-center"==d||"esriServerPointLabelPlacementBelowCenter"==d?"BelowCenter":"below-left"==d||"esriServerPointLabelPlacementBelowLeft"==d?"BelowLeft":"below-right"==d||"esriServerPointLabelPlacementBelowRight"==d?"BelowRight":"center-center"==d||"esriServerPointLabelPlacementCenterCenter"==d?"CenterCenter":"center-left"==d||"esriServerPointLabelPlacementCenterLeft"==d?"CenterLeft":"center-right"==d||"esriServerPointLabelPlacementCenterRight"==d?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==
d||"below-start"==d||"center-start"==d?"PlaceAtStart":"above-end"==d||"below-end"==d||"center-end"==d?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==d||"esriServerLinePlacementAboveAfter"==d||"above-along"==d||"esriServerLinePlacementAboveAlong"==d||"above-before"==d||"esriServerLinePlacementAboveBefore"==d||"above-start"==d||"esriServerLinePlacementAboveStart"==d||"above-end"==d||"esriServerLinePlacementAboveEnd"==d?"Above":"below-after"==d||"esriServerLinePlacementBelowAfter"==d||
"below-along"==d||"esriServerLinePlacementBelowAlong"==d||"below-before"==d||"esriServerLinePlacementBelowBefore"==d||"below-start"==d||"esriServerLinePlacementBelowStart"==d||"below-end"==d||"esriServerLinePlacementBelowEnd"==d?"Below":"center-after"==d||"esriServerLinePlacementCenterAfter"==d||"center-along"==d||"esriServerLinePlacementCenterAlong"==d||"center-before"==d||"esriServerLinePlacementCenterBefore"==d||"center-start"==d||"esriServerLinePlacementCenterStart"==d||"center-end"==d||"esriServerLinePlacementCenterEnd"==
d?"OnLine":"Above",labelRotation:g,howManyLabels:"OneLabel",hasExpression:k,arcadeCache:h}}});b("extend-esri")&&n.setObject("layers.LabelLayer",t,c);return t});
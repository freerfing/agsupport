// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.26/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(t,l,e){t.DeferredList=function(r,q,b,u,p){var v=[];l.call(this);var m=this;0!==r.length||q||this.resolve([0,[]]);var k=0;e.forEach(r,function(d,f){function e(h,a){v[f]=[h,a];k++;k===r.length&&m.resolve(v)}d.then(function(h){q?m.resolve([f,h]):e(!0,h)},function(h){b?m.reject(h):e(!1,h);if(u)return null;throw h;})})};t.DeferredList.prototype=new l;t.DeferredList.prototype.gatherResults=
function(l){l=new t.DeferredList(l,!1,!0,!1);l.addCallback(function(l){var b=[];e.forEach(l,function(e){b.push(e[1])});return b});return l};return t.DeferredList})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(t,l,e,r,q,b,u,p){t=t([b,u],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(b,m){l.mixin(this,
m);this.initialize(b,m)},getTitle:function(b){var m;this.info&&(m=this.titleHasRelatedFields?"":this._getPopupValues(b,null,!0).title);return m||""},getContent:function(b){return this.info?(new p({template:this,graphic:b,chartTheme:this.chartTheme},r.create("div"))).domNode:""}});e("extend-esri")&&l.setObject("dijit.PopupTemplate",t,q);return t})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./support/expressionUtils ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),
function(t,l,e,r,q,b,u,p,v,m,k,d,f,z,h,a,c,n,E,B,A){t=t(null,{declaredClass:"esri.PopupInfo",_reExprField:/^\s*expression\//i,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(a,c){if(a){l.mixin(this,c);this.info=a;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var g=this._fieldLabels={},w=this._fieldsMap={};this.info.fieldInfos&&e.forEach(this.info.fieldInfos,function(a){var c=a.fieldName.toLowerCase(),
x=this._isExpressionField(c)?this.getExpressionInfo(c):null;g[c]=x?x.title:a.label;w[c]=a},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return r.fromJson(r.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(a){var c;e.some(this.info&&this.info.fieldInfos,function(g){g.fieldName===a&&(c=g);return!!c});return c},getExpressionInfo:function(a){if(this._isExpressionField(a)){a=a.replace(this._reExprField,
"");a=a.toLowerCase();var c;e.some(this.info.expressionInfos,function(g){g.name.toLowerCase()===a&&(c=g);return!!c});return c}},hasGeometryOperations:function(){return e.some(this.info.expressionInfos,function(a){return E.hasGeometryOperations(a.expression)})},getComponents:function(a){var c=this.info,g={};c.fieldInfos&&(c=e.filter(c.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<c.length&&(g.relatedInfo=this._getRelatedRecords({graphic:a,fieldsInfo:c}));
this._needFullResolutionFeature(a)&&(g.fullResolutionFeature=this._getFullResolutionFeature(a));return z(g).then(l.hitch(this,function(g){return this._getPopupValues(a,g.fullResolutionFeature)}))},getAttachments:function(a){var c=a.getSourceLayer();a=a.attributes;if(this.info.showAttachments&&c&&c.hasAttachments&&c.objectIdField&&(a=a&&a[c.objectIdField]))return c.queryAttachmentInfos(a)},_needFullResolutionFeature:function(a){return(a=a.getSourceLayer())?"esriGeometryPoint"!==a.geometryType&&"function"===
typeof a.getMaxAllowableOffset&&0<a.getMaxAllowableOffset()&&this.hasGeometryOperations():!1},_getFullResolutionFeature:function(a){var c=a.getSourceLayer(),g=c.objectIdField;a=(a=a.attributes)&&g&&a[g];if(null==a)return null;var d=new h;d.objectIds=[a];d.maxAllowableOffset=0;d.outFields=[g];return c.queryFeatures(d).then(function(a){return a.features&&a.features[0]})},_isExpressionField:function(a){return this._reExprField.test(a)},_compileExpressions:function(a){var c={};e.forEach(a,function(a){var g=
a.returnType&&a.returnType.toLowerCase();c[a.name]=B.createAttributeCache({valueExpression:a.expression},"number"!==g)});return c},_fetchAttributes:function(a,c){var g=l.clone(a.attributes)||{},h=c&&c.geometry,x=this._exprPrefix,w=this._exprCache;e.forEach(this.info.expressionInfos,function(c){var d=x+c.name;c=(c=w[c.name])?a._getDataValue(c.attributeInfo,c,E,null,h):null;"string"===typeof c&&(c=m.encode(c));g[d]=c});return g},_getPopupValues:function(a,c,g){var h=this.info,x=a.getSourceLayer(),d=
this._fetchAttributes(a,c),w=l.clone(d);c=h.fieldInfos;var f="",b="",E,y,n,m,B,p=x&&x._getDateOpts&&x._getDateOpts().properties,p=p&&p.slice(0),A={dateFormat:{properties:p,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(m in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(m)){var u=this._relatedInfo[m],z=this._relatedLayersInfo[m];u&&(e.forEach(u.relatedFeatures,function(a){for(B in a.attributes)if(a.attributes.hasOwnProperty(B)&&"esriRelCardinalityOneToOne"===
z.relation.cardinality){var g=this._toRelatedFieldName([z.relation.id,B]);d[g]=w[g]=a.attributes[B]}},this),e.forEach(u.relatedStatsFeatures,function(a){for(B in a.attributes)if(a.attributes.hasOwnProperty(B)){var g=this._toRelatedFieldName([z.relation.id,B]);d[g]=w[g]=a.attributes[B]}},this))}c&&e.forEach(c,function(a){y=a.fieldName;var g=this._getLayerFieldInfo(x,y);g&&(y=a.fieldName=g.name);w[y]=this._formatValue(w[y],y,A);p&&a.format&&a.format.dateFormat&&(a=e.indexOf(p,y),-1<a&&p.splice(a,1))},
this);if(x){m=x.types;var v=(u=x.typeIdField)&&d[u];for(y in d)if(d.hasOwnProperty(y)&&-1===y.indexOf(this._relatedFieldPrefix)&&(n=d[y],k.isDefined(n))){var q=this._getDomainName(x,a,m,v,y,n);k.isDefined(q)?w[y]=q:y===u&&(q=this._getTypeName(x,a,n),k.isDefined(q)&&(w[y]=q))}}h.title&&(f=this._processFieldsInLinks(this._fixTokens(h.title,x),d),f=l.trim(this._removeEmptyHref(k.substitute(w,f,A)||"")));if(g)return{title:f};h.description&&(b=this._processFieldsInLinks(this._fixTokens(h.description,x),
d),b=l.trim(this._removeEmptyHref(k.substitute(w,b,A)||"")));c&&(E=[],e.forEach(c,function(a){(y=a.fieldName)&&a.visible&&E.push([this._fieldLabels[y.toLowerCase()]||y,k.substitute(w,"${"+y+"}",A)||""])},this));var r,t;h.mediaInfos&&(r=[],e.forEach(h.mediaInfos,function(a){t=0;n=a.value;switch(a.type){case "image":var g=n.sourceURL,g=g&&l.trim(this._removeEmptyHref(k.substitute(d,this._fixTokens(g,x))));t=!!g;break;case "piechart":case "linechart":case "columnchart":case "barchart":var c,g=n.normalizeField;
n.fields=e.map(n.fields,function(a){return(c=this._getLayerFieldInfo(x,a))?c.name:a},this);g&&(c=this._getLayerFieldInfo(x,g),n.normalizeField=c?c.name:g);t=e.some(n.fields,function(a){return k.isDefined(d[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(t){a=l.clone(a);n=a.value;var g=a.title?this._processFieldsInLinks(this._fixTokens(a.title,x),d):"",h=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,x),d):"";a.title=g?l.trim(this._removeEmptyHref(k.substitute(w,
g,A)||"")):"";a.caption=h?l.trim(this._removeEmptyHref(k.substitute(w,h,A)||"")):"";if("image"===a.type)n.sourceURL=k.substitute(d,this._fixTokens(n.sourceURL,x)),n.linkURL&&(n.linkURL=l.trim(k.substitute(d,this._fixTokens(n.linkURL,x))||""));else{var C,f;e.forEach(n.fields,function(a,g){if(-1!==a.indexOf(this._relatedFieldPrefix))f=this._getRelatedChartInfos(a,n,d,A),f instanceof Array?n.fields=f:n.fields[g]=f;else{var c=d[a],c=void 0===c?null:c;C=d[n.normalizeField]||0;c&&C&&(c/=C);n.fields[g]=
{y:c,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(c,a,A,!!C)}}},this)}r.push(a)}},this));return{title:f,description:b,hasDescription:!!h.description,fields:E&&E.length?E:null,mediaInfos:r&&r.length?r:null,formatted:w,editSummary:x&&x.getEditSummary?x.getEditSummary(a):""}},_getRelatedChartInfos:function(a,c,g,h){var x,d,w,f,C,y;x=[];y=this._fromRelatedFieldName(a);C=y[0];d=this._relatedInfo[C];C=this._relatedLayersInfo[C];d&&e.forEach(d.relatedFeatures,function(d){d=
d.attributes;var C,E;for(E in d)if(d.hasOwnProperty(E)&&E===y[1]){C={};f=d[E];c.normalizeField&&(w=-1!==c.normalizeField.indexOf(this._relatedFieldPrefix)?d[this._fromRelatedFieldName(c.normalizeField)[1]]:g[c.normalizeField]);f&&w&&(f/=w);if(c.tooltipField)if(-1!==c.tooltipField.indexOf(this._relatedFieldPrefix)){var b=this._fromRelatedFieldName(c.tooltipField)[1],n=k.isDefined(d[b])?this._formatValue(d[b],c.tooltipField,h,!!w):b;C.tooltip=n+":\x3cbr/\x3e"+this._formatValue(f,b,h,!!w)}else C.tooltip=
(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(f,c.tooltipField,h,!!w);else C.tooltip=f;C.y=f;x.push(C)}},this);return"esriRelCardinalityOneToMany"===C.relation.cardinality||"esriRelCardinalityManyToMany"===C.relation.cardinality?x:x[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",
shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,
_fixTokens:function(a,c){var g=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,h,d){a=g._getLayerFieldInfo(c,d);return"$"+(a?"{"+a.name+"}":h)})},_encodeAttributes:function(a){a=l.clone(a)||{};var c,g;for(c in a)(g=a[c])&&"string"===typeof g&&(g=encodeURIComponent(g).replace(/\'/g,"\x26apos;"),a[c]=g);return a},_processFieldsInLinks:function(a,c){var g=this._encodeAttributes(c);c=l.hitch(this,this._addValuesToHref,c,g);a&&(a=a.replace(this._reHref,c).replace(this._reHrefApos,c));return a},
_addValuesToHref:function(a,c,g,h){h=h&&l.trim(h);return g=k.substitute(h&&0===h.indexOf("${")?a:c,g)},_getLayerFieldInfo:function(a,c){return a&&a.getField?a.getField(c):null},_formatValue:function(a,c,g,h){var d=this._fieldsMap[c.toLowerCase()],w=d&&d.format;c=-1!==e.indexOf(g.dateFormat.properties,c);var f="number"===typeof a&&!c&&(!w||!w.dateFormat);if(!k.isDefined(a)||!d||!k.isDefined(w))return f?this._forceLTR(a):a;var C="",d=[],E=w.hasOwnProperty("places")||w.hasOwnProperty("digitSeparator"),
b=w.hasOwnProperty("digitSeparator")?w.digitSeparator:!0;if(E&&!c)C="NumberFormat",d.push("places: "+(k.isDefined(w.places)&&(!h||0<w.places)?Number(w.places):"Infinity")),d.length&&(C+="("+d.join(",")+")");else if(w.dateFormat)C="DateFormat"+this._insertOffset(this._dateFormats[w.dateFormat]||this._dateFormats.shortDateShortTime);else return f?this._forceLTR(a):a;var n=this._applyFormatting(a,C,g);E&&-1<a.constructor.toString().indexOf("Array")&&(n="",e.forEach(a,l.hitch(this,function(a,c){c&&(n+=
" ");n+=this._applyFormatting(a,C,g)})));E&&!b&&A.group&&(n=n.replace(new RegExp("\\"+A.group,"g"),""));c&&(n='\x3cspan class\x3d"esriDateValue"\x3e'+n+"\x3c/span\x3e");return f?this._forceLTR(n):n},_applyFormatting:function(a,c,g){return k.substitute({myKey:a},"${myKey:"+c+"}",g)||""},_forceLTR:function(a){var c=p("ie");return c&&10>=c?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=k.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+
")"):a);return a},_getDomainName:function(a,c,g,h,d,f){return(a=a.getDomain&&a.getDomain(d,{feature:c}))&&a.codedValues?a.getName(f):null},_getTypeName:function(a,c,g){return(a=a.getType&&a.getType(c))&&a.name},_getRelatedRecords:function(a){var c=a.graphic,g;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=this._getRelatedLayersInfo(a).then(l.hitch(this,function(a){for(g in a)a.hasOwnProperty(g)&&a[g]&&(this._relatedLayersInfo[g].relatedLayerInfo=a[g])})));return this._relatedLayersInfoPromise.then(l.hitch(this,
function(){return this._queryRelatedLayers(c)})).then(l.hitch(this,function(a){this._setRelatedRecords(c,a);return a}))},_getRelatedLayersInfo:function(a){var c=a.fieldsInfo,g,h,d={};g=a.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});e.forEach(c,function(a){var c,h,d,x;c=this._fromRelatedFieldName(a.fieldName);h=c[0];c=c[1];h&&(!this._relatedLayersInfo[h]&&g&&g.relationships&&(e.some(g.relationships,function(a){if(a.id==h)return x=a,!0}),x&&(this._relatedLayersInfo[h]=
{relation:x,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[h]&&(this._relatedLayersInfo[h].relatedFields.push(c),a.statisticType&&(d=new n,d.statisticType=a.statisticType,d.onStatisticField=c,d.outStatisticFieldName=c,this._relatedLayersInfo[h].outStatistics.push(d))))},this);for(h in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(h)&&this._relatedLayersInfo[h]&&(a=this._relatedLayersInfo[h].relation,a=g.url.replace(/[0-9]+$/,a.relatedTableId),this._relatedLayersInfo[h].relatedLayerUrl=
a,d[h]=f({url:a,content:{f:"json"},callbackParamName:"callback"}));return v(d)},_queryRelatedLayers:function(a){var c={},g;for(g in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(g)&&(c[g]=this._queryRelatedLayer({graphic:a,relatedInfo:this._relatedLayersInfo[g]}));return v(c)},_queryRelatedLayer:function(c){var d,g,f,x,n,E,b,k,m,B,y,p,A;d=c.graphic;g=d.getSourceLayer();f=g.url.match(/[0-9]+$/g)[0];y=c.relatedInfo;B=y.relatedLayerInfo;p=y.relatedLayerUrl;c=y.relation;e.some(B.relationships,
function(a){if(a.relatedTableId===parseInt(f,10))return x=a,!0},this);x&&(n=new h,e.some(B.fields,function(a){if(a.name===x.keyField)return k=-1!==e.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),x.relationshipTableId&&x.keyFieldInRelationshipTable?(A=new u,this._queryRelatedRecords(d,x).then(l.hitch(this,function(c){var x;(x=c[d.attributes[g.objectIdField]])?(c=e.map(x.features,function(a){return a.attributes[B.objectIdField]},
this),y.outStatistics&&0<y.outStatistics.length&&B.supportsStatistics&&(m=new h,m.objectIds=c,m.outFields=n.outFields,m.outStatistics=y.outStatistics),m&&(E=new a(p),E.execute(m).then(l.hitch(this,function(a){var c=[];c.push(x);c.push(a);A.resolve(c)})))):A.resolve()}))):(b="string"===k?x.keyField+"\x3d'"+d.attributes[c.keyField]+"'":x.keyField+"\x3d"+d.attributes[c.keyField],n.where=b,n.outFields=y.relatedFields,y.outStatistics&&0<y.outStatistics.length&&B.supportsStatistics&&(m=new h,m.where=n.where,
m.outFields=n.outFields,m.outStatistics=y.outStatistics),E=new a(p),b=[],b.push(E.execute(n)),m&&b.push(E.execute(m))));return b?v(b):A?A.promise:void 0},_setRelatedRecords:function(a,c){this._relatedInfo=[];for(var g in c)c.hasOwnProperty(g)&&c[g]&&(a=c[g],this._relatedInfo[g]={},this._relatedInfo[g].relatedFeatures=a[0].features,k.isDefined(a[1])&&(this._relatedInfo[g].relatedStatsFeatures=a[1].features))},_handlerErrorResponse:function(a,c){a.reject(c)},_fromRelatedFieldName:function(a){var c=
[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),c=a.slice(1));return c},_toRelatedFieldName:function(a){var c="";a&&0<a.length&&(c=this._relatedFieldPrefix+a[0]+"/"+a[1]);return c},_queryRelatedRecords:function(a,h){var g=a.getSourceLayer(),d=new c;d.outFields=["*"];d.relationshipId=h.id;d.objectIds=[a.attributes[g.objectIdField]];return g.queryRelatedFeatures(d)},_removeEmptyHref:function(a){return a.replace(/href=(""|'')/gi,"")}});b("extend-esri")&&(d.PopupInfo=d.PopupInfoTemplate=
t);return t})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(t){var l=t.getObject("dojox.html.entities",!0),e=function(e,b){var u,p;if(b._encCache&&b._encCache.regexp&&b._encCache.mapper&&b.length==b._encCache.length)u=b._encCache.mapper,p=b._encCache.regexp;else{u={};p=["["];var v;for(v=0;v<b.length;v++)u[b[v][0]]="\x26"+b[v][1]+";",p.push(b[v][0]);p.push("]");p=new RegExp(p.join(""),"g");b._encCache={mapper:u,regexp:p,length:b.length}}return e=e.replace(p,function(b){return u[b]})},
r=function(e,b){var u,p;if(b._decCache&&b._decCache.regexp&&b._decCache.mapper&&b.length==b._decCache.length)u=b._decCache.mapper,p=b._decCache.regexp;else{u={};p=["("];var v;for(v=0;v<b.length;v++){var m="\x26"+b[v][1]+";";v&&p.push("|");u[m]=b[v][0];p.push(m)}p.push(")");p=new RegExp(p.join(""),"g");b._decCache={mapper:u,regexp:p,length:b.length}}return e=e.replace(p,function(b){return u[b]})};l.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];l.latin=[["\u00a1",
"iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],
["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],
["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],
["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a",
"Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be",
"xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191",
"uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229",
"cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663",
"clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030",
"permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];l.encode=function(q,b){q&&(b?q=e(q,b):(q=e(q,l.html),q=e(q,l.latin)));return q};l.decode=function(e,b){e&&(b?e=r(e,b):(e=r(e,l.html),e=r(e,l.latin)));return e};return l})},"esri/promiseList":function(){define(["dojo/_base/array","dojo/Deferred","dojo/when"],function(t,l,e){var r=t.forEach;return function(q){function b(b,h){v[h]=b;d.progress([b,h]);0===--f&&d.resolve(v)}var u,p;q instanceof Array?p=q:q&&"object"===typeof q&&(u=q);var v,m=[];if(u){p=
[];for(var k in u)Object.hasOwnProperty.call(u,k)&&(m.push(k),p.push(u[k]));v={}}else p&&(v=[]);if(!p||!p.length)return(new l).resolve(v);var d=new l;d.promise.always(function(){v=m=null});var f=p.length;r(p,function(f,h){u||m.push(h);e(f,function(a){d.isFulfilled()||b(a,m[h])},function(a){d.isFulfilled()||b(a,m[h])})});return d.promise}})},"esri/tasks/QueryTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/DeferredList ../kernel ../sniff ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),
function(t,l,e,r,q,b,u,p,v,m,k,d,f,z,h){var a=v("esri-pbf"),c=l(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(a){this._handleSuccess=e.hitch(this,this._handleSuccess);this._handleError=e.hitch(this,this._handleError);e.mixin(this,a);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var a=new q(this._canceler);this._fetchDfd=a;this._result=null;this._sendRequest();
return a.promise},_canceler:function(a){var c=a._pendingRequest,h;a.isFulfilled()||!c||c.isFulfilled()||(c.cancel(),h=c.results&&c.results[1]);a._pendingRequest=null;return h},_sendRequest:function(a){var c=this.query;this.pagination&&(this._startPage=c.resultOffset=null==a?0:a,c.resultRecordCount=this.pageSize);a=this.requestOptions;this._fetchDfd._pendingRequest=m({url:this.url,content:c,handleAs:"pbf"===c.f?"arraybuffer":"json",callbackParamName:"callback",timeout:a&&a.timeout},a);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},
_handleSuccess:function(a){this.pagination?(a.exceededTransferLimit&&this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=this._result.features.concat(a.features):this._result=a,this._fetchDfd.progress(a),a.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(a),this._fetchDfd.resolve(a))},_handleError:function(a){this._fetchDfd.reject(a)}}),n=l(z,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],
"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(a,c){this._handler=e.hitch(this,this._handler);this._relationshipQueryHandler=e.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=e.hitch(this,this._executeForIdsHandler);this._countHandler=e.hitch(this,this._countHandler);this._extentHandler=e.hitch(this,this._extentHandler);this.source=c&&c.source;this.gdbVersion=c&&c.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",
c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(c,h,d,f,w){var g=
w.assembly;c=this._encode(e.mixin({},this._url.query,{f:f&&f.format||"json"},c.toJson(g&&g[0])));var C=this._handler,x=this._errorHandler;this.source&&(f={source:this.source.toJson()},c.layer=b.toJson(f));this.gdbVersion&&(c.gdbVersion=this.gdbVersion);var k="pbf"===c.f;if(k){var E;a||(E="QueryTask.execute: 'pbf' format is not supported in your browser.");if(E)return c=new q,c.addErrback(function(a){x(a,d,w.dfd)}),c.reject(Error(E)),c}E=this.requestOptions;E=m({url:this._url.path+"/query",content:c,
callbackParamName:"callback",handleAs:k?"arraybuffer":"json",timeout:E&&E.timeout},E);c=[E];k&&c.push(n.loadPBFReader());(new u(c)).then(function(a){w.dfd.isFulfilled()||(a=a[0],a[0]?C(a[1],k,h,d,w.dfd):x(a[1],d,w.dfd))});return E},rawExecute:function(a,h,d){h=h||{};a=this._encode(e.mixin({},this._url.query,{f:h.format||"json"},a.toJson(d.assembly&&d.assembly[0])));this.source&&(a.layer=b.toJson({source:this.source.toJson()}));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return(new c({url:this._url.path+
"/query",query:a,requestOptions:this.requestOptions,pagination:h.pagination,pageSize:h.pageSize})).execute().then(null,null,function(a){d.dfd.progress(a)}).then(e.hitch(this,function(a){this._successHandler([a],"onRawExecuteComplete",null,d.dfd)})).otherwise(e.hitch(this,function(a){this._errorHandler(a,null,d.dfd)}))},executeRelationshipQuery:function(a,c,h){a=this._encode(e.mixin({},this._url.query,{f:"json"},a.toJson()));var d=this._relationshipQueryHandler,f=this._errorHandler;this.gdbVersion&&
(a.gdbVersion=this.gdbVersion);var g=new q(k._dfdCanceller),b=this.requestOptions;g._pendingDfd=m({url:this._url.path+"/queryRelatedRecords",content:a,callbackParamName:"callback",timeout:b&&b.timeout,load:function(a,f){d(a,f,c,h,g)},error:function(a){f(a,h,g)}},b);return g},executeForIds:function(a,c,h,d){var f=d.assembly;a=this._encode(e.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},a.toJson(f&&f[0])));var g=this._executeForIdsHandler,n=this._errorHandler;this.source&&(f={source:this.source.toJson()},
a.layer=b.toJson(f));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);f=this.requestOptions;return m({url:this._url.path+"/query",content:a,callbackParamName:"callback",timeout:f&&f.timeout,load:function(a,f){g(a,f,c,h,d.dfd)},error:function(a){n(a,h,d.dfd)}},f)},executeForCount:function(a,c,h,d){var f=d.assembly;a=this._encode(e.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJson(f&&f[0])));var g=this._countHandler,n=this._errorHandler;this.source&&(f={source:this.source.toJson()},
a.layer=b.toJson(f));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);f=this.requestOptions;return m({url:this._url.path+"/query",content:a,callbackParamName:"callback",timeout:f&&f.timeout,load:function(a,f){g(a,f,c,h,d.dfd)},error:function(a){n(a,h,d.dfd)}},f)},executeForExtent:function(a,c,h,d){var f=d.assembly;a=this._encode(e.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},a.toJson(f&&f[0])));var g=this._extentHandler,n=this._errorHandler;this.source&&(f={source:this.source.toJson()},
a.layer=b.toJson(f));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);f=this.requestOptions;return m({url:this._url.path+"/query",content:a,callbackParamName:"callback",timeout:f&&f.timeout,load:function(a,f){g(a,f,c,h,d.dfd)},error:function(a){n(a,h,d.dfd)}},f)},_handler:function(a,c,d,f,b){try{a&&c&&(a=n.pbfDeps.optimizedFeatures.convertToFeatureSet(n.pbfDeps.pbfQueryUtils.parsePBFFeatureQuery(a)));var g=new h(a);this._successHandler([g],"onComplete",d,b)}catch(C){this._errorHandler(C,f,b)}},_relationshipQueryHandler:function(a,
c,d,f,b){try{var g=a.geometryType,n=a.spatialReference,x={};r.forEach(a.relatedRecordGroups,function(a){var c={};c.geometryType=g;c.spatialReference=n;c.features=a.relatedRecords;c=new h(c);if(null!=a.objectId)x[a.objectId]=c;else for(var d in a)a.hasOwnProperty(d)&&"relatedRecords"!==d&&(x[a[d]]=c)});this._successHandler([x],"onExecuteRelationshipQueryComplete",d,b)}catch(J){this._errorHandler(J,f,b)}},_executeForIdsHandler:function(a,c,d,h,f){try{this._successHandler([a.objectIds],"onExecuteForIdsComplete",
d,f)}catch(g){this._errorHandler(g,h,f)}},_countHandler:function(a,c,d,h,f){try{var g,b=a.features,x=a.objectIds;if(x)g=x.length;else{if(b)throw Error("Unable to perform query. Please check your parameters.");g=a.count}this._successHandler([g],"onExecuteForCountComplete",d,f)}catch(J){this._errorHandler(J,h,f)}},_extentHandler:function(a,c,h,f,b){try{a.extent&&(a.extent=new d(a.extent)),this._successHandler([a],"onExecuteForExtentComplete",h,b)}catch(g){this._errorHandler(g,f,b)}}});n.loadPBFReader=
function(){var a=new q;n.pbfDeps?a.resolve():t(["./support/pbfDeps"],function(c){n.pbfDeps=c;a.isFulfilled()||a.resolve()});return a.promise};f._createWrappers(n);v("extend-esri")&&e.setObject("tasks.QueryTask",n,p);return n})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(t,l,e,r,q,b,u,p){t=t(p,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},
constructor:function(b,m){b&&l.isString(b)&&(this._url=u.urlToObject(this.url=b));m&&m.requestOptions&&(this.requestOptions=m.requestOptions);this.normalization=!0;this._errorHandler=l.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var b=this._url,m=/^http:/i;this.url&&(this.url=this.url.replace(m,"https:"));b&&b.path&&(b.path=b.path.replace(m,"https:"))},_encode:function(b,m,k){var d,f,p={},h,a;for(h in b)if("declaredClass"!==h&&(d=b[h],f=typeof d,null!==d&&void 0!==
d&&"function"!==f))if(l.isArray(d))for(p[h]=[],a=d.length,f=0;f<a;f++)p[h][f]=this._encode(d[f]);else"object"===f?d.toJson&&(f=d.toJson(k&&k[h]),"esri.tasks.FeatureSet"===d.declaredClass&&f.spatialReference&&(f.sr=f.spatialReference,delete f.spatialReference),p[h]=m?f:e.toJson(f)):p[h]=d;return p},_successHandler:function(e,m,k,d){m&&this[m].apply(this,e);k&&k.apply(null,e);d&&b._resDfd(d,e)},_errorHandler:function(b,m,k){this.onError(b);m&&m(b);k&&k.errback(b)},setNormalization:function(b){this.normalization=
b},onError:function(){}});r("extend-esri")&&(q.Task=t);return t})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(t,l,e,r,q,b,u,p,v,m,k,d){t=t(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(f,b){if(f){l.mixin(this,f);var h=this.features=this.features||[],a=f.spatialReference,
a=this.spatialReference=k.createInstance(p.simpleConstructor,a),c=k.getGeometryType(f.geometryType);this.geometryType=f.geometryType;f.fields&&(this.fields=f.fields);f=k.supportsLazyUnquantization(this.geometryType);var n=k.unquantizeFunction(this.geometryType,this.transform),m=!!(b&&f&&n),B=c&&(m?c.accessorConstructor:c.simpleConstructor);e.forEach(h,function(f,b){var w=k.createInstance(u.simpleConstructor),g=f.geometry;if(c&&g){var C=w.geometry=k.createInstance(B,m?null:g);C.setSpatialReference(g.spatialReference?
k.createInstance(p.simpleConstructor,g.spatialReference):a);m&&C.setupLazyUnquantization(n,g)}w.symbol=f.symbol?d.fromJson(f.symbol):null;w.attributes=f.attributes;h[b]=w});m||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(d){var f={};this.displayFieldName&&(f.displayFieldName=this.displayFieldName);this.fields&&(f.fields=this.fields);this.spatialReference?f.spatialReference=this.spatialReference.toJson():this.features[0]&&
this.features[0].geometry&&(f.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(f.geometryType=k.getJsonType(this.features[0].geometry)),f.features=v._encodeGraphics(this.features,d));f.geometryType=f.geometryType||this.geometryType;f.exceededTransferLimit=this.exceededTransferLimit;f.transform=this.transform;return b.fixJson(f)},_hydrate:function(){k.unquantize(this.features,this.geometryType,this.transform);this.transform=null},
quantize:function(d){if(!this.geometryType)return this.transform=null,this;var f=d.translate[0],h=d.translate[1],a=d.scale[0],c=d.scale[1],b=this.features,k=function(a,c,d){var g,h,f,b,n,k,C=[];g=0;for(h=a.length;g<h;g++)if(f=a[g],0<g){if(k=c(f[0]),f=d(f[1]),k!==b||f!==n)C.push([k-b,f-n]),b=k,n=f}else b=c(f[0]),n=d(f[1]),C.push([b,n]);return 0<C.length?C:null},m=function(a,c,d){if("esriGeometryPoint"===a)return function(a){a.x=c(a.x);a.y=d(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===
a)return function(a){var g,h,f,b,x;f=a.rings||a.paths;x=[];g=0;for(h=f.length;g<h;g++)b=f[g],(b=k(b,c,d))&&x.push(b);return 0<x.length?(a.rings?a.rings=x:a.paths=x,a):null};if("esriGeometryMultipoint"===a)return function(a){var g;g=k(a.points,c,d);return 0<g.length?(a.points=g,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(c){return Math.round((c-f)/a)},function(a){return Math.round((h-a)/c)}),e,p;e=0;for(p=b.length;e<p;e++)b[e].geometry&&(m(b[e].geometry)||
b[e].setGeometry(null));this.transform=d;return this}});t.createGraphics=function(d){var f=d.geometryType,h=k.createInstance(p.simpleConstructor,d.spatialReference),a=k.getGeometryType(f).accessorConstructor,c=k.unquantizeFunction(f,d.transform);return e.map(d.features,function(d,f){f=k.createInstance(u.simpleConstructor);var b=d.geometry;if(b){var n=f.geometry=k.createInstance(a);n.setSpatialReference(h);n.setupLazyUnquantization(c,b)}f.attributes=d.attributes;return f})};t.createPolygon=function(d,
b,h){var a;d&&(a=k.createInstance(m.accessorConstructor),a.setSpatialReference(b),b=k.unquantizeFunction("esriGeometryPolygon",h),a.setupLazyUnquantization(b,d));return a};r("extend-esri")&&l.setObject("tasks.FeatureSet",t,q);return t})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(t,l,e,r,q){t=t(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,
objectIds:null,outSpatialReference:null,outFields:null,orderByFields:null,toJson:function(){var b={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},u=this.objectIds,p=this.outFields,l=this.outSpatialReference,m=this.orderByFields;u&&(b.objectIds=u.join(","));p&&(b.outFields=p.join(","));l&&(b.outSR=l.wkid||e.toJson(l.toJson()));m&&(b.orderByFields=
m.join(","));b._ts=this._ts;return b}});r("extend-esri")&&l.setObject("tasks.RelationshipQuery",t,q);return t})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(t,l,e,r){t=t(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,
maxVertexCount:this.maxVertexCount}}});e("extend-esri")&&l.setObject("tasks.StatisticDefinition",t,r);return t})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(t,l,e,r,q,b,u,p,v,m,k,d,f,z,h,a,c,n,E,B,A){var y=0,w=A.widgets.popup,g=A.widgets.templatePicker;l=l([B,h,a],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=r.mixin({},w)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'statusSection hidden' dojoAttachPoint\x3d'_status'\x3e\x3c/div\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this._showStatus(g.loading);this._contentDfd=this.template.getComponents(this.graphic).then(r.hitch(this,this._handleComponentsSuccess)).otherwise(r.hitch(this,this._handleComponentsError))},destroy:function(){this._contentDfd&&this._contentDfd.cancel();this._attachmentsDfd&&this._attachmentsDfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._contentDfd=this._attachmentsDfd=null;this.inherited(arguments)},
_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,c=a.length,g=this.domNode,d=this._prevMedia,h=this._nextMedia;if(1<c){var f=0,n=0;q.forEach(a,function(a){"image"===a.type?f++:-1!==a.type.indexOf("chart")&&n++});f&&(m.set(this._imageCount,"innerHTML",f),b.query(".summary .image",
g).removeClass("hidden"));n&&(m.set(this._chartCount,"innerHTML",n),b.query(".summary .chart",g).removeClass("hidden"))}else b.query(".summary",g).addClass("hidden"),k.add(d,"hidden"),k.add(h,"hidden");a=this._mediaPtr;0===a?k.add(d,"hidden"):k.remove(d,"hidden");a===c-1?k.add(h,"hidden"):k.remove(h,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],c=a.title,g=a.caption,d=b.query(".mediaSection .hzLine",this.domNode)[0];m.set(this._mediaTitle,"innerHTML",
c);k[c?"remove":"add"](this._mediaTitle,"hidden");m.set(this._mediaCaption,"innerHTML",g);k[g?"remove":"add"](this._mediaCaption,"hidden");k[c&&g?"remove":"add"](d,"hidden");this._rid=null;if("image"===a.type)this._showImage(a);else{var h=this,c=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],g=a.value.theme||this.chartTheme;r.isString(g)&&(g=g.replace(/\./gi,"/"),-1===g.indexOf("/")&&(g="dojox/charting/themes/"+g));g||(g="./Rainbow");c.push(g);try{var f=this._rid=y++;t(c,function(c,
g,d){f===h._rid&&(h._rid=null,h._showChart(a.type,a.value,c,g,d))})}catch(I){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(a){return(a=a&&r.trim(a).toLowerCase())&&(0===a.indexOf("mailto:")||0===a.indexOf("tel:"))},_showImage:function(a){k.add(this._mediaFrame,"image");var c=f.get(this._gallery,"height"),g=a.value,h;g.linkURL&&(h=d.create("a",{href:g.linkURL,target:this._preventNewTab(g.linkURL)?"":"_blank"},this._mediaFrame));g=a.refreshInterval?this._addURLParameter(g.sourceURL,
"timestamp",Date.now()):g.sourceURL;d.create("img",{className:"esriPopupMediaImage",src:g},h||this._mediaFrame);var n=b.query(".esriPopupMediaImage",this._mediaFrame)[0];this._imageLoadHandle=e.connect(n,"onload",this,function(){this._clearImageHandles();this._imageLoaded(n,c);this._initImageRefresh(a)})},_addURLParameter:function(a,c,g){var d=-1===a.indexOf("?")?"?":"\x26";return a+d+c+"\x3d"+g},_initImageRefresh:function(a){if(a.refreshInterval){var c=6E4*a.refreshInterval;this._imageRefreshHandle=
setTimeout(r.hitch(this,function(){this._destroyFrame();this._showImage(a)}),c)}},_clearImageHandles:function(){e.disconnect(this._imageLoadHandle);this._imageLoadHandle=null;clearTimeout(this._imageRefreshHandle);this._imageRefreshHandle=null},_showChart:function(a,c,g,h,f){k.remove(this._mediaFrame,"image");g=this._chart=new g(d.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});f&&g.setTheme(f);switch(a){case "piechart":g.addPlot("default",{type:"Pie",labels:!1});g.addSeries("Series A",
c.fields);break;case "linechart":g.addPlot("default",{type:"Markers"});g.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});g.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});q.forEach(c.fields,function(a,c){a.x=c+1});g.addSeries("Series A",c.fields);break;case "columnchart":g.addPlot("default",{type:"Columns",gap:3});g.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});g.addSeries("Series A",c.fields);break;case "barchart":g.addPlot("default",{type:"Bars",
gap:3}),g.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),g.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),g.addSeries("Series A",c.fields)}this._action=new h(g);g.render()},_destroyFrame:function(){this._rid=null;this._clearImageHandles();this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);m.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,c){var g=a.height;g<c&&f.set(a,"marginTop",
Math.round((c-g)/2)+"px")},_attListHandler:function(a,c){if(a===this._attachmentsDfd){this._attachmentsDfd=null;var g="";c instanceof Error||!c||!c.length||q.forEach(c,function(a){g+="\x3cli\x3e";g+="\x3ca href\x3d'"+E.addProxy(a.url)+"' target\x3d'_blank'\x3e"+(a.name||"[No name]")+"\x3c/a\x3e";g+="\x3c/li\x3e"});m.set(this._attachmentsList,"innerHTML",g||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_supportedURIInfos:[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,label:w.NLS_moreInfo},{pattern:/^\s*(tel:([^\s]+))\s*$/i,
label:"${hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"${hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,appName:"App Studio Player",label:w.NLS_openLinkInApp},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,appName:"Collector",label:w.NLS_openLinkInApp},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,appName:"Explorer",label:w.NLS_openLinkInApp},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,appName:"Navigator",label:w.NLS_openLinkInApp},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,
appName:"Survey123",label:w.NLS_openLinkInApp},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,appName:"Trek2There",label:w.NLS_openLinkInApp},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,appName:"Workforce",label:w.NLS_openLinkInApp},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,appName:"iForm",label:w.NLS_openLinkInApp},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,appName:"FlowFinity",label:w.NLS_openLinkInApp},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,appName:"Laserfische",label:w.NLS_openLinkInApp},
{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,appName:"Microsoft Power BI",label:w.NLS_openLinkInApp}],_findURIInfo:function(a){var c;q.some(this._supportedURIInfos,function(g){g.pattern.test(a)&&(c=g);return!!c});return c},_createLinkIfURI:function(a){var c=this._findURIInfo(a);if(c){var g=a.match(c.pattern);return a.replace(c.pattern,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+n.substitute({appName:c.appName,hierPart:g&&g[2]},c.label)+"\x3c/a\x3e")}return a},_showStatus:function(a){m.set(this._status,
"innerHTML",a);k.remove(this._status,"hidden");b.query(".mainSection",this.domNode).addClass("hidden")},_hideStatus:function(){m.set(this._status,"innerHTML","");k.add(this._status,"hidden");b.query(".mainSection",this.domNode).removeClass("hidden")},_handleComponentsSuccess:function(a){if(a){this._hideStatus();var c=this.showTitle?a.title:"",g=a.description,d=a.fields,h=a.mediaInfos,f=this.domNode,n=this._nls,e=this,C=this.template,p=this.graphic;this._prevMedia.title=n.NLS_prevMedia;this._nextMedia.title=
n.NLS_nextMedia;m.set(this._title,"innerHTML",c);c||k.add(this._title,"hidden");!a.hasDescription&&d&&(g="",q.forEach(d,function(a){g+="\x3ctr valign\x3d'top'\x3e";g+="\x3ctd class\x3d'attrName'\x3e"+z.encode(a[0])+"\x3c/td\x3e";g+="\x3ctd class\x3d'attrValue'\x3e"+this._createLinkIfURI(a[1])+"\x3c/td\x3e";g+="\x3c/tr\x3e"},this),g&&(g="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+g+"\x3c/table\x3e"));m.set(this._description,"innerHTML",g);g||k.add(this._description,
"hidden");b.query("a",this._description).forEach(function(a){e._preventNewTab(a.href)?"_blank"===a.target&&m.remove(a,"target"):m.set(a,"target","_blank")});c&&g?b.query(".mainSection .hzLine",f).removeClass("hidden"):c||g?b.query(".mainSection .hzLine",f).addClass("hidden"):b.query(".mainSection",f).addClass("hidden");if(c=this._attachmentsDfd=C.getAttachments(p))c.addBoth(r.hitch(this,this._attListHandler,c)),m.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+n.NLS_searching+"...\x3c/li\x3e"),
b.query(".attachmentsSection",f).removeClass("hidden");h&&h.length&&(b.query(".mediaSection",f).removeClass("hidden"),v.setSelectable(this._mediaFrame,!1),this._mediaInfos=h,this._mediaPtr=0,this._updateUI(),this._displayMedia());a.editSummary&&(m.set(this._editSummary,"innerHTML",a.editSummary),h&&h.length&&k.remove(this._mediaBreak,"hidden"),k.remove(this._editSummarySection,"hidden"));this.emit("content-update")}else this._showStatus(w.NLS_noInfo)},_handleComponentsError:function(a){a&&"cancel"===
a.dojoType||(console.log("PopupRenderer: error loading template",a),this._showStatus(w.NLS_noInfo))}});u("extend-esri")&&r.setObject("dijit._PopupRenderer",l,c);return l})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(t,l,e,r,q,b,u,p,v,m,k,d,f){function z(){}function h(a){return function(c,
d,h,f){return c&&"string"==typeof d&&c[d]==z?c.on(d.substring(2).toLowerCase(),u.hitch(h,f)):a.apply(e,arguments)}}t.around(e,"connect",h);b.connect&&t.around(b,"connect",h);t=r("dijit._Widget",[k,d,f],{onClick:z,onDblClick:z,onKeyDown:z,onKeyPress:z,onKeyUp:z,onMouseDown:z,onMouseMove:z,onMouseOut:z,onMouseOver:z,onMouseLeave:z,onMouseEnter:z,onMouseUp:z,constructor:function(a){this._toConnect={};for(var c in a)this[c]===z&&(this._toConnect[c.replace(/^on/,"").toLowerCase()]=a[c],delete a[c])},postCreate:function(){this.inherited(arguments);
for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,c){return this[this._onMap(a)]===z?e.connect(this.domNode,a.toLowerCase(),this,c):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,c){b.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,c)},attr:function(a,c){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,
arguments):this.get(a)},getDescendants:function(){b.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?p("[widgetId]",this.containerNode).map(m.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});q("dijit-legacy-requires")&&v(0,function(){require(["dijit/_base"])});return t})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(t,l,e,r,q,b,u,p,v,m,k,d,f,z,h,a,c,n,E,B,A,y,w){function g(a){return function(c){p[c?"set":"remove"](this.domNode,a,c);this._set(a,c)}}f.add("dijit-legacy-requires",!z.isAsync);f.add("dojo-bidi",!1);f("dijit-legacy-requires")&&c(0,function(){t(["dijit/_base/manager"])});var C={};r=b("dijit._WidgetBase",[n,A],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:g("lang"),dir:"",_setDirAttr:g("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:r.blankGif||t.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var c=a.prototype,g=a._setterAttrs=[],a=a._onMap={},d;for(d in c.attributeMap)g.push(d);for(d in c)/^on/.test(d)&&(a[d.substring(2).toLowerCase()]=d),/^_set[A-Z](.*)Attr$/.test(d)&&(d=d.charAt(4).toLowerCase()+
d.substr(5,d.length-9),c.attributeMap&&d in c.attributeMap||g.push(d))}},postscript:function(a,c){this.create(a,c)},create:function(a,c){this._introspect();this.srcNodeRef=u.byId(c);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,h.mixin(this,a));this.postMixInProperties();this.id||(this.id=w.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=
this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=B.body(this.ownerDocument);w.add(this);this.buildRendering();var g;this.domNode&&(this._applyAttributes(),(a=this.srcNodeRef)&&a.parentNode&&this.domNode!==a&&(a.parentNode.replaceChild(this.domNode,a),g=!0),this.domNode.setAttribute("widgetId",this.id));this.postCreate();g&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},c;for(c in this.params||{})a[c]=this._get(c);l.forEach(this.constructor._setterAttrs,
function(c){if(!(c in a)){var g=this._get(c);g&&this.set(c,g)}},this);for(c in a)this.set(c,a[c])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(l.map(a,function(a){return a+"Rtl"})));v.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,l.forEach(this.getChildren(),function(a){a._started||
a._destroyed||!h.isFunction(a.startup)||(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function c(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();l.forEach(this._connects,h.hitch(this,"disconnect"));l.forEach(this._supportingWidgets,c);this.domNode&&l.forEach(w.findWidgets(this.domNode,this.containerNode),c);this.destroyRendering(a);
w.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?p.remove(this.domNode,"widgetId"):m.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||m.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){l.forEach(this.getChildren(),function(c){c.destroyRecursive&&c.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var c=this.domNode;h.isObject(a)?
d.set(c,a):c.style.cssText=c.style.cssText?c.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,c,g){g=3<=arguments.length?g:this.attributeMap[a];l.forEach(h.isArray(g)?g:[g],function(g){var d=this[g.node||g||"domNode"];switch(g.type||"attribute"){case "attribute":h.isFunction(c)&&(c=h.hitch(this,c));g=g.attribute?g.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;d.tagName?p.set(d,g,c):d.set(g,c);break;case "innerText":d.innerHTML="";d.appendChild(this.ownerDocument.createTextNode(c));
break;case "textContent":d.textContent=c;break;case "innerHTML":d.innerHTML=c;break;case "class":v.replace(d,c,this[a]);break;case "toggleClass":v.toggle(d,g.className||a,c)}},this)},get:function(a){var c=this._getAttrNames(a);return this[c.g]?this[c.g]():this._get(a)},set:function(a,c){if("object"===typeof a){for(var g in a)this.set(g,a[g]);return this}g=this._getAttrNames(a);var d=this[g.s];if(h.isFunction(d))var f=d.apply(this,Array.prototype.slice.call(arguments,1));else{var d=this.focusNode&&
!h.isFunction(this.focusNode)?"focusNode":"domNode",b=this[d]&&this[d].tagName,n;if((n=b)&&!(n=C[b])){n=this[d];var k={},m;for(m in n)k[m.toLowerCase()]=!0;n=C[b]=k}m=n;g=a in this.attributeMap?this.attributeMap[a]:g.s in this?this[g.s]:m&&g.l in m&&"function"!=typeof c||/^aria-|^data-|^role$/.test(a)?d:null;null!=g&&this._attrToDom(a,c,g);this._set(a,c)}return f||this},_attrPairNames:{},_getAttrNames:function(a){var c=this._attrPairNames;if(c[a])return c[a];var g=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-
1).toUpperCase()});return c[a]={n:a+"Node",s:"_set"+g+"Attr",g:"_get"+g+"Attr",l:g.toLowerCase()}},_set:function(a,c){var g=this[a];this[a]=c;!this._created||g===c||g!==g&&c!==c||(this._watchCallbacks&&this._watchCallbacks(a,g,c),this.emit("attrmodified-"+a,{detail:{prevValue:g,newValue:c}}))},_get:function(a){return this[a]},emit:function(c,g,d){g=g||{};void 0===g.bubbles&&(g.bubbles=!0);void 0===g.cancelable&&(g.cancelable=!0);g.detail||(g.detail={});g.detail.widget=this;var h,f=this["on"+c];f&&
(h=f.apply(this,d?d:[g]));this._started&&!this._beingDestroyed&&a.emit(this.domNode,c.toLowerCase(),g);return h},on:function(c,g){var d=this._onMap(c);return d?e.after(this,d,g,!0):this.own(a(this.domNode,c,g))[0]},_onMap:function(a){var c=this.constructor,g=c._onMap;if(!g){var g=c._onMap={},d;for(d in c.prototype)/^on/.test(d)&&(g[d.replace(/^on/,"").toLowerCase()]=d)}return g["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},
getChildren:function(){return this.containerNode?w.findWidgets(this.containerNode):[]},getParent:function(){return w.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,c,g){return this.own(q.connect(a,c,this,g))[0]},disconnect:function(a){a.remove()},subscribe:function(a,c){return this.own(E.subscribe(a,h.hitch(this,c)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():k.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&
"none"!=d.get(this.domNode,"display")},placeAt:function(a,c){var g=!a.tagName&&w.byId(a);!g||!g.addChild||c&&"number"!==typeof c?(a=g&&"domNode"in g?g.containerNode&&!/after|before|replace/.test(c||"")?g.containerNode:g.domNode:u.byId(a,this.ownerDocument),m.place(this.domNode,a,c),!this._started&&(this.getParent()||{})._started&&this.startup()):g.addChild(this,c);return this},defer:function(a,c){var g=setTimeout(h.hitch(this,function(){g&&(g=null,this._destroyed||h.hitch(this,a)())}),c||0);return{remove:function(){g&&
(clearTimeout(g),g=null);return null}}}});f("dojo-bidi")&&r.extend(y);return r})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(t,l,e){return e("dijit.Destroyable",null,{destroy:function(e){this._destroyed=!0},own:function(){var e=["destroyRecursive","destroy","remove"];t.forEach(arguments,function(q){function b(){p.remove();t.forEach(v,function(b){b.remove()})}var u,p=l.before(this,"destroy",function(b){q[u](b)}),v=[];q.then?(u="cancel",q.then(b,
b)):t.forEach(e,function(m){"function"===typeof q[m]&&(u||(u=m),v.push(l.after(q,m,b,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(t,l,e,r,q,b){t=r("dijit._OnDijitClickMixin",null,{connect:function(e,p,l){return this.inherited(arguments,[e,"ondijitclick"==p?b:p,l])}});t.a11yclick=b;return t})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare",
"dojo/_base/lang"],function(t,l,e,r){r.extend(l,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return e("dijit._FocusMixin",null,{_focusManager:t})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(t,l,e,r){e(function(){l("highcontrast")&&t.add(r.body(),"dijit_a11y")});return l})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(t,l,e,r,q,b,u){q.add("highcontrast",function(){var b=u.doc.createElement("div");try{b.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(l.blankGif||t.toUrl("./resources/blank.gif"))+'");';u.body().appendChild(b);var e=r.getComputedStyle(b),m=e.backgroundImage;return e.borderTopColor==e.borderRightColor||m&&("none"==m||"url(invalid-url:)"==m)}catch(k){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
k.toString()),!1}finally{8>=q("ie")?b.outerHTML="":u.body().removeChild(b)}});b(function(){q("highcontrast")&&e.add(u.body(),"dj_a11y")});return q})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(t,l,e,r,q,b,u){b.extend(t,{waiRole:"",waiState:""});return q("dijit._Templated",[l,e],{constructor:function(){u.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(b,e){var m=this.inherited(arguments),k=e(b,"waiRole");k&&b.setAttribute("role",k);(k=e(b,"waiState"))&&r.forEach(k.split(/\s*,\s*/),function(d){-1!=d.indexOf("-")&&(d=d.split("-"),b.setAttribute("aria-"+d[0],d[1]))});return m}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(t,l,e,r,q,b,u,p){var v=l("dijit._TemplatedMixin",p,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(b){var k=this.declaredClass,d=this;return u.substitute(b,this,function(f,b){"!"==b.charAt(0)&&(f=r.getObject(b.substr(1),!1,d));if("undefined"==typeof f)throw Error(k+" template:"+b);return null==f?"":"!"==b.charAt(0)?f:this._escapeValue(""+f)},this)},_escapeValue:function(b){return b.replace(/["'<>&]/g,function(b){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[b]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=t(this.templatePath,{sanitize:!0}));var b=v.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),k;if(r.isString(b)){if(k=e.toDom(this._stringRepl(b),this.ownerDocument),1!=k.nodeType)throw Error("Invalid template: "+b);}else k=b.cloneNode(!0);this.domNode=k}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(b){var k=this.containerNode;if(b&&k)for(;b.hasChildNodes();)k.appendChild(b.firstChild)}});
v._templateCache={};v.getCachedTemplate=function(b,k,d){var f=v._templateCache,m=b,h=f[m];if(h){try{if(!h.ownerDocument||h.ownerDocument==(d||document))return h}catch(a){}e.destroy(h)}b=u.trim(b);if(k||b.match(/\$\{([^\}]+)\}/g))return f[m]=b;k=e.toDom(b,d);if(1!=k.nodeType)throw Error("Invalid template: "+b);return f[m]=k};b("ie")&&q(window,"unload",function(){var b=v._templateCache,k;for(k in b){var d=b[k];"object"==typeof d&&e.destroy(d);delete b[k]}});return v})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(t){return t.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(t,l,e,r,q,b,u,p,v){var m=q.delegate(p,{mouseenter:b.enter,mouseleave:b.leave,keypress:e._keypress}),k;e=r("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(d){for(var f=d;;)if(1==f.nodeType&&(this._processTemplateNode(f,function(d,h){return d.getAttribute(h)},this._attach)||this.searchContainerNode)&&f.firstChild)f=f.firstChild;else{if(f==d)break;for(;!f.nextSibling;)if(f=f.parentNode,f==d)return;f=f.nextSibling}},_processTemplateNode:function(d,f,b){var h=!0,a=this.attachScope||this,c=f(d,"dojoAttachPoint")||f(d,"data-dojo-attach-point");if(c)for(var n=c.split(/\s*,\s*/);c=
n.shift();)q.isArray(a[c])?a[c].push(d):a[c]=d,h="containerNode"!=c,this._attachPoints.push(c);if(f=f(d,"dojoAttachEvent")||f(d,"data-dojo-attach-event"))for(c=f.split(/\s*,\s*/),n=q.trim;f=c.shift();)if(f){var k=null;-1!=f.indexOf(":")?(k=f.split(":"),f=n(k[0]),k=n(k[1])):f=n(f);k||(k=f);this._attachEvents.push(b(d,f,q.hitch(a,k)))}return h},_attach:function(d,f,b){f=f.replace(/^on/,"").toLowerCase();f="dijitclick"==f?k||(k=t("./a11yclick")):m[f]||f;return u(d,f,b)},_detachTemplateNodes:function(){var d=
this.attachScope||this;l.forEach(this._attachPoints,function(f){delete d[f]});this._attachPoints=[];l.forEach(this._attachEvents,function(d){d.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});q.extend(v,{dojoAttachEvent:"",dojoAttachPoint:""});return e})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(t,l,e,r,q){return e("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var b=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);q.parse(b,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(r.hitch(this,function(b){this._startupWidgets=b;for(var e=0;e<b.length;e++)this._processTemplateNode(b[e],
function(b,e){return b[e]},function(b,e,k){return e in b?b.connect(b,e,k):b.on(e,k,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(b,e,p){return e(b,"dojoType")||e(b,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){t.forEach(this._startupWidgets,function(b){b&&!b._started&&b.startup&&b.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(t,l,e,r,q,b,u,p,v,m,k,d,f,z,h,a){function c(a){return eval("("+a+")")}function n(a){var c=
a._nameCaseMap,g=a.prototype;if(!c||c._extendCnt<B){var c=a._nameCaseMap={},d;for(d in g)"_"!==d.charAt(0)&&(c[d.toLowerCase()]=d);c._extendCnt=B}return c}function E(a,c){c||(c=t);var g=c._dojoParserCtorMap||(c._dojoParserCtorMap={}),d=a.join();if(!g[d]){for(var h=[],b=0,f=a.length;b<f;b++){var n=a[b];h[h.length]=g[n]=g[n]||e.getObject(n)||~n.indexOf("/")&&c(n)}a=h.shift();g[d]=h.length?a.createSubclass?a.createSubclass(h):a.extend.apply(a,h):a}return g[d]}new Date("X");var B=0;v.after(e,"extend",
function(){B++},!0);var A={_clearCache:function(){B++;_ctorMap={}},_functionFromScript:function(a,c){var g="",d="",h=a.getAttribute(c+"args")||a.getAttribute("args");c=a.getAttribute("with");h=(h||"").split(/\s*,\s*/);c&&c.length&&r.forEach(c.split(/\s*,\s*/),function(a){g+="with("+a+"){";d+="}"});return new Function(h,g+a.innerHTML+d)},instantiate:function(a,c,g){c=c||{};g=g||{};var d=(g.scope||l._scopeName)+"Type",h="data-"+(g.scope||l._scopeName)+"-",b=h+"type",f=h+"mixins",n=[];r.forEach(a,function(a){var g=
d in c?c[d]:a.getAttribute(b)||a.getAttribute(d);if(g){var h=a.getAttribute(f),g=h?[g].concat(h.split(/\s*,\s*/)):[g];n.push({node:a,types:g})}});return this._instantiate(n,c,g)},_instantiate:function(a,c,g,d){function h(a){c._started||g.noStart||r.forEach(a,function(a){"function"!==typeof a.startup||a._started||a.startup()});return a}a=r.map(a,function(a){var d=a.ctor||E(a.types,g.contextRequire);if(!d)throw Error("Unable to resolve constructor for: '"+a.types.join()+"'");return this.construct(d,
a.node,c,g,a.scripts,a.inherited)},this);return d?m(a).then(h):h(a)},construct:function(a,d,g,b,m,E){function w(a){t&&e.setObject(t,a);for(x=0;x<P.length;x++)v[P[x].advice||"after"](a,P[x].method,e.hitch(a,P[x].func),!0);for(x=0;x<V.length;x++)V[x].call(a);for(x=0;x<R.length;x++)a.watch(R[x].prop,R[x].func);for(x=0;x<S.length;x++)h(a,S[x].event,S[x].func);return a}var C=a&&a.prototype;b=b||{};var B={};b.defaults&&e.mixin(B,b.defaults);E&&e.mixin(B,E);var u;f("dom-attributes-explicit")?u=d.attributes:
f("dom-attributes-specified-flag")?u=r.filter(d.attributes,function(a){return a.specified}):(E=(/^input$|^img$/i.test(d.nodeName)?d:d.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),u=r.map(E.split(/\s+/),function(a){var c=a.toLowerCase();return{name:a,value:"LI"==d.nodeName&&"value"==a||"enctype"==c?d.getAttribute(c):d.getAttributeNode(c).value}}));var q=b.scope||l._scopeName;E="data-"+q+"-";var A={};"dojo"!==q&&(A[E+"props"]=
"data-dojo-props",A[E+"type"]="data-dojo-type",A[E+"mixins"]="data-dojo-mixins",A[q+"type"]="dojotype",A[E+"id"]="data-dojo-id");for(var x=0,y,q=[],t,J;y=u[x++];){var L=y.name,Q=L.toLowerCase();y=y.value;switch(A[Q]||Q){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":J=y;break;case "data-dojo-id":case "jsid":t=y;break;case "data-dojo-attach-point":case "dojoattachpoint":B.dojoAttachPoint=y;break;case "data-dojo-attach-event":case "dojoattachevent":B.dojoAttachEvent=
y;break;case "class":B["class"]=d.className;break;case "style":B.style=d.style&&d.style.cssText;break;default:if(L in C||(L=n(a)[Q]||L),L in C)switch(typeof C[L]){case "string":B[L]=y;break;case "number":B[L]=y.length?Number(y):NaN;break;case "boolean":B[L]="false"!=y.toLowerCase();break;case "function":""===y||-1!=y.search(/[^\w\.]+/i)?B[L]=new Function(y):B[L]=e.getObject(y,!1)||new Function(y);q.push(L);break;default:Q=C[L],B[L]=Q&&"length"in Q?y?y.split(/\s*,\s*/):[]:Q instanceof Date?""==y?new Date(""):
"now"==y?new Date:k.fromISOString(y):Q instanceof p?l.baseUrl+y:c(y)}else B[L]=y}}for(u=0;u<q.length;u++)A=q[u].toLowerCase(),d.removeAttribute(A),d[A]=null;if(J)try{J=c.call(b.propsThis,"{"+J+"}"),e.mixin(B,J)}catch(ca){throw Error(ca.toString()+" in data-dojo-props\x3d'"+J+"'");}e.mixin(B,g);m||(m=a&&(a._noScript||C._noScript)?[]:z("\x3e script[type^\x3d'dojo/']",d));var P=[],V=[],R=[],S=[];if(m)for(x=0;x<m.length;x++)A=m[x],d.removeChild(A),g=A.getAttribute(E+"event")||A.getAttribute("event"),
b=A.getAttribute(E+"prop"),J=A.getAttribute(E+"method"),q=A.getAttribute(E+"advice"),u=A.getAttribute("type"),A=this._functionFromScript(A,E),g?"dojo/connect"==u?P.push({method:g,func:A}):"dojo/on"==u?S.push({event:g,func:A}):B[g]=A:"dojo/aspect"==u?P.push({method:J,advice:q,func:A}):"dojo/watch"==u?R.push({prop:b,func:A}):V.push(A);a=(m=a.markupFactory||C.markupFactory)?m(B,d,a):new a(B,d);return a.then?a.then(w):w(a)},scan:function(a,c){function g(a){if(!a.inherited){a.inherited={};var c=a.node,
d=g(a.parent),c={dir:c.getAttribute("dir")||d.dir,lang:c.getAttribute("lang")||d.lang,textDir:c.getAttribute(B)||d.textDir},h;for(h in c)c[h]&&(a.inherited[h]=c[h])}return a.inherited}var h=[],b=[],n={},k=(c.scope||l._scopeName)+"Type",e="data-"+(c.scope||l._scopeName)+"-",m=e+"type",B=e+"textdir",e=e+"mixins",p=a.firstChild,w=c.inherited;if(!w){var u=function(a,c){return a.getAttribute&&a.getAttribute(c)||a.parentNode&&u(a.parentNode,c)},w={dir:u(a,"dir"),lang:u(a,"lang"),textDir:u(a,B)},A;for(A in w)w[A]||
delete w[A]}A={inherited:w};for(var q,y;;)if(p)if(1!=p.nodeType)p=p.nextSibling;else if(q&&"script"==p.nodeName.toLowerCase())(w=p.getAttribute("type"))&&/^dojo\/\w/i.test(w)&&q.push(p),p=p.nextSibling;else if(y)p=p.nextSibling;else if(w=p.getAttribute(m)||p.getAttribute(k),a=p.firstChild,w||a&&(3!=a.nodeType||a.nextSibling)){y=null;if(w){var v=p.getAttribute(e);q=v?[w].concat(v.split(/\s*,\s*/)):[w];try{y=E(q,c.contextRequire)}catch(P){}y||r.forEach(q,function(a){~a.indexOf("/")&&!n[a]&&(n[a]=!0,
b[b.length]=a)});v=y&&!y.prototype._noScript?[]:null;A={types:q,ctor:y,parent:A,node:p,scripts:v};A.inherited=g(A);h.push(A)}else A={node:p,scripts:q,parent:A};q=v;y=p.stopParser||y&&y.prototype.stopParser&&!c.template;p=a}else p=p.nextSibling;else{if(!A||!A.node)break;p=A.node.nextSibling;y=!1;A=A.parent;q=A.scripts}var z=new d;b.length?(f("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+b.join(", ")),(c.contextRequire||t)(b,function(){z.resolve(r.filter(h,function(a){if(!a.ctor)try{a.ctor=
E(a.types,c.contextRequire)}catch(S){}for(var g=a.parent;g&&!g.types;)g=g.parent;var d=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(d&&d.stopParser&&!c.template);a.instantiate=!g||g.instantiate&&g.instantiateChildren;return a.instantiate}))})):z.resolve(h);return z.promise},_require:function(a,h){a=c("{"+a.innerHTML+"}");var g=[],b=[],f=new d;h=h&&h.contextRequire||t;for(var n in a)g.push(n),b.push(a[n]);h(b,function(){for(var a=0;a<g.length;a++)e.setObject(g[a],arguments[a]);f.resolve(arguments)});
return f.promise},_scanAmd:function(a,c){var g=new d,h=g.promise;g.resolve(!0);var b=this;z("script[type\x3d'dojo/require']",a).forEach(function(a){h=h.then(function(){return b._require(a,c)});a.parentNode.removeChild(a)});return h},parse:function(a,c){!a||"string"==typeof a||"nodeType"in a||(c=a,a=c.rootNode);var g=a?b.byId(a):u.body();c=c||{};var d=c.template?{template:!0}:{},h=[],f=this;a=this._scanAmd(g,c).then(function(){return f.scan(g,c)}).then(function(a){return f._instantiate(a,d,c,!0)}).then(function(a){return h=
h.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});e.mixin(h,a);return h}};l.parser=A;q.parseOnLoad&&a(100,A,"parse");return A})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(t,l){var e={};t.setObject("dojo.date.stamp",e);e.fromISOString=function(r,q){e._isoRegExp||(e._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var b=e._isoRegExp.exec(r);r=null;
if(b){b.shift();b[1]&&b[1]--;b[6]&&(b[6]*=1E3);q&&(q=new Date(q),l.forEach(l.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(b){return q["get"+b]()}),function(e,m){b[m]=b[m]||e}));r=new Date(b[0]||1970,b[1]||0,b[2]||1,b[3]||0,b[4]||0,b[5]||0,b[6]||0);100>b[0]&&r.setFullYear(b[0]||1970);var u=0,p=b[7]&&b[7].charAt(0);"Z"!=p&&(u=60*(b[8]||0)+(Number(b[9])||0),"-"!=p&&(u*=-1));p&&(u-=r.getTimezoneOffset());u&&r.setTime(r.getTime()+6E4*u)}return r};e.toISOString=function(e,
q){var b=function(b){return 10>b?"0"+b:b};q=q||{};var u=[],p=q.zulu?"getUTC":"get",l="";"time"!=q.selector&&(l=e[p+"FullYear"](),l=["0000".substr((l+"").length)+l,b(e[p+"Month"]()+1),b(e[p+"Date"]())].join("-"));u.push(l);"date"!=q.selector&&(l=[b(e[p+"Hours"]()),b(e[p+"Minutes"]()),b(e[p+"Seconds"]())].join(":"),p=e[p+"Milliseconds"](),q.milliseconds&&(l+="."+(100>p?"0":"")+b(p)),q.zulu?l+="Z":"time"!=q.selector&&(e=e.getTimezoneOffset(),q=Math.abs(e),l+=(0<e?"-":"+")+b(Math.floor(q/60))+":"+b(q%
60)),u.push(l));return u.join("T")};return e})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(t,l,e,r,q,b){return t([b,q],{_onMap:function(b){var e=this.constructor._onMap,u;e&&e.FINAL||(delete this.constructor._onMap,e=this.registerConnectEvents(),e.FINAL=!0);b=b.toLowerCase();e[b]?u=this[e[b].method]:(b=this._onCamelCase(b),this[b]&&(u=b));return u},on:function(b,e){var p=this._onMap(b),m=b.replace(/\-/g,
""),k="on"+m in this.domNode;return p||!k?this.inherited(arguments):this.own(r(this.domNode,m,e))[0]},emit:function(b,e,q){var m,k,d,f=b.toLowerCase(),p=this.constructor._onMap||this.registerConnectEvents();k=this[this._onMap(f)];e=e||{};e.target||(e.target=this);k&&p&&p[f]&&(this._onObj2Arr(function(){m=Array.prototype.slice.call(arguments)},p[f].argKeys)(e),d=l.mixin({},arguments),d[2]=m,d[0]=p[f].name.replace(/^on/,""));return this.inherited(d||arguments)}})})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ./Task ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/jsonUtils".split(" "),
function(t,l,e,r,q,b,u,p,v,m,k,d,f,z,h){t=t(m,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"densify-complete":["geometries"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],
"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(a){a=l.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=
a(this,this._lengthsHandler);this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);
this._trimExtendHandler=a(this,this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=a(this,this._distanceHandler);this._toGeoCoordinateHandler=a(this,this._toGeoCoordinateHandler);this._fromGeoCoordinateHandler=a(this,this._fromGeoCoordinateHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var c=[],d,b=a.length;for(d=0;d<b;d++)c.push(a[d].toJson());
return{geometryType:h.getJsonType(a[0]),geometries:c}},_decodeGeometries:function(a,c,d){var b=h.getGeometryType(c);a=a.geometries;var f=[],n={spatialReference:d.toJson()},k=l.mixin;e.forEach(a,function(a,c){f[c]=new b(k(a,n))});return f},_toProjectGeometry:function(a){var c=a.spatialReference.toJson();return a instanceof k?new f({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:c}):new d({paths:[[].concat(a.points)],spatialReference:c})},
_fromProjectedGeometry:function(a,c,d){return"esriGeometryEnvelope"===c?(a=a.rings[0],new k(a[0][0],a[0][1],a[2][0],a[2][1],d)):new z({points:a.paths[0],spatialReference:d.toJson()})},project:function(a,c,d,b){var f=l.mixin({},this._url.query,{f:"json"}),n;a.geometries?(b=d,d=c,c=a.outSR,n=a.geometries[0],f=l.mixin(f,a.toJson())):(n=a[0],f=l.mixin(f,{outSR:c.wkid||r.toJson(c.toJson()),inSR:n.spatialReference.wkid||r.toJson(n.spatialReference.toJson()),geometries:r.toJson(this._encodeGeometries(a))}));
var e=h.getJsonType(n),k=this._projectHandler,g=this._errorHandler,m=new q(v._dfdCanceller);m._pendingDfd=p({url:this._url.path+"/project",content:f,callbackParamName:"callback",load:function(a,g){k(a,g,e,c,d,b,m)},error:function(a){g(a,b,m)}});return m},_projectHandler:function(a,c,d,h,b,f,e){try{var n=this._decodeGeometries(a,d,h);this._successHandler([n],"onProjectComplete",b,e)}catch(g){this._errorHandler(g,f,e)}},onProjectComplete:function(){},simplify:function(a,c,d){var b=a[0].spatialReference,
f=l.mixin({},this._url.query,{f:"json",sr:b.wkid?b.wkid:r.toJson(b.toJson()),geometries:r.toJson(this._encodeGeometries(a))}),n=h.getJsonType(a[0]),e=this._simplifyHandler,k=this._errorHandler,g=new q(v._dfdCanceller);g._pendingDfd=p({url:this._url.path+"/simplify",content:f,callbackParamName:"callback",load:function(a,h){e(a,h,n,b,c,d,g)},error:function(a){k(a,d,g)}});return g},_simplifyHandler:function(a,c,d,h,b,f,e){try{var n=this._decodeGeometries(a,d,h);this._successHandler([n],"onSimplifyComplete",
b,e)}catch(g){this._errorHandler(g,f,e)}},onSimplifyComplete:function(){},convexHull:function(a,c,d){var h=a[0].spatialReference;a=l.mixin({},this._url.query,{f:"json",sr:r.toJson(h.toJson()),geometries:r.toJson(this._encodeGeometries(a))});var b=this._convexHullHandler,f=this._errorHandler,n=new q(v._dfdCanceller);n._pendingDfd=p({url:this._url.path+"/convexHull",content:a,callbackParamName:"callback",load:function(a,g){b(a,g,h,c,d,n)},error:function(a){f(a,d,n)}});return n},_convexHullHandler:function(a,
c,d,b,f,e){try{var n=h.fromJson(a.geometry).setSpatialReference(d);this._successHandler([n],"onConvexHullComplete",b,e)}catch(w){this._errorHandler(w,f,e)}},onConvexHullComplete:function(){},union:function(a,c,d){var h=a[0].spatialReference;a=l.mixin({},this._url.query,{f:"json",sr:r.toJson(h.toJson()),geometries:r.toJson(this._encodeGeometries(a))});var b=this._unionHandler,f=this._errorHandler,n=new q(v._dfdCanceller);n._pendingDfd=p({url:this._url.path+"/union",content:a,callbackParamName:"callback",
load:function(a,g){b(a,g,h,c,d,n)},error:function(a){f(a,d,n)}});return n},_unionHandler:function(a,c,d,b,f,e){try{var n=h.fromJson(a.geometry).setSpatialReference(d);this._successHandler([n],"onUnionComplete",b,e)}catch(w){this._errorHandler(w,f,e)}},onUnionComplete:function(){},autoComplete:function(a,c,d,h){var b=a[0].spatialReference;a=l.mixin({},this._url.query,{f:"json",sr:r.toJson(b.toJson()),polygons:r.toJson(this._encodeGeometries(a).geometries),polylines:r.toJson(this._encodeGeometries(c).geometries)});
var f=this._autoCompleteHandler,n=this._errorHandler,e=new q(v._dfdCanceller);e._pendingDfd=p({url:this._url.path+"/autoComplete",content:a,callbackParamName:"callback",load:function(a,c){f(a,c,b,d,h,e)},error:function(a){n(a,h,e)}});return e},_autoCompleteHandler:function(a,c,d,h,b,e){try{var n=a.geometries;a=[];var k,g=n.length;for(k=0;k<g;k++)a[k]=new f({spatialReference:d,rings:n[k].rings});this._successHandler([a],"onAutoCompleteComplete",h,e)}catch(C){this._errorHandler(C,b,e)}},onAutoCompleteComplete:function(){},
reshape:function(a,c,d,b){var f=a.spatialReference;a=l.mixin({},this._url.query,{f:"json",sr:r.toJson(f.toJson()),target:r.toJson({geometryType:h.getJsonType(a),geometry:a.toJson()}),reshaper:r.toJson(c.toJson())});var n=this._reshapeHandler,e=this._errorHandler,k=new q(v._dfdCanceller);k._pendingDfd=p({url:this._url.path+"/reshape",content:a,callbackParamName:"callback",load:function(a,c){n(a,c,f,d,b,k)},error:function(a){e(a,b,k)}});return k},_reshapeHandler:function(a,c,d,b,f,e){try{var n=h.fromJson(a.geometry).setSpatialReference(d);
this._successHandler([n],"onReshapeComplete",b,e)}catch(w){this._errorHandler(w,f,e)}},onReshapeComplete:function(){},cut:function(a,c,d,b){var f=a[0].spatialReference,n=e.map(a,function(a){return a.toJson()});a=l.mixin({},this._url.query,{f:"json",sr:r.toJson(f.toJson()),target:r.toJson({geometryType:h.getJsonType(a[0]),geometries:n}),cutter:r.toJson(c.toJson())});var k=this._cutHandler,m=this._errorHandler,g=new q(v._dfdCanceller);g._pendingDfd=p({url:this._url.path+"/cut",content:a,callbackParamName:"callback",
load:function(a,c){k(a,c,f,d,b,g)},error:function(a){m(a,b,g)}});return g},_cutHandler:function(a,c,d,b,f,k){try{var n=a.geometries,m={};m.cutIndexes=a.cutIndexes;m.geometries=[];e.forEach(n,function(a){m.geometries.push(h.fromJson(a).setSpatialReference(d))});this._successHandler([m],"onCutComplete",b,k)}catch(g){this._errorHandler(g,f,k)}},onCutComplete:function(){},intersect:function(a,c,d,b){var f=a[0].spatialReference;a=l.mixin({},this._url.query,{f:"json",sr:r.toJson(f.toJson()),geometries:r.toJson(this._encodeGeometries(a)),
geometry:r.toJson({geometryType:h.getJsonType(c),geometry:c.toJson()})});var n=this._intersectHandler,e=this._errorHandler,k=new q(v._dfdCanceller);k._pendingDfd=p({url:this._url.path+"/intersect",content:a,callbackParamName:"callback",load:function(a,c){n(a,c,f,d,b,k)},error:function(a){e(a,b,k)}});return k},_intersectHandler:function(a,c,d,b,f,k){try{var n=[];e.forEach(a.geometries,function(a){n.push(h.fromJson(a).setSpatialReference(d))});this._successHandler([n],"onIntersectComplete",b,k)}catch(w){this._errorHandler(w,
f,k)}},onIntersectComplete:function(){},difference:function(a,c,d,b){var f=a[0].spatialReference;a=l.mixin({},this._url.query,{f:"json",sr:r.toJson(f.toJson()),geometries:r.toJson(this._encodeGeometries(a)),geometry:r.toJson({geometryType:h.getJsonType(c),geometry:c.toJson()})});var n=this._differenceHandler,e=this._errorHandler,k=new q(v._dfdCanceller);k._pendingDfd=p({url:this._url.path+"/difference",content:a,callbackParamName:"callback",load:function(a,c){n(a,c,f,d,b,k)},error:function(a){e(a,
b,k)}});return k},_differenceHandler:function(a,c,d,b,f,k){try{var n=[];e.forEach(a.geometries,function(a){n.push(h.fromJson(a).setSpatialReference(d))});this._successHandler([n],"onDifferenceComplete",b,k)}catch(w){this._errorHandler(w,f,k)}},onDifferenceComplete:function(){},buffer:function(a,c,d){var b=l.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.outSpatialReference||a.geometries[0].spatialReference,f=this._bufferHandler,n=this._errorHandler,e=new q(v._dfdCanceller);e._pendingDfd=p({url:this._url.path+
"/buffer",content:b,callbackParamName:"callback",load:function(a,b){f(a,b,h,c,d,e)},error:function(a){n(a,d,e)}});return e},_bufferHandler:function(a,c,d,b,h,e){try{var n=a.geometries;a=[];var k,g=n.length;for(k=0;k<g;k++)a[k]=new f({spatialReference:d,rings:n[k].rings});this._successHandler([a],"onBufferComplete",b,e)}catch(C){this._errorHandler(C,h,e)}},onBufferComplete:function(){},areasAndLengths:function(a,c,d){a=l.mixin({},this._url.query,{f:"json"},a.toJson());var b=this._areasAndLengthsHandler,
h=this._errorHandler,f=new q(v._dfdCanceller);f._pendingDfd=p({url:this._url.path+"/areasAndLengths",content:a,callbackParamName:"callback",load:function(a,h){b(a,h,c,d,f)},error:function(a){h(a,d,f)}});return f},_areasAndLengthsHandler:function(a,c,d,b,h){try{this._successHandler([a],"onAreasAndLengthsComplete",d,h)}catch(A){this._errorHandler(A,b,h)}},onAreasAndLengthsComplete:function(){},lengths:function(a,c,d){a=l.mixin({},this._url.query,{f:"json"},a.toJson());var b=this._lengthsHandler,h=this._errorHandler,
f=new q(v._dfdCanceller);f._pendingDfd=p({url:this._url.path+"/lengths",content:a,callbackParamName:"callback",load:function(a,h){b(a,h,c,d,f)},error:function(a){h(a,d,f)}});return f},_lengthsHandler:function(a,c,d,b,h){try{this._successHandler([a],"onLengthsComplete",d,h)}catch(A){this._errorHandler(A,b,h)}},onLengthsComplete:function(){},labelPoints:function(a,c,d){var b=e.map(a,function(a){return a.toJson()}),h=a[0].spatialReference,b=l.mixin({},this._url.query,{f:"json",sr:h.wkid?h.wkid:r.toJson(h.toJson()),
polygons:r.toJson(b)}),f=this._labelPointsHandler,k=this._errorHandler,n=new q(v._dfdCanceller);n._pendingDfd=p({url:this._url.path+"/labelPoints",content:b,callbackParamName:"callback",load:function(g,b){f(g,b,a,h,c,d,n)},error:function(a){k(a,d,n)}});return n},_labelPointsHandler:function(a,c,d,b,f,k,m){try{var n=[];e.forEach(a.labelPoints,function(a){n.push(h.fromJson(a).setSpatialReference(b))});this._successHandler([n],"onLabelPointsComplete",f,m)}catch(g){this._errorHandler(g,k,m)}},onLabelPointsComplete:function(){},
relation:function(a,c,d){a=l.mixin({},this._url.query,{f:"json"},a.toJson());var b=this._relationHandler,h=this._errorHandler,f=new q(v._dfdCanceller);f._pendingDfd=p({url:this._url.path+"/relation",content:a,callbackParamName:"callback",load:function(a,h){b(a,h,c,d,f)},error:function(a){h(a,d,f)}});return f},_relationHandler:function(a,c,d,b,h){try{this._successHandler([a.relations],"onRelationComplete",d,h)}catch(A){this._errorHandler(A,b,h)}},onRelationComplete:function(){},trimExtend:function(a,
c,d){var b=l.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.sr,f=this._trimExtendHandler,k=this._errorHandler,e=new q(v._dfdCanceller);e._pendingDfd=p({url:this._url.path+"/trimExtend",content:b,callbackParamName:"callback",load:function(a,b){f(a,b,h,c,d,e)},error:function(a){k(a,d,e)}});return e},_trimExtendHandler:function(a,c,b,h,f,e){try{var k=a.geometries;a=[];var n,g=k.length;for(n=0;n<g;n++)a[n]=new d({spatialReference:b,paths:k[n].paths});this._successHandler([a],"onTrimExtendComplete",
h,e)}catch(C){this._errorHandler(C,f,e)}},onTrimExtendComplete:function(){},densify:function(a,c,d){var b=l.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.geometries[0].spatialReference,f=this._densifyHandler,e=this._errorHandler,k=new q(v._dfdCanceller);k._pendingDfd=p({url:this._url.path+"/densify",content:b,callbackParamName:"callback",load:function(a,b){f(a,b,h,c,d,k)},error:function(a){e(a,d,k)}});return k},_densifyHandler:function(a,c,d,b,f,k){try{var n=[];e.forEach(a.geometries,function(a){n.push(h.fromJson(a).setSpatialReference(d))});
this._successHandler([n],"onDensifyComplete",b,k)}catch(w){this._errorHandler(w,f,k)}},onDensifyComplete:function(){},generalize:function(a,c,d){var b=l.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.geometries[0].spatialReference,f=this._generalizeHandler,k=this._errorHandler,e=new q(v._dfdCanceller);e._pendingDfd=p({url:this._url.path+"/generalize",content:b,callbackParamName:"callback",load:function(a,b){f(a,b,h,c,d,e)},error:function(a){k(a,d,e)}});return e},_generalizeHandler:function(a,
c,d,b,f,k){try{var n=[];e.forEach(a.geometries,function(a){n.push(h.fromJson(a).setSpatialReference(d))});this._successHandler([n],"onGeneralizeComplete",b,k)}catch(w){this._errorHandler(w,f,k)}},onGeneralizeComplete:function(){},offset:function(a,c,d){var b=l.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.geometries[0].spatialReference,f=this._offsetHandler,k=this._errorHandler,e=new q(v._dfdCanceller);e._pendingDfd=p({url:this._url.path+"/offset",content:b,callbackParamName:"callback",load:function(a,
b){f(a,b,h,c,d,e)},error:function(a){k(a,d,e)}});return e},_offsetHandler:function(a,c,d,b,f,k){try{var n=[];e.forEach(a.geometries,function(a){n.push(h.fromJson(a).setSpatialReference(d))});this._successHandler([n],"onOffsetComplete",b,k)}catch(w){this._errorHandler(w,f,k)}},onOffsetComplete:function(){},distance:function(a,c,d){var b=l.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.geometry1.spatialReference,f=this._distanceHandler,k=this._errorHandler,e=new q(v._dfdCanceller);e._pendingDfd=
p({url:this._url.path+"/distance",content:b,callbackParamName:"callback",load:function(a,b){f(a,b,h,c,d,e)},error:function(a){k(a,d,e)}});return e},_distanceHandler:function(a,c,d,b,h,f){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",b,f)}catch(y){this._errorHandler(y,h,f)}},onDistanceComplete:function(){},toGeoCoordinateString:function(a,c,d){var b={};l.isObject(a.sr)?b.sr=a.sr.wkid||r.toJson(a.sr.toJson()):b.sr=a.sr;b.coordinates=r.toJson(a.coordinates);b.conversionType=a.conversionType||
"MGRS";b.conversionMode=a.conversionMode;b.numOfDigits=a.numOfDigits;b.rounding=a.rounding;b.addSpaces=a.addSpaces;a=l.mixin({},this._url.query,{f:"json"},b);var h=this._toGeoCoordinateHandler,f=this._errorHandler,k=new q(v._dfdCanceller);k._pendingDfd=p({url:this._url.path+"/toGeoCoordinateString",content:a,callbackParamName:"callback",load:function(a,g){h(a,g,c,d,k)},error:function(a){f(a,d,k)}});return k},_toGeoCoordinateHandler:function(a,c,d,b,h){try{this._successHandler([a.strings],"onToGeoCoordinateStringComplete",
d,h)}catch(A){this._errorHandler(A,b,h)}},onToGeoCoordinateStringComplete:function(){},fromGeoCoordinateString:function(a,c,d){var b={};l.isObject(a.sr)?b.sr=a.sr.wkid||r.toJson(a.sr.toJson()):b.sr=a.sr;b.strings=r.toJson(a.strings);b.conversionType=a.conversionType||"MGRS";b.conversionMode=a.conversionMode;a=l.mixin({},this._url.query,{f:"json"},b);var h=this._fromGeoCoordinateHandler,f=this._errorHandler,k=new q(v._dfdCanceller);k._pendingDfd=p({url:this._url.path+"/fromGeoCoordinateString",content:a,
callbackParamName:"callback",load:function(a,g){h(a,g,c,d,k)},error:function(a){f(a,d,k)}});return k},_fromGeoCoordinateHandler:function(a,c,d,b,h){try{this._successHandler([a.coordinates],"onToGeoCoordinateStringComplete",d,h)}catch(A){this._errorHandler(A,b,h)}},onFromGeoCoordinateStringComplete:function(){}});l.mixin(t,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});b("extend-esri")&&l.setObject("tasks.GeometryService",t,u);return t})},"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/promise/all ../sniff ../kernel ../lang ../request ../config ../deferredUtils ../promiseList ../SpatialReference ../urlUtils ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../support/expressionUtils ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./TimeReference ./FeatureType ./FeatureTemplate ./FeatureEditResult ./LabelClass ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./TrackManager ./HeatmapManager ./clustering/ClusterManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),
function(t,l,e,r,q,b,u,p,v,m,k,d,f,z,h,a,c,n,E,B,A,y,w,g,C,x,J,H,K,aa,I,fa,U,X,ga,ha,ba,L,Q,P,V,R,S,ca,oa,N,ia,Y,ja,xa,ka,da,la,ma,na){var pa=E.defaults,qa=!!h("esri-pbf"),ra=!!h("esri-featurelayer-pbf"),G=e(P,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reHostedFS:/(https?:)?\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],
"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(a,c){this._preventInit||this._initFeatureLayer(a,c)},_initFeatureLayer:function(a,
d){this.i18n=na;d=d||{};this._featureReduction=this._featureReduction||d.featureReduction;this._featureReductionEnabled=null!=d.featureReductionEnabled?d.featureReductionEnabled:!0;this.showLabels=null!=d.showLabels?d.showLabels:!0;this._outFields=d.outFields;this._defnExpr=d.definitionExpression;this._loadCallback=d.loadCallback;this._trackIdField=d.trackIdField;this.objectIdField=d.objectIdField;this._maxOffset=this._optMaxOffset=null!=d.maxAllowableOffset?d.maxAllowableOffset:this.maxAllowableOffset;
this.quantize=null!=d.quantize?d.quantize:!0;this._optEditable=d.editable;this._optAutoGen=d.autoGeneralize;this.editSummaryCallback=d.editSummaryCallback;this.userId=d.userId;this.userIsAdmin=d.userIsAdmin;this.useMapTime=d.hasOwnProperty("useMapTime")?!!d.useMapTime:!0;this.source=d.source;this.gdbVersion=d.gdbVersion;this.orderByFields=d.orderByFields;this.maxPointCountForAuto=null!=d.maxPointCountForAuto?d.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=d.maxRecordCountForAuto?
d.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=d.maxVertexCountForAuto?d.maxVertexCountForAuto:this.maxVertexCountForAuto;this.generalizeForScale=null!=d.generalizeForScale?d.generalizeForScale:this.generalizeForScale;this.queryPagination=this._optQueryPagination=null!=d.queryPagination?d.queryPagination:!0;this.multipatchOption=d.multipatchOption;this._selectedFeatures={};this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var F=c.isDefined(d.mode)?
d.mode:G.MODE_ONDEMAND;this._isStream&&(F=G.MODE_STREAM);this.mode=F;switch(F){case G.MODE_SNAPSHOT:this.currentMode=G.MODE_SNAPSHOT;this._mode=new Y(this);break;case G.MODE_ONDEMAND:case G.MODE_AUTO:this.currentMode=G.MODE_ONDEMAND;this._tileWidth=d.tileWidth||512;this._tileHeight=d.tileHeight||512;this._mode=new ja(this);this.latticeTiling=d.latticeTiling;break;case G.MODE_SELECTION:this.currentMode=G.MODE_SELECTION;this._mode=new xa(this);this._isSelOnly=!0;break;case G.MODE_STREAM:this.currentMode=
G.MODE_STREAM,this._mode=new ka(this),this._isStream=!0}this._initLayer=q.hitch(this,this._initLayer);this._selectHandler=q.hitch(this,this._selectHandler);this._editable=!1;if(q.isObject(a)&&a.layerDefinition)return this._collection=!0,this.mode=this._isStream?G.MODE_STREAM:G.MODE_SNAPSHOT,this._isStream||this._outFields||(this._outFields=["*"]),this._initLayer(a),this;this._task=new fa(this.url,{source:this.source,gdbVersion:this.gdbVersion});a=this._url.path;this._fserver=!1;-1!==a.search(/\/FeatureServer\//i)&&
(this._fserver=!0);this._checkFeatureLimit();(d=d.resourceInfo)?this._initLayer(d):(this.source&&(d={source:this.source.toJson()},this._url.query=q.mixin(this._url.query,{layer:u.toJson(d)})),this.gdbVersion&&(this._url.query=q.mixin(this._url.query,{gdbVersion:this.gdbVersion})),n({url:a,content:q.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));this.registerConnectEvents()},_initLayer:function(a,d){if(a||d){this._json=a;this._findCredential();
if(this.credential&&this.credential.ssl||a&&a._ssl)this._useSSL(),this._task._useSSL();this.version=a.currentVersion;this.version||(this.version="capabilities"in a||"drawingInfo"in a||"hasAttachments"in a||"htmlPopupType"in a||"relationships"in a||"timeInfo"in a||"typeIdField"in a||"types"in a?10:9.3);this._collection&&(this._isStream||(this.currentMode=G.MODE_SNAPSHOT,this._mode=new Y(this)),this._featureSet=a.featureSet,this._nextId=a.nextObjectId,a=a.layerDefinition);this.geometryType=a.geometryType;
"string"!==typeof this.multipatchOption&&"esriGeometryMultiPatch"===this.geometryType&&(this.multipatchOption="xyFootprint");a.hasOwnProperty("capabilities")?(d=this.capabilities=a.capabilities)&&-1!==d.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1:this._collection||(this._editable=this._fserver);c.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===this.geometryType&&(this._editable=!1);this._json=u.toJson(this._json);
this.isEditable()?this._setMaxOffset(null):this.mode===G.MODE_SNAPSHOT||"esriGeometryPolyline"!==this.geometryType&&"esriGeometryPolygon"!==this.geometryType&&!this.hasXYFootprint()||(this._autoGeneralize=c.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===G.MODE_ONDEMAND||this.mode===G.MODE_AUTO,delete this._optAutoGen);d=a.effectiveMinScale||a.minScale;var F=a.effectiveMaxScale||a.maxScale;!this._hasMin&&d&&this.setMinScale(d);!this._hasMax&&F&&this.setMaxScale(F);this.layerId=a.id;this.name=
a.name;this.description=a.description;this.copyright=a.copyrightText;this.type=a.type;this.displayField=a.displayField;this.defaultDefinitionExpression=a.definitionExpression||(a.isView?a.viewDefinitionQuery:a.definitionQuery);this.fullExtent=new ha(a.extent);this.initialExtent=new ha(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new y(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=a.defaultVisibility;if("esriGeometryPoint"===this.geometryType||
"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.hasM=a.hasM||!1;this.hasZ=a.hasZ||!1;this.indexedFields=a.indexedFields;this.indexes=a.indexes;this.maxRecordCount=a.maxRecordCount;this.canModifyLayer=a.canModifyLayer;this.supportsStatistics=a.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:a.supportsAdvancedQueries;this.supportsCalculate=a.supportsCalculate;this.supportsAttachmentsByUploadId=a.supportsAttachmentsByUploadId;this.supportsCoordinatesQuantization=
a.supportsCoordinatesQuantization;this.supportsQuantizationEditMode=a.supportsQuantizationEditMode;this.supportsFormatPBF=a.supportedQueryFormats?-1!==b.map(a.supportedQueryFormats.toLowerCase().split(","),q.trim).indexOf("pbf"):!1;this.quantize=this.quantize&&this.supportsCoordinatesQuantization;this.hasLabels=a.hasLabels;this.canScaleSymbols=a.canScaleSymbols;this.supportsRollbackOnFailureParameter=this.supportsRollbackOnFailure=a.supportsRollbackOnFailure;this.syncCanReturnChanges=a.syncCanReturnChanges;
this.isDataVersioned=a.isDataVersioned;this.editFieldsInfo=a.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=a.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=a.relationships;this.allowGeometryUpdates=c.isDefined(a.allowGeometryUpdates)?a.allowGeometryUpdates:!0;this.allowUpdateWithoutMValues=!!a.allowUpdateWithoutMValues;this.enableZDefaults=!!a.enableZDefaults;
this.zDefault=c.isDefined(a.zDefault)?a.zDefault:null;this.advancedQueryCapabilities=a.advancedQueryCapabilities||{supportsStatistics:this.supportsStatistics,supportsOrderBy:this.supportsAdvancedQueries,supportsDistinct:this.supportsAdvancedQueries};this.geometryProperties=a.hasGeometryProperties&&a.geometryProperties||null;this.url&&(this.advancedQueryCapabilities.supportsPagination=this.advancedQueryCapabilities.supportsPagination&&(this.reHostedFS.test(this.url)||10.3<this.version));this.queryPagination=
this._optQueryPagination&&this.advancedQueryCapabilities.supportsPagination;this.useStandardizedQueries=a.useStandardizedQueries;this.tileMaxRecordCount=a.tileMaxRecordCount;this.standardMaxRecordCount=a.standardMaxRecordCount;if(d=a.dateFieldsTimeReference)this.dateFieldsTimeReference=new S(d);this._setMaxOffset(this._maxOffset,!0);this._isTable="Table"===this.type;var f=this.fields=[],F=a.fields;for(d=0;d<F.length;d++)f.push(new V(F[d]));if(!this.objectIdField){this.objectIdField=a.objectIdField;
if(!this.objectIdField)for(F=a.fields,d=0;d<F.length;d++)if(f=F[d],"esriFieldTypeOID"===f.type){this.objectIdField=f.name;break}this.objectIdField||this._isStream||console.debug("esri.layers.FeatureLayer: "+c.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!c.isDefined(this._nextId)){F=this.objectIdField;f=-1;if(this._collection&&F){var k=(d=this._featureSet)&&d.features,e=k?k.length:0,O;for(d=0;d<e;d++)O=(O=k[d].attributes)&&O[F],O>f&&(f=O)}this._nextId=f+1}this.globalIdField=
a.globalIdField;if(d=this.typeIdField=a.typeIdField)if(d=!this._getField(d)&&this._getField(d,!0))this.typeIdField=d.name;this.visibilityField=a.visibilityField;if(F=a.defaultSymbol)this.defaultSymbol=J.fromJson(F);var n=this.types=[],m=a.types,p,l,f=(d=this.editFieldsInfo)&&d.creatorField,k=d&&d.editorField;O=f||k;e=[];if(m)for(d=0;d<m.length;d++)p=new ca(m[d]),l=p.templates,O&&l&&l.length&&(e=e.concat(l)),n.push(p);m=a.templates;p=this.templates=[];if(m)for(d=0;d<m.length;d++)n=new oa(m[d]),O&&
e.push(n),p.push(n);for(d=0;d<e.length;d++)if(O=q.getObject("prototype.attributes",!1,e[d]))f&&delete O[f],k&&delete O[k];if(d=a.timeInfo)this.timeInfo=new R(d),this._startTimeField=d.startTimeField,this._endTimeField=d.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?d.trackIdField=this._trackIdField:this._trackIdField=d.trackIdField;this.hasAttachments=!this._collection&&a.hasAttachments?!0:!1;this.htmlPopupType=a.htmlPopupType;d=a.drawingInfo;var z;
(f=d&&d.labelingInfo)&&!this.labelingInfo&&(this.labelingInfo=b.map(f,function(a){return new ia(a)}),this._fixLabelExpr());if(!this.renderer)if(d&&d.renderer){if(z=d.renderer,this.setRenderer(aa.fromJson(z)),"classBreaks"===z.type&&this.renderer.setMaxInclusive(!0),!this._collection){var r=z.type,F=[];z=this.renderer;switch(r){case "simple":F.push(z.symbol);break;case "uniqueValue":case "classBreaks":F.push(z.defaultSymbol),F=F.concat(b.map(z.infos,function(a){return a.symbol}))}var F=b.filter(F,
c.isDefined),v=this._url.path+"/images/",B=this._getToken();b.forEach(F,function(a){var c=a.url;c&&(-1===c.search(/https?\:/)&&-1===c.indexOf("data:")&&(a.url=v+c),B&&-1!==a.url.search(/https?\:/)&&(a.url+="?token\x3d"+B))})}}else if(F)m=this.types,0<m.length?(z=new K(this.defaultSymbol,this.typeIdField),b.forEach(m,function(a){z.addValue(a.id,a.symbol)})):z=new H(this.defaultSymbol),this.setRenderer(z);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":r=
new g;break;case "esriGeometryPolyline":r=new C;break;case "esriGeometryPolygon":r=new x;break;default:this.hasXYFootprint()&&(r=new x)}this.setRenderer(r?new H(r):null)}r=d&&d.transparency||0;!this.hasOwnProperty("opacity")&&0<r&&(this.opacity=1-r/100);(h("ie")||7<=h("trident")||h("safari"))&&this.isEditable()&&10.02>this.version&&(this._ts=!0);this.statistics=a.statistics;this._fixRendererFields();this._updateRequiredFieldsFromLabelingInfo();this._checkFields();this._updateCaps();var I=function(){null==
this._maxOffset||this._isFractionalOffsetAllowed()||this._setMaxOffset(this._maxOffset);this.loaded=!0;this.setFeatureReduction(this.getFeatureReduction());this.currentMode!==G.MODE_SNAPSHOT&&(this.queryPagination=!1);this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))};a=[];this._collection?(r=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new X(r)),this._fcAdded=!0):(a.push(this._forceIdentity()),this._limitPromise&&a.push(this._limitPromise));a.push(this._evalGeometryOperations());
a.length?A(a).then(q.hitch(this,function(){I.call(this)})):I.call(this)}},setShowLabels:function(a){var c=this.showLabels;this.showLabels=a;c!==this.showLabels&&(this._evalSurfaceType(),this.onShowLabelsChange())},onShowLabelsChange:function(){},onRendererChange:function(a){this.inherited(arguments);var d=this._map;this._ager=!!(a&&a.observationAger&&a.observationRenderer);a&&"colors"in a&&"blurRadius"in a&&"maxPixelIntensity"in a?(this._evalSurfaceType(!0),"esriGeometryPoint"==this.geometryType&&
!this._heatmapManager&&d&&(this._heatmapManager=new la(this),this._heatmapManager.initialize(d))):this.renderer&&this.renderer.getRendererInfo?b.some(this.renderer.rendererInfos,function(a){return a.renderer&&"colors"in a.renderer&&"blurRadius"in a.renderer})||(this._heatmapManager=null):this._heatmapManager=null;this.timeInfo&&d&&(a&&(a.latestObservationRenderer||a.trackRenderer)?this._trackManager||(this._trackManager=new da(this),this._trackManager.initialize(d),this._childLayer=this._trackManager.container,
this._mode._applyTimeFilter()):this._trackManager&&!this._isStream&&(this._trackManager.destroy(),this._trackManager=null));if(a){var g=[],d=b.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],c.isDefined),h=function(a){return null!=a&&"function"!=typeof a&&a};b.forEach(d,function(a){var c=h(a.attributeField),d=h(a.attributeField2);a=h(a.attributeField3);!1!==c&&g.push(c);!1!==d&&g.push(d);!1!==a&&g.push(a)});this._requiredFields=g}else this._requiredFields=[];this.loaded&&
(this._fixRendererFields(),this._checkFields(this._requiredFields),this._collection&&(this._typesDirty=!0))},setFeatureReduction:function(a){a&&(a=q.mixin({},a),null!=a.clusterSize&&null==a.clusterRadius&&(a.clusterRadius=a.clusterSize),delete a.clusterSize);this.loaded?this._isFeatureReductionSupported(a)?this._featureReduction=a:(this._featureReduction=null,a&&console.log("Clustering is not supported for this layer: "+this.url)):this._featureReduction=a;this._evalFeatureReduction(this._featureReduction)},
hasFeatureReduction:function(){return!!this._featureReduction},getFeatureReduction:function(){var a=this._featureReduction;if(a){var a=q.mixin({},a),c=this._clusterManager;if(c=c&&c.aggregationInfo)a.clusterRadius=c.clusterRadius,a.infoTemplate=c.infoTemplate}return a},isFeatureReductionActive:function(){var a=this._clusterManager;return!!(a&&a.isClusteringEnabled()&&a.isClusteringActive())},isFeatureReductionEnabled:function(){return this._featureReductionEnabled},enableFeatureReduction:function(){this._featureReductionEnabled||
(this._featureReductionEnabled=!0,this._evalFeatureReduction(this._featureReduction))},disableFeatureReduction:function(){this._featureReductionEnabled&&(this._featureReductionEnabled=!1,this._evalFeatureReduction(this._featureReduction))},isFeatureReductionApplied:function(){return this.hasFeatureReduction()&&this.isFeatureReductionEnabled()&&this._canCluster(this.getFeatureReduction())},getAggregateGraphics:function(){return this._clusterManager?this._clusterManager.getAggregateGraphics():[]},getChildGraphics:function(a){return this._clusterManager?
this._clusterManager.getFeaturesInCluster(a):[]},getSingleGraphics:function(){return this._clusterManager?this._clusterManager.getSingleGraphics():[]},getFeatureReductionRenderer:function(){return this.isFeatureReductionActive()?this._clusterManager.getClusterRenderer():null},getFeatureReductionLayer:function(){return this._clusterManager?this._clusterManager.container:null},getFeatureReductionField:function(a){var c,d=this._clusterManager?this._clusterManager.getClusterFields():null;a=a?a.toLowerCase():
"";b.some(d,function(d){a===d.name.toLowerCase()&&(c=d);return!!c});return c},_isFeatureReductionSupported:function(a){return a&&"cluster"===a.type&&"esriGeometryPoint"===this.geometryType&&(this._collection||this._isStream||this._optQueryPagination&&this.advancedQueryCapabilities.supportsPagination)},_isReductionCompatibleRenderer:function(a){a=a&&a.declaredClass||"";a=a.toLowerCase();return-1<a.indexOf("simplerenderer")||-1<a.indexOf("classbreaksrenderer")||-1<a.indexOf("uniquevaluerenderer")},
_evalFeatureReduction:function(a){this.loaded&&this.getMap()&&(a=a||this.getFeatureReduction(),this._evalModeFromFReduction(a),a&&this.isFeatureReductionEnabled()?this._canCluster(a)?this._clusterManager?this._updateClusterManager(a):(this._clusterManager=this._createClusterManager(a),this.onFeatureReductionChange()):(console.log("Clustering is supported only for point layers where map spatial reference is WGS84 or Web Mercator"),this._destroyClusterManager()):this._destroyClusterManager())},_canCluster:function(a){var c=
this._map;if(!c)return!1;c=c.spatialReference;return this._isFeatureReductionSupported(a)&&this._isReductionCompatibleRenderer(this.renderer)&&(c.isWebMercator()||4326===c.wkid)},_createClusterManager:function(a){a=new ma({layer:this,aggregationInfo:a});this._clusterHandles=[a.on("renderer-change",q.hitch(this,function(){this.onFeatureReductionRendererChange()}))];a.initialize(this._map);return a},_updateClusterManager:function(a){var c=this._clusterManager;c&&c.setAggregationInfo(a)},_destroyClusterManager:function(a){b.forEach(this._clusterHandles,
function(a){a.remove()});this._clusterHandles=null;this._clusterManager&&(this._clusterManager.destroy(a),this._clusterManager=null,this.onFeatureReductionChange())},redraw:function(){this.inherited(arguments);this._clusterManager&&this._clusterManager.redraw();this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(a){this.inherited(arguments);var c=this._getRenderer();this._ager=!!(c&&c.observationAger&&c.observationRenderer);this._trackManager&&
this._trackManager.container&&this._trackManager.container.setRenderer(c&&c.trackRenderer);a&&this._evalFeatureReduction()},_graphicVisibilityChanged:function(a){this._clusterManager?this._clusterManager.toggleFeatureVisibility(a):this._heatmapManager&&this._heatmapManager.redraw()},setWebGLFetchOptions:function(a){this._hasOnDemandDrillMode()&&(a=a||{},null!=a.maxDrillLevel&&(this._mode.maxDrillLevel=a.maxDrillLevel),null!=a.maxRecordCountFactor&&(this._mode.maxRecordCountFactor=a.maxRecordCountFactor),
null!=a.enablePBFQuery&&(this._mode.enablePBFQuery=a.enablePBFQuery))},_isWebGLCompatible:function(){return this.loaded&&!this.isEditable()&&!this.isFeatureReductionApplied()&&(!this.labelingInfo||!1===this.showLabels)&&!this._isGeometryOperationsUsed()&&this._isRendererSupportedInWebGL()&&this.supportsCoordinatesQuantization&&("esriGeometryPolygon"!==this.geometryType||this.advancedQueryCapabilities.supportsReturningGeometryCentroid)&&this.currentMode===G.MODE_ONDEMAND&&(!this._preSurfaceChangeState||
this._preSurfaceChangeState.currentMode===G.MODE_ONDEMAND)},_isRendererSupportedInWebGL:function(){if(!this.renderer)return!1;var a=this.renderer,c=a.declaredClass?a.declaredClass.toLowerCase():"";return(-1<c.indexOf("simplerenderer")||-1<c.indexOf("classbreaksrenderer")||-1<c.indexOf("uniquevaluerenderer"))&&this._hasWebGLCompatibleSymbols(a)&&this._hasWebGLCompatibleVVs(a)},_hasWebGLCompatibleSymbols:function(a){a=this._getAllSymbolsInRenderer(a);return!this._hasSLSWithMarker(a)},_hasWebGLCompatibleVVs:function(a){return!b.some(a&&
a.visualVariables,function(a){var c=a.type;return("colorInfo"===c||"opacityInfo"===c)&&a.stops&&8<a.stops.length||"sizeInfo"===c&&(a.field||a.valueExpression&&"$view.scale"!==a.valueExpression||a.expression&&"view.scale"!==a.expression)&&a.stops&&6<a.stops.length?!0:!1})},_hasSLSWithMarker:function(a){return b.some(a,function(a){return a&&"simplelinesymbol"===a.type&&!!a.marker})},_getAllSymbolsInRenderer:function(a){var c=[];a&&(c.push(a.symbol),c.push(a.defaultSymbol),b.forEach(a.infos,function(a){c.push(a.symbol)}),
c=b.filter(c,function(a){return!!a}));return c},_setMap:function(a){var c=this.inherited(arguments),d=this._mode,g=this;d&&a.loaded&&d.initialize(a);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=this.on("graphic-node-add",function(a){a=a.graphic.attributes;(a=g._selectedFeatures[a&&a[g.objectIdField]])&&a.attr("data-selected","")});return c},_unsetMap:function(a){var c=this._mode;c&&(c.suspend(),c.destroy());this._destroyClusterManager(!1);
this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);r.disconnect(this._zoomConnect);r.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},onAttach:function(){this._evalModeFromSurface()},refresh:function(){this._needsRefresh=!1;var a=this._mode;a&&a.refresh()},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return b.filter(this._getOutFields(),
function(a){return"*"===a||!!this._getField(a)},this)},getField:function(a){return this._getField(a,!0)},isOutField:function(a){a=this.getField(a);if(!a)return!1;var c=this.getOutFields();return-1<b.indexOf(c,"*")||-1<b.indexOf(c,a.name)},getFieldLabel:function(a){var c=this.infoTemplate,c=c&&c.getFieldInfo&&c.getFieldInfo(a);a=q.isFunction(a)?null:this.getField(a);var d=c||a,g="";d&&(g=c&&c.label||a&&a.alias||d.name||d.fieldName);return g},getDomain:function(a,c){var d,g,h=(c=c&&c.feature)&&this.typeIdField&&
c.attributes&&c.attributes[this.typeIdField];null!=h&&b.some(this.types,function(c){return c.id==h?((d=c.domains&&c.domains[a])&&"inherited"===d.type&&(d=this._getLayerDomain(a),g=!0),!0):!1},this);g||d||(d=this._getLayerDomain(a));return d},_getLayerDomain:function(a){var c;b.some(this.fields,function(d){d.name===a&&(c=d.domain);return!!c});return c},getType:function(a){var c,d=a&&this.typeIdField&&a.attributes&&a.attributes[this.typeIdField];b.some(this.types,function(a){a.id==d&&(c=a);return!!c});
return c},setEditable:function(a){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(!this.loaded)return this._optEditable=a,this;var c=this._editable;this._editable=a;this._updateCaps();if(c!==a)this.onCapabilitiesChange();return this},getEditCapabilities:function(a){var c={canCreate:!1,canUpdate:!1,canDelete:!1,canUpdateGeometry:!1};if(!this.loaded||!this.isEditable())return c;var d=a&&a.feature;a=
a&&a.userId||this.getUserId();var g=b.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],q.trim),h=(c=-1<b.indexOf(g,"editing"))&&-1<b.indexOf(g,"create"),f=c&&-1<b.indexOf(g,"update"),g=c&&-1<b.indexOf(g,"delete"),F=this.ownershipBasedAccessControlForFeatures,k=this.editFieldsInfo,e=k&&k.creatorField,k=k&&k.realm,d=(d=d&&d.attributes)&&e?d[e]:void 0,n=!!this.userIsAdmin,e=!F||n||!(!F.allowOthersToUpdate&&!F.allowUpdateToOthers),m=!F||n||!(!F.allowOthersToDelete&&!F.allowDeleteToOthers),
p=!F||n||!F.hasOwnProperty("allowAnonymousToUpdate")||F.allowAnonymousToUpdate,F=!F||n||!F.hasOwnProperty("allowAnonymousToDelete")||F.allowAnonymousToDelete;a&&k&&(a=a+"@"+k);if(n||c&&!(h||f||g))h=f=g=!0;c={canCreate:h,canUpdate:f,canDelete:g,canUpdateGeometry:n||this.allowGeometryUpdates};a||(c.canUpdate=c.canUpdate&&p,c.canDelete=c.canDelete&&F);null===d?(c.canUpdate=c.canUpdate&&e,c.canDelete=c.canDelete&&m):""!==d&&d&&a.toLowerCase()!==d.toLowerCase()&&(c.canUpdate=c.canUpdate&&e,c.canDelete=
c.canDelete&&m);return c},getUserId:function(){var a;this.loaded&&(a=this.credential&&this.credential.userId||this.userId||"");return a},setUserIsAdmin:function(a){this.userIsAdmin=a},setEditSummaryCallback:function(a){this.editSummaryCallback=a},getEditSummary:function(a,d,g){g=c.isDefined(g)?g:(new Date).getTime();var b="";g=this.getEditInfo(a,d,g);(d=d&&d.callback||this.editSummaryCallback)&&(g=d(a,g)||"");if(q.isString(g))b=g;else{if(g){a=g.action;d=g.userId;var h=g.timeValue,f=0;a&&f++;d&&f++;
c.isDefined(h)&&f++;1<f&&(b=("edit"===a?"edit":"create")+(d?"User":"")+(c.isDefined(h)?g.displayPattern:""))}b=b&&c.substitute(g,this.i18n.layers.FeatureLayer[b])}return b},getEditInfo:function(a,d,g){if(this.loaded){g=c.isDefined(g)?g:(new Date).getTime();d=d&&d.action||"last";var b=this.editFieldsInfo,h=b&&b.creatorField,f=b&&b.creationDateField,F=b&&b.editorField,b=b&&b.editDateField,F=(a=a&&a.attributes)&&F?a[F]:void 0,b=a&&b?a[b]:null,h=this._getEditData(a&&h?a[h]:void 0,a&&f?a[f]:null,g);g=
this._getEditData(F,b,g);var k;switch(d){case "creation":k=h;break;case "edit":k=g;break;case "last":k=g||h}k&&(k.action=k===g?"edit":"creation");return k}},_getEditData:function(a,d,g){var b,h,f;c.isDefined(d)&&(h=g-d,f=0>h?"Full":6E4>h?"Seconds":12E4>h?"Minute":36E5>h?"Minutes":72E5>h?"Hour":864E5>h?"Hours":6048E5>h?"WeekDay":"Full");if(void 0!==a||f)b=b||{},b.userId=a,f&&(a=v.format,g=new Date(d),b.minutes=Math.floor(h/6E4),b.hours=Math.floor(h/36E5),b.weekDay=a(g,{datePattern:"EEEE",selector:"date"}),
b.formattedDate=a(g,{selector:"date"}),b.formattedTime=a(g,{selector:"time"}),b.displayPattern=f,b.timeValue=d);return b},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},isQueryable:function(){var a=b.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],q.trim);return this._isStream||this.userIsAdmin||this._collection||-1!==b.indexOf(a,"query")||-1!==b.indexOf(a,"catalog")},setMaxAllowableOffset:function(a){this.isEditable()||(this._optMaxOffset=a,this._setMaxOffset(a,
!0));return this},_resetMaxAllowableOffset:function(){this.setMaxAllowableOffset(this._optMaxOffset);this._prevScale=null;this._refreshMaxAllowableOffset()},_refreshMaxAllowableOffset:function(){this._calcMaxOffsetForAutoSnapshot();this._updateMaxOffset();this._needsRefresh=!1},getMaxAllowableOffset:function(){var a=this._quantizationParameters?this._quantizationParameters.tolerance:void 0;return null!=this._maxOffset?this._maxOffset:a},_setMaxOffset:function(a,c){if(null==a)return delete this._maxOffset,
delete this._quantizationParameters,this;this.quantize&&this.supportsCoordinatesQuantization?("esriGeometryPolyline"===this.geometryType?this._maxOffset=a:delete this._maxOffset,this._quantizationParameters=a?{mode:"view",originPosition:"upperLeft",tolerance:a,extent:this.fullExtent}:null):(this._isFractionalOffsetAllowed()&&c||(a=Math.floor(a)),isNaN(a)||0===a?delete this._maxOffset:this._maxOffset=a,delete this._quantizationParameters);return this},_isFractionalOffsetAllowed:function(){return null==
this.version||10.1<=this.version||navigator.languages&&this._isLangWithDot(navigator.languages[0])},_isLangWithDot:function(a){a=(a=a&&a.split("-"))&&a[0]&&a[0].toLowerCase();return-1!==b.indexOf(this._langsWithDot,a)},_langsWithDot:"ar en et fr he ja ko th vi zh".split(" "),setAutoGeneralize:function(a){this.loaded?this.isEditable()||this.mode===G.MODE_SNAPSHOT||"esriGeometryPolyline"!==this.geometryType&&"esriGeometryPolygon"!==this.geometryType&&!this.hasXYFootprint()||((this._autoGeneralize=a)?
(this._isAutoSnapshotMode()&&(this._prevScale=null),this._updateMaxOffset()):this._setMaxOffset(null)):this._optAutoGen=a;return this},setGDBVersion:function(a){this._collection||a===this.gdbVersion||!a&&!this.gdbVersion||(this.gdbVersion=a,this._task.gdbVersion=a,this._url.query=q.mixin(this._url.query,{gdbVersion:a}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange());return this},hasAllFeatures:function(){return this._mode?this._mode.hasAllFeatures():!0},hasUpdateError:function(){return this._mode?
this._mode.hasUpdateError():!1},setDefinitionExpression:function(a){this._defnExpr=a;(a=this._checkFeatureLimit())?this._evalModeAndApplyDefnExpr(a):this._applyDefnExpr();return this},_applyDefnExpr:function(){var a=this._mode;a&&a.propertyChangeHandler(1)},_evalModeAndApplyDefnExpr:function(a){a.then(q.hitch(this,function(a){!a||a instanceof Error||a.modeChanged||this._applyDefnExpr()}))},getDefinitionExpression:function(){return this._defnExpr},setTimeDefinition:function(a){this._isSnapshotMode()?
(this._timeDefn=a,(a=this._mode)&&a.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(a,c){this._timeOffset=a;this._timeOffsetUnits=c;(a=this._mode)&&a.propertyChangeHandler(0);return this},setUseMapTime:function(a){this.useMapTime=a;this._toggleTime(!this.suspended);
(a=this._mode)&&a.propertyChangeHandler(0)},selectFeatures:function(a,c,d,g){c=c||G.SELECTION_NEW;this._hasSelectionError=this._hasPartialSelectedFeatures=!1;a=this._getShallowClone(a);var b=this._map,h,k=this,e=B._fixDfd(new p(B._dfdCanceller));a.outFields=this.getOutFields();a.returnGeometry=!0;a.multipatchOption=this.multipatchOption;b&&(a.outSpatialReference=new y(b.spatialReference.toJson()));if(!this._applyQueryFilters(a,!0))return h={features:[]},this._selectHandler(h,c,d,g,e),e;if(b=this._canDoClientSideQuery(a))e._pendingDfd=
f(this._doQuery(a,b)),e._pendingDfd.then(function(a){h={features:a};k._selectHandler(h,c,d,g,e)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,g,e,!0),e;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,g,e,!0),e;var F=this;this._ts&&(a._ts=(new Date).getTime());b=this._canFetchPBFForQuery(a);this._enableEditModeQuantization(a,b);(e._pendingDfd=this._task.execute(a,null,
null,b?{format:"pbf"}:null)).addCallbacks(function(a){F._selectHandler(a,c,d,g,e)},function(a){F._hasPartialSelectedFeatures=!0;F._hasSelectionError=!0;F._resolve([a],null,g,e,!0)})}return e},getSelectedFeatures:function(){var a=this._selectedFeatures,c=[],d;for(d in a)a.hasOwnProperty(d)&&c.push(a[d]);return c},clearSelection:function(a){var c=this._selectedFeatures,d=this._mode,g;for(g in c)c.hasOwnProperty(g)&&(this._unSelectFeatureIIf(g,d),d._removeFeatureIIf(g));this._selectedFeatures={};this._isSelOnly&&
d._applyTimeFilter(!0);if(!a)this.onSelectionClear();return this},setSelectionSymbol:function(a){if(this._selectionSymbol=a){var c=this._selectedFeatures,d;for(d in c)c.hasOwnProperty(d)&&c[d].setSymbol(a)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(a){a?(this.labelingInfo=a,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this._evalSurfaceType();this.onLabelingInfoChange()},_fixLabelExpr:function(){var a=
/\[([^\[\]]+)\]/ig,c,d=this,g=function(a,c){a=d._getField(c,!0);return"["+(a&&a.name||c)+"]"};b.forEach(this.labelingInfo,function(d){if(c=d.labelExpression)d.labelExpression=c.replace(a,g)})},_updateRequiredFieldsFromLabelingInfo:function(){var a=[];b.forEach(this.labelingInfo,function(c){var d=c.labelExpressionInfo;if(c.labelExpression){var g=/[\[\]]/ig;c=c.labelExpression.match(/\[[^\[\]]+\]/ig);(c=b.map(c,function(a){return a.replace(g,"")}))&&(a=a.concat(c))}if(d){if(d.value){var h=/[\{\}]/ig;
c=d.value.match(/\{[^\{\}]+\}/ig);(c=b.map(c,function(a){return a.replace(h,"")}))&&(a=a.concat(c))}d.expression&&(a=a.concat(I.extractFieldNames(d.expression)))}});a=b.map(a,function(a){var c=this.getField(a);return c?c.name:a},this);this._requiredFields&&(this._requiredFields=this._requiredFields.concat(a))},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(a,c,d,g,h,f){var k=f.assembly,e=f.dfd;this._applyNormalized(a,k&&k[0]);this._applyNormalized(c,k&&k[1]);this.onBeforeApplyEdits(a,
c,d);var F={},m=this.objectIdField,k={f:"json"},p=!1;if(this._collection)f={},f.addResults=a?b.map(a,function(){p=!0;return{objectId:this._nextId++,success:!0}},this):null,f.updateResults=c?b.map(c,function(a){p=!0;var c=a.attributes[m];F[c]=a;return{objectId:c,success:!0}},this):null,f.deleteResults=d?b.map(d,function(a){p=!0;return{objectId:a.attributes[m],success:!0}},this):null,p?this._editHandler(f,a,F,g,h,e):this._resolve([f.addResults,f.updateResults,f.deleteResults],null,g,e);else{a&&0<a.length&&
(k.adds=this._convertFeaturesToJson(a,0,1),p=!0);if(c&&0<c.length){for(f=0;f<c.length;f++){var l=c[f];F[l.attributes[m]]=l}k.updates=this._convertFeaturesToJson(c,0,0,1);p=!0}if(d&&0<d.length){c=[];for(f=0;f<d.length;f++)c.push(d[f].attributes[m]);k.deletes=c.join(",");p=!0}if(p){var u=this;return n({url:this._url.path+"/applyEdits",content:q.mixin(k,this._url.query),callbackParamName:"callback",load:function(c){u._editHandler(c,a,F,g,h,e)},error:function(a){u._resolve([a],null,h,e,!0)}},{usePost:!0})}this._resolve([],
null,g,e)}},queryFeatures:function(a,c,d){return this._query("execute","onQueryFeaturesComplete",a,c,d)},queryRelatedFeatures:function(a,c,d){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",a,c,d)},queryIds:function(a,c,d){return this._query("executeForIds","onQueryIdsComplete",a,c,d)},queryCount:function(a,c,d){return this._query("executeForCount","onQueryCountComplete",a,c,d)},queryExtent:function(a,c,d){return this._query("executeForExtent","onQueryExtentComplete",
a,c,d)},queryAttachmentInfos:function(a,c,d){var g=this._url.path+"/"+a+"/attachments",h=new p(B._dfdCanceller),f=this,g=w.normalize(g);h._pendingDfd=n({url:g,content:q.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(d){d=d.attachmentInfos;var k;b.forEach(d,function(c){k=m.objectToQuery({gdbVersion:f._url.query&&f._url.query.gdbVersion,layer:f._url.query&&f._url.query.layer,token:f._getToken()});c.url=g+"/"+c.id+(k?"?"+k:"");c.objectId=a});f._resolve([d],"onQueryAttachmentInfosComplete",
c,h)},error:function(a){f._resolve([a],null,d,h,!0)}});return h},addAttachment:function(a,c,d,g){return this._sendAttachment("add",a,c,d,g)},updateAttachment:function(a,c,d,g,b){d.appendChild(k.create("input",{type:"hidden",name:"attachmentId",value:c}));return this._sendAttachment("update",a,d,g,b)},deleteAttachments:function(a,c,d,g){var h=this._url.path+"/"+a+"/deleteAttachments",f=new p(B._dfdCanceller),k=this;c={f:"json",attachmentIds:c.join(",")};f._pendingDfd=n({url:h,content:q.mixin(c,this._url.query),
callbackParamName:"callback",load:q.hitch(this,function(c){c=c.deleteAttachmentResults;c=b.map(c,function(c){c=new N(c);c.attachmentId=c.objectId;c.objectId=a;return c});k._resolve([c],"onDeleteAttachmentsComplete",d,f)}),error:function(a){k._resolve([a],null,g,f,!0)}},{usePost:!0});return f},addType:function(a){var c=this.types;if(c){if(b.some(c,function(c){return c.id==a.id?!0:!1}))return!1;c.push(a)}else this.types=[a];return this._typesDirty=!0},deleteType:function(a){if(this._collection){var c=
this.types;if(c){var d=-1;b.some(c,function(c,g){return c.id==a?(d=g,!0):!1});if(-1<d)return this._typesDirty=!0,c.splice(d,1)[0]}}},toJson:function(){var a=this._json;if(a=q.isString(a)?u.fromJson(a):q.clone(a)){var a=a.layerDefinition?a:{layerDefinition:a},c=a.layerDefinition,d=this._collection;if(d&&this._typesDirty){c.types=b.map(this.types||[],function(a){return a.toJson()});var g=this.renderer,h=this.labelingInfo,f=c.drawingInfo;!g&&!h||f||(f=c.drawingInfo={});f&&g&&-1===g.declaredClass.indexOf("TemporalRenderer")&&
(f.renderer=g.toJson());h&&(f.labelingInfo=b.map(h,function(a){return a.toJson()}))}g=null;if(!d||this._fcAdded)g={geometryType:c.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)};a.featureSet=q.mixin({},a.featureSet||{},g);a.featureSet.transform&&(h=a.featureSet.transform,delete a.featureSet.transform,g=new X(a.featureSet),g.quantize(h),a.featureSet=g.toJson());d&&(a.nextObjectId=this._nextId,c.capabilities=this.capabilities);return a}},onSelectionComplete:function(){},onSelectionClear:function(){},
onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},
onLabelingInfoChange:function(){},onFeatureReductionRendererChange:function(){},onFeatureReductionChange:function(){},_evalGeometryOperations:function(){var a=new p;setTimeout(q.hitch(this,function(){this._isGeometryOperationsUsed()?I.enableGeometryOperations().always(function(){a.resolve()}):a.resolve()}),0);return a.promise},_isGeometryOperationsUsed:function(){var a=this.infoTemplate,c=this.renderer,d=this.labelingInfo;return a&&a.hasGeometryOperations&&a.hasGeometryOperations()||c&&c.hasGeometryOperations&&
c.hasGeometryOperations()||b.some(d,function(a){return I.hasGeometryOperations(a.labelExpressionInfo&&a.labelExpressionInfo.expression)})?!0:!1},_forceIdentity:function(){var c=new p,d=this,g,b=this._url&&this._url.path;g=b&&b.toLowerCase().indexOf("/rest/services");var h=this.editFieldsInfo,h=h&&(h.creatorField||h.editorField);(this.userIsAdmin||h)&&!this._getToken()&&-1<g&&a.id?(g=b.substring(0,g)+"/rest/info",n({url:g,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(c){if(c.owningSystemUrl)return a.id.checkSignInStatus(c.owningSystemUrl+
"/sharing")}).then(function(c){if(c)return a.id.getCredential(b)}).then(function(a){a&&d._findCredential()}).always(function(){c.resolve()})):c.resolve();return c.promise},_isSnapshotMode:function(){return this._mode?this._mode.isInstanceOf(Y):!1},_isAutoSnapshotMode:function(){return this._isAutoModeEnabled()&&this.currentMode===G.MODE_SNAPSHOT},_getMaxFeaturesForAutoSnapshotMode:function(){var a=this.geometryType,c;"esriGeometryPolyline"===a||"esriGeometryPolygon"===a||"esriGeometryMultipoint"===
a||this.hasXYFootprint()?c=this.maxRecordCountForAuto:"esriGeometryPoint"===a&&(c=this.maxPointCountForAuto);return c},getLastExceedsLimitResult:function(){return this._lastExceedsLimitResult},_canUseSnapshotMode:function(a){this._lastExceedsLimitResult=a=(a=a&&a.features&&a.features[0])&&a.attributes&&a.attributes.exceedslimit;return!(this.mode!==G.MODE_AUTO||this.isEditable()||0!==a||!(this._isPaginationAllowed()||this.maxRecordCount>=this._getMaxFeaturesForAutoSnapshotMode()))},_evalModeFromFLimit:function(a){this._canUseSnapshotMode(a)?
this._enableAutoSnapshotMode():this._enableAutoOnDemandMode()},_enableAutoSnapshotMode:function(){var a=G.MODE_SNAPSHOT;this.isFeatureReductionApplied()?this._updatePreFReductionState(a):this._preSurfaceChangeState?(this._updatePreSurfaceChangeState(a),this._evalSurfaceType(!0)):this.currentMode!==a&&this._setFetchMode(G.MODE_AUTO,a)},_enableAutoOnDemandMode:function(){var a=G.MODE_ONDEMAND;this.isFeatureReductionApplied()?this._updatePreFReductionState(a):this._preSurfaceChangeState?this._updatePreSurfaceChangeState(a):
this.currentMode!==a&&(this._setFetchMode(G.MODE_AUTO,a),this._evalSurfaceType())},_evalModeFromFReduction:function(a){this.loaded&&(a&&this.isFeatureReductionEnabled()&&this._canCluster(a)?this._enableFReductionMode():this._disableFReductionMode())},_enableFReductionMode:function(){this._evalSurfaceType(!0);if(!this._preFReductionState){var a=this.currentMode;a!==G.MODE_SNAPSHOT&&a!==G.MODE_STREAM&&a!==G.MODE_SELECTION&&(this._preFReductionState={mode:this.mode,currentMode:this.currentMode},this._setFetchMode(this.mode===
G.MODE_AUTO?G.MODE_AUTO:G.MODE_SNAPSHOT,G.MODE_SNAPSHOT))}},_disableFReductionMode:function(){var a=this._preFReductionState;this._preFReductionState=null;!a||a.mode===this.mode&&a.currentMode===this.currentMode||(this._setFetchMode(a.mode,a.currentMode),this._evalSurfaceType())},_updatePreFReductionState:function(a){this._preFReductionState=this._preFReductionState||{};this._preFReductionState.mode=G.MODE_AUTO;this._preFReductionState.currentMode=a},_evalModeFromSurface:function(){this.hasWebGLSurface()?
this._enableWebGLSurfaceMode():this._disableWebGLSurfaceMode()},_enableWebGLSurfaceMode:function(){this._preSurfaceChangeState||(this._preSurfaceChangeState={mode:this.mode,currentMode:this.currentMode},this._setFetchMode(this.mode===G.MODE_AUTO?G.MODE_AUTO:G.MODE_ONDEMAND,G.MODE_ONDEMAND,this.webglDeps.OnDemandDrillMode))},_disableWebGLSurfaceMode:function(){var a=this._preSurfaceChangeState;a&&(this._preSurfaceChangeState=null,this._setFetchMode(a.mode,a.currentMode))},_updatePreSurfaceChangeState:function(a){this._preSurfaceChangeState=
this._preSurfaceChangeState||{};this._preSurfaceChangeState.mode=G.MODE_AUTO;this._preSurfaceChangeState.currentMode=a},_setFetchMode:function(a,c,d){this.clearSelection();this._mode.suspend();this._mode.destroy();this.mode=a;this.currentMode=c;d=d||this._getModeConstructor(c);this._mode=new d(this);this.queryPagination=c===G.MODE_ONDEMAND&&-1===d.prototype.declaredClass.toLowerCase().indexOf("ondemanddrillmode")?!1:this._isPaginationAllowed();(a=this.getMap())&&a.loaded&&(this._resetMaxAllowableOffset(),
this._mode.initialize(a),this._mode.startup())},_isPaginationAllowed:function(){return!(!this._optQueryPagination||this.loaded&&!this.advancedQueryCapabilities.supportsPagination)},_getModeConstructor:function(a){var c;a===G.MODE_SNAPSHOT?c=Y:a===G.MODE_ONDEMAND&&(c=ja);return c},_hasOnDemandDrillMode:function(){var a=this._mode,a=a&&a.declaredClass;return!!(a&&-1<a.toLowerCase().indexOf("ondemanddrillmode"))},_checkFeatureLimit:function(){this._limitPromise&&(this._limitPromise.cancel(),this._limitPromise=
null);var a=this._queryLimit();a&&(this._lastExceedsLimitResult=null,this._limitPromise=a.then(q.hitch(this,function(a){var c=this.currentMode;this._evalModeFromFLimit(a);return{modeChanged:this.currentMode!==c}})).always(q.hitch(this,function(a){this._limitPromise=null;return a})));return this._limitPromise},_queryLimit:function(){if(this._isAutoModeEnabled()){var a,c,d=new p(function(){clearTimeout(a);a=null;c&&!c.isFulfilled()&&c.cancel();c=null});a=setTimeout(q.hitch(this,function(){var a=new U,
g=new ga;g.statisticType="exceedslimit";g.maxPointCount=this.maxPointCountForAuto;g.maxRecordCount=this.maxRecordCountForAuto;g.maxVertexCount=this.maxVertexCountForAuto;g.outStatisticFieldName="exceedslimit";a.outStatistics=[g];c=this.queryFeatures(a).promise.then(function(a){d.resolve(a)}).otherwise(function(a){d.reject(a)})}),0);return d.promise}},_isAutoModeEnabled:function(){return this.mode===G.MODE_AUTO&&this.reHostedFS.test(this.url)},_updateCaps:function(){var a=this._editable,c=q.trim(this.capabilities||
""),d=b.map(c?c.split(","):[],q.trim),g=b.map(c?c.toLowerCase().split(","):[],q.trim),c=b.indexOf(g,"editing"),h,g={Create:b.indexOf(g,"create"),Update:b.indexOf(g,"update"),Delete:b.indexOf(g,"delete")};if(a&&-1===c)d.push("Editing");else if(!a&&-1<c){a=[c];for(h in g)-1<g[h]&&a.push(g[h]);a.sort();for(h=a.length-1;0<=h;h--)d.splice(a[h],1)}this.capabilities=d.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);
var a=this._mode;a&&a.suspend()},onResume:function(a){this.inherited(arguments);this._toggleTime(!0);var c=this._map,d=this._getRenderer();if(a.firstOccurrence){if(this._fixRendererFields(),this._updateRequiredFieldsFromLabelingInfo(),this._checkFields(),this.clearSelection(),this._evalFeatureReduction(),this.timeInfo&&!this._trackManager&&(this._trackIdField||d&&(d.latestObservationRenderer||d.trackRenderer))&&(this._trackManager=new da(this),this._trackManager.initialize(c),this._childLayer=this._trackManager.container),
d&&"colors"in d&&"blurRadius"in d&&"maxPixelIntensity"in d&&"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&(this._heatmapManager=new la(this),this._heatmapManager.initialize(c)),this._zoomConnect=r.connect(c,"onZoomEnd",this,this._zoomEndHandler),this._refreshMaxAllowableOffset(),d=this._mode)d._init||d.initialize(c),d.startup()}else this._zoomEndHandler(),this._mode&&this._mode.resume()},_zoomEndHandler:function(){var a=this._map;this._updateMaxOffset();this._prevScale=a.getScale();
!this.suspended&&this._needsRefresh&&this.refresh()},_updateMaxOffset:function(){var a=this._map;a&&a.loaded&&this._autoGeneralize&&(this._isAutoSnapshotMode()?(a=this.getMaxAllowableOffset(),this._setMaxOffset(this._getMaxOffsetForScale(),!0),this._needsRefresh||(this._needsRefresh=a!=this.getMaxAllowableOffset())):this._setMaxOffset(a.extent.getWidth()/a.width,!a.extent.spatialReference.isWebMercator()))},_getMaxOffsetForScale:function(){if(this._map){var a=this._map.getScale(),c=this._calculatedScale,
d=this._calcMaxOffset,g=this._prevScale;return a>=c&&(null==g||g<c)?d:a<c&&(null==g||g>=c)?null:this.getMaxAllowableOffset()}},_calcMaxOffsetForAutoSnapshot:function(){var a=this._map;if(a&&this._isAutoSnapshotMode()&&this._autoGeneralize&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint())&&!this.isEditable()&&null==this.getMaxAllowableOffset()){var c=this.generalizeForScale;this._calculatedScale=c=this.maxScale?this.maxScale:this.minScale?
Math.min(c,this.minScale):Math.min(c,Q.getScale(a,this.initialExtent));this._calcMaxOffset=a.extent.getWidth()/a.width/a.getScale()*c}else this._calculatedScale=this._calcMaxOffset=void 0},_toggleTime:function(a){var c=this._map;a&&this.timeInfo&&this.useMapTime&&c?(this._mapTimeExtent=c.timeExtent,this._timeConnect||(this._timeConnect=r.connect(c,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,r.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(a){this._mapTimeExtent=
a;(a=this._mode)&&a.propertyChangeHandler(0)},_getOffsettedTE:function(a){var c=this._timeOffset,d=this._timeOffsetUnits;return a&&c&&d?a.offset(-1*c,d):a},_getTimeOverlap:function(a,c){return a&&c?a.intersection(c):a||c},_getTimeFilter:function(a){var c=this.getTimeDefinition(),d;if(c&&(d=this._getTimeOverlap(c,null),!d))return[!1];if(a){if(a=d?this._getTimeOverlap(a,d):a,!a)return[!1]}else a=d;return[!0,a]},_getAttributeFilter:function(a){var c=this.getDefinitionExpression();return a?c?"("+c+") AND ("+
a+")":a:c},_applyQueryFilters:function(a,c){a.where=this._getAttributeFilter(a.where);a.returnGeometry&&null==a.maxAllowableOffset&&!a.quantizationParameters&&(a.maxAllowableOffset=this._maxOffset,a.quantizationParameters=this._quantizationParameters);c&&this.supportsAdvancedQueries&&(a.orderByFields=a.orderByFields||this.getOrderByFields());if(this.timeInfo)if(c=this._getTimeFilter(a.timeExtent),c[0])a.timeExtent=c[1];else return!1;return!0},_add:function(a){var c=this._selectionSymbol,d=a.attributes,
g=this.visibilityField;c&&this._isSelOnly&&a.setSymbol(c);if(g&&d&&d.hasOwnProperty(g))a[d[g]?"show":"hide"]();return this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(a){var c=[],d=this._map,g;if((this._collection||!this._isTable&&d)&&!(a.text||a.where&&a.where!==this.getDefinitionExpression()||a.orderByFields&&a.orderByFields.length&&(g=this.getOrderByFields()||[])&&a.orderByFields.join()!==g.join()||a.outStatistics||a.returnDistinctValues)){g=
this._isSnapshotMode();var h=this._isSelOnly,f=a.geometry;if(f){if(h||a.spatialRelationship!==U.SPATIAL_REL_INTERSECTS||"extent"!==f.type||!g&&!d.extent.contains(f))return;c.push(1)}if(d=a.objectIds)if(g)c.push(2);else{var f=d.length,k=this._mode,e=0,n;for(n=0;n<f;n++)k._getFeature(d[n])&&e++;if(e===f)c.push(2);else return}if(this.timeInfo)if(a=a.timeExtent,d=this._mapTimeExtent,g)a&&c.push(3);else if(h){if(a)return}else if(d)if(-1!==b.indexOf(c,2))a&&c.push(3);else if(-1!==b.indexOf(c,1))a==d&&c.push(3);
else return;else if(0<c.length)a&&c.push(3);else if(a)return;return 0<c.length?c:null}},_getAbsMid:function(a){return t.toAbsMid?t.toAbsMid(a):l.id.replace(/\/[^\/]*$/ig,"/")+a},_doQuery:function(a,c,d){var g=[],h=this.objectIdField,f=this,k=new p,e=new p,n=this.graphics;if(-1!==b.indexOf(c,1)){var m=this.spatialIndex||this._map&&this._map.spatialIndex,l,u=a.geometry._normalize(null,!0);null==m&&pa.autoSpatialIndexing?l=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(q.hitch(this,
q.partial(this._getFromIndex,u,m)),function(a){e.resolve(q.hitch(this,q.partial(this._filterByExtent,n,u)))}):m&&(l=this._getFromIndex(u,m));l?l.then(function(a){for(var c=0;c<a.length;c++)a[c].results&&(g=g.concat(a[c].results));e.resolve(g)}).otherwise(function(a){e.reject(a)}):e.resolve(this._filterByExtent(n,u))}else e.resolve(n);e.then(function(e){g=e;if(-1!==b.indexOf(c,2)){var n=a.objectIds;g=b.filter(g,function(a){return-1<b.indexOf(n,a.attributes[h])})}-1!==b.indexOf(c,3)&&f.timeInfo&&(e=
a.timeExtent,g=f._filterByTime(g,e.startTime,e.endTime).match);d&&(g=b.map(g,function(a){return a.attributes[h]},this));k.resolve(g)});return k},_getFromIndex:function(a,c){c=c||this.spatialIndex||this._map.spatialIndex;a instanceof Array||(a=[a]);var d=this.id;return z(b.map(a,function(a){return c.intersects(a,d)}))},_filterByExtent:function(a,c){for(var d=[],g=0,b=a.length;g<b;g++){var h=a[g],f=h.geometry;f&&(this.normalization&&c.length?(c[0].intersects(f)||c[1].intersects(f))&&d.push(h):c.intersects(f)&&
d.push(h))}return d},_filterByTime:function(a,d,g){var h=this._startTimeField,b=this._endTimeField,f;this._twoTimeFields||(f=h||b);var k=c.isDefined,e=[],n=[],m,p=a.length,l,u;d=d?d.getTime():-Infinity;g=g?g.getTime():Infinity;if(f)for(m=0;m<p;m++)l=a[m],u=l.attributes,h=u[f],h>=d&&h<=g?e.push(l):n.push(l);else for(m=0;m<p;m++)l=a[m],u=l.attributes,f=u[h],u=u[b],f=k(f)?f:-Infinity,u=k(u)?u:Infinity,f>=d&&f<=g||u>=d&&u<=g||d>=f&&g<=u?e.push(l):n.push(l);return{match:e,noMatch:n}},_getSizeVariables:function(a){return a&&
b.filter(a.getVisualVariablesForType("sizeInfo",!1),function(a){return!(!a.field&&!a.valueExpression)})},_needClientSideSorting:function(a){return this._collection?!(!a||!a.length):b.some(a,function(a){return!!a.valueExpression})},_sortFeatures:function(a){var c=this.renderer,d=this._getSizeVariables(c);if(a&&1<a.length&&this._needClientSideSorting(d)){var g=d[0],h=this;a.sort(function(a,d){a._layer||(a._layer=h);d._layer||(d._layer=h);a=c._getDataValue(a,g,"sizeInfo",null,h);d=c._getDataValue(d,
g,"sizeInfo",null,h);return null==a?-1:null==d?1:d-a})}return a},_resolve:function(a,c,d,g,h){c&&this[c].apply(this,a);d&&d.apply(null,a);g&&B._resDfd(g,a,h)},_getShallowClone:function(a){var c=new U,d;for(d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);return c},_canFetchPBF:function(){return!!(qa&&ra&&this.supportsFormatPBF)},_canFetchPBFForQuery:function(a){var c=this.advancedQueryCapabilities;return!(!(this._canFetchPBF()&&("tile"===a.resultType&&c&&c.supportsQueryWithResultType||!this._isAutoSnapshotMode())&&
(a.quantizationParameters||!this.isEditable()&&this.supportsQuantizationEditMode))||a.outStatistics)},_enableEditModeQuantization:function(a,c){a&&c&&!a.quantizationParameters&&(a.quantizationParameters={mode:"edit"})},_query:function(a,c,d,g,h){var k=this,e=this._map,n=new p(B._dfdCanceller),m=d,l,u,q;if("executeRelationshipQuery"!==a){var m=this._getShallowClone(d),C=this.getOutFields();m.outFields||(m.outFields=C);m.outFields&&m.outFields.length&&(u=-1<b.indexOf(C,"*")?!1:!b.every(m.outFields,
function(a){return-1<b.indexOf(C,a)}));m.returnGeometry=d.hasOwnProperty("returnGeometry")?d.returnGeometry:!d.outStatistics;m.returnGeometry&&(m.multipatchOption=this.multipatchOption,null!=m.maxAllowableOffset||m.quantizationParameters)&&(d=null!=m.maxAllowableOffset?m.maxAllowableOffset:m.quantizationParameters.tolerance,null!=d&&d!==this.getMaxAllowableOffset()&&(q=!0));var z;e&&(e=e&&e.spatialReference,(d=m.outSpatialReference)?l=!d.equals(e):m.outSpatialReference=new y(e.toJson()));if(!this._applyQueryFilters(m,
"execute"===a&&!m.outStatistics)){switch(a){case "execute":z=new X({features:[]});break;case "executeForIds":z=[];break;case "executeForCount":z=0;break;case "executeForExtent":z={}}this._resolve([z],c,g,n);return n}if(e="executeForExtent"!==a&&!l&&!u&&!q&&this._canDoClientSideQuery(m))return n._pendingDfd=f(this._doQuery(m,e,"executeForIds"===a||"executeForCount"===a)),n._pendingDfd.then(function(d){switch(a){case "execute":z=new X;z.features=d;break;case "executeForIds":z=d;break;case "executeForCount":z=
d.length}k._resolve([z],c,g,n)}),n}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,h,n,!0),n;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,h,n,!0),n;this._ts&&(m._ts=(new Date).getTime());e="execute"===a&&this._canFetchPBFForQuery(m);this._enableEditModeQuantization(m,e);(n._pendingDfd=this._task[a](m,null,null,e?{format:"pbf"}:null)).addCallbacks(function(d){var h=!!m.outStatistics||
l||u||q;if("execute"===a||"executeRelationshipQuery"===a){var b,f;if("execute"===a)for(b=d.features,f=b.length,--f;0<=f;f--){if(b[f]._layer=k,!h&&!k._isTable){var e=k._mode._getFeature(b[f].attributes[k.objectIdField]);e&&b.splice(f,1,e)}}else for(e in d)if(d.hasOwnProperty(e))for(b=d[e].features,f=b.length,--f;0<=f;f--)b[f]._layer=k}k._resolve([d],c,g,n)},function(a){k._resolve([a],null,h,n,!0)});return n},_convertFeaturesToJson:function(a,c,d,g){var h=[],f=this._selectionSymbol,k=this.visibilityField,
e,n=this.objectIdField;this.loaded&&(d||g)&&(e=b.filter(this.fields,function(a){return!1===a.editable&&(!g||a.name!==n)}));for(d=0;d<a.length;d++){var m=a[d],p={},l=m.geometry,C=m.attributes,z=m.symbol;!l||g&&this.loaded&&!this.allowGeometryUpdates||(p.geometry=l.toJson());k?(p.attributes=C=q.mixin({},C),C[k]=m.visible?1:0):C&&(p.attributes=q.mixin({},C));p.attributes&&e&&e.length&&b.forEach(e,function(a){delete p.attributes[a.name]});z&&z!==f&&(p.symbol=z.toJson());h.push(p)}return c?h:u.toJson(h)},
_selectHandler:function(a,c,d,g,h){var b;switch(c){case G.SELECTION_NEW:this.clearSelection(!0);b=!0;break;case G.SELECTION_ADD:b=!0;break;case G.SELECTION_SUBTRACT:b=!1}g=a.features;var f=this._mode,e=[],k=this.objectIdField,n,m;if(b)for(b=0;b<g.length;b++)n=g[b],m=n.attributes[k],n=f._addFeatureIIf(m,n),e.push(n),this._selectFeatureIIf(m,n,f);else for(b=0;b<g.length;b++)n=g[b],m=n.attributes[k],this._unSelectFeatureIIf(m,f),m=f._removeFeatureIIf(m),e.push(m||n);this._isSelOnly&&f._applyTimeFilter(!0);
this._hasPartialSelectedFeatures=!!a.exceededTransferLimit;this._resolve([e,c,a.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",d,h);if(a.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(a,c,d){var g=this._selectedFeatures,h=g[a];h||(d._incRefCount(a),g[a]=c,this._isTable||(this._setSelectSymbol(c),c.attr("data-selected","")));return h||c},_unSelectFeatureIIf:function(a,c){var d=this._selectedFeatures[a];d&&(c._decRefCount(a),delete this._selectedFeatures[a],
this._isTable||(this._setUnSelectSymbol(d),d.attr("data-selected")));return d},_setSelectSymbol:function(a){var c=this._selectionSymbol;c&&!this._isSelOnly&&a.setSymbol(c)},_setUnSelectSymbol:function(a){var c=this._selectionSymbol;c&&!this._isSelOnly&&c===a.symbol&&a.setSymbol(null,!0)},_getOutFields:function(){var a=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._requiredFields).concat(this.dataAttributes),a=b.filter(a,
function(a,c,d){return!!a&&b.indexOf(d,a)===c}),c=q.clone(this._outFields);if(c){if(-1!==b.indexOf(c,"*"))return c;b.forEach(a,function(a){-1===b.indexOf(c,a)&&c.push(a)});return c}return a},_checkFields:function(a){var d=a||this._getOutFields();b.forEach(d,function(a){"*"!==a&&(this._getField(a)||console.debug("esri.layers.FeatureLayer: "+c.substitute({url:this.url,field:a},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);a||this._isTable||this._fserver||
this._collection||this._isStream||b.some(this.fields,function(a){return a&&"esriFieldTypeGeometry"===a.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+c.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]"))},_fixFieldCase:function(a,c,d){var g=a&&a[c],h;if(g&&!q.isFunction(g)){if(h=!this._getField(g)&&this._getField(g,!0))g=a[c]=h.name;d&&d.push(g)}return g},
_fixRendererFields:function(){var a=this.renderer;this._orderBy=null;this._requiredFields=[];if(a&&0<this.fields.length){var d=[],g,a=b.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],c.isDefined),h=[].concat(a);b.forEach(a,function(a){b.forEach(a.rendererInfos,function(a){a.renderer&&h.push(a.renderer)})});b.forEach(h,function(a){this._fixFieldCase(a,"attributeField",d);this._fixFieldCase(a,"attributeField2",d);this._fixFieldCase(a,"attributeField3",d);this._fixFieldCase(a.rotationInfo,
"field",d);(g=this._fixFieldCase(a.sizeInfo,"field",d))&&!this._orderBy&&(this._orderBy=[g+" DESC"]);this._fixFieldCase(a.sizeInfo,"normalizationField",d);this._fixFieldCase(a.colorInfo,"field",d);this._fixFieldCase(a.colorInfo,"normalizationField",d);this._fixFieldCase(a.field,"field",d);this._fixFieldCase(a.opacityInfo,"field",d);this._fixFieldCase(a.opacityInfo,"normalizationField",d);b.forEach(a.visualVariables,function(a){g=this._fixFieldCase(a,"field",d);"sizeInfo"===a.type&&g&&!this._orderBy&&
(this._orderBy=[g+" DESC"]);this._fixFieldCase(a,"normalizationField",d)},this);var c=b.map(a.getFieldsUsedInExpressions(),function(a){var c=this.getField(a);return c?c.name:a},this);d=d.concat(c);this._orderBy||!a.addBreak||q.isFunction(a.attributeField)||!a.backgroundFillSymbol&&!this._hasSizeDiff(a)||(this._orderBy=[a.attributeField+" DESC"])},this);this._requiredFields=b.filter(d,c.isDefined)}},_hasSizeDiff:function(a){var c=Number.MAX_VALUE,d=-Number.MAX_VALUE,g,h;b.forEach(a.infos,function(a){if(h=
a.symbol){g=0;switch(h.type){case "simplemarkersymbol":g=h.size;break;case "picturemarkersymbol":g=(h.width+h.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":g=h.width;break;case "simplefillsymbol":case "picturefillsymbol":g=h.outline&&h.outline.width}g&&(c=Math.min(c,g),d=Math.max(d,g))}});return c!==Number.MAX_VALUE&&d!==-Number.MAX_VALUE&&1<Math.abs(d-c)},getOrderByFields:function(){var a=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&a?b.filter(a,
function(a){a=a.split(" ")[0];return!!this._getField(a,!0)},this):null},_getField:function(a,c){var d=this.fields;if(!d||0===d.length)return null;var g;c&&(a=a.toLowerCase());b.some(d,function(d){var h=!1;(h=c?d&&d.name.toLowerCase()===a?!0:!1:d&&d.name===a?!0:!1)&&(g=d);return h});return g},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:b.map(b.filter(this.fields,function(a){return!(!a||"esriFieldTypeDate"!==a.type)}),function(a){return a.name})});return this._dtOpts},_applyNormalized:function(a,
c){a&&c&&b.forEach(a,function(a,d){a&&c[d]&&a.setGeometry(c[d])})},_editHandler:function(a,c,d,g,h,f){h=a.addResults;var e=a.updateResults;a=a.deleteResults;var k,n,m,p,l,u=this.objectIdField,C=this._mode,z=this._isTable;k=this.editFieldsInfo;p=this.getOutFields()||[];var x=k&&k.creatorField,r=k&&k.creationDateField,v=k&&k.editorField,B=k&&k.editDateField;k=k&&k.realm;-1===b.indexOf(p,"*")&&(x&&-1===b.indexOf(p,x)&&(x=null),r&&-1===b.indexOf(p,r)&&(r=null),v&&-1===b.indexOf(p,v)&&(v=null),B&&-1===
b.indexOf(p,B)&&(B=null));var aa=r||B?(new Date).getTime():null,I=x||v?this.getUserId():void 0;I&&k&&(I=I+"@"+k);if(h){var E=this.globalIdField;for(k=0;k<h.length;k++)h[k]=new N(h[k]),z||(n=h[k],n.success&&(m=n.objectId,p=c[k],(l=p._graphicsLayer)&&l!==this&&l.remove(p),l=p.attributes||{},l[u]=m,m=n.globalId,E&&m&&(l[E]=m),x&&(l[x]=I),v&&(l[v]=I),r&&(l[r]=aa),B&&(l[B]=aa),p.setAttributes(l),C._init&&C.drawFeature(p)))}if(e)for(k=0;k<e.length;k++)if(e[k]=new N(e[k]),!z&&(n=e[k],n.success)){m=n.objectId;
p=d[m];if(c=C._getFeature(m))c.geometry!==p.geometry&&p.geometry&&c.setGeometry(ba.fromJson(p.geometry.toJson())),c.attributes!==p.attributes&&p.attributes&&c.setAttributes(q.mixin(c.attributes,p.attributes)),this._repaint(c,m);p=c||p;l=p.attributes||{};v&&(l[v]=I);B&&(l[B]=aa);p.setAttributes(l)}if(a){d=[];for(k=0;k<a.length;k++)if(a[k]=new N(a[k]),!z&&(n=a[k],n.success&&(m=n.objectId,p=C._getFeature(m))))this._unSelectFeatureIIf(m,C)&&d.push(p),p._count=0,C._removeFeatureIIf(m);if(0<d.length)this.onSelectionComplete(d,
G.SELECTION_SUBTRACT)}this._resolve([h,e,a],"onEditsComplete",g,f)},_sendAttachment:function(a,c,d,g,h){var b=this;return n({url:this._url.path+"/"+c+"/"+("add"===a?"addAttachment":"updateAttachment"),form:d,content:q.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(d){var h="add"===a?"onAddAttachmentComplete":"onUpdateAttachmentComplete";d=new N(d["add"===a?"addAttachmentResult":"updateAttachmentResult"]);d.attachmentId=
d.objectId;d.objectId=c;b._resolve([d],h,g);return d}).addErrback(function(a){b._resolve([a],null,h,null,!0)})},_repaint:function(a,d,g){d=c.isDefined(d)?d:a.attributes[this.objectIdField];d in this._selectedFeatures&&this._selectionSymbol||a.setSymbol(a.symbol,g)},_getKind:function(a){var c=this._trackManager;return c?c.isLatestObservation(a)?1:0:0}});q.mixin(G,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",
POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});L._createWrappers(G);Object.defineProperty(G.prototype,"graphics",{get:function(){return this._hasOnDemandDrillMode()?this._mode.graphics:this._graphicsVal},set:function(a){this._graphicsVal=a}});h("extend-esri")&&q.setObject("layers.FeatureLayer",G,a);return G})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./RangeDomain ./CodedValueDomain ./InheritedDomain ./FeatureTemplate".split(" "),
function(t,l,e,r,q,b,u,p,v,m,k){t=t(null,{declaredClass:"esri.layers.FeatureType",constructor:function(d){if(d&&l.isObject(d)){this.id=d.id;this.name=d.name;var b=d.symbol;b&&(this.symbol=u.fromJson(b));var b=d.domains,e,h=this.domains={};for(e in b)if(b.hasOwnProperty(e)){var a=b[e];switch(a.type){case "range":h[e]=new p(a);break;case "codedValue":h[e]=new v(a);break;case "inherited":h[e]=new m(a)}}if(e=d.templates)for(b=this.templates=[],d=0;d<e.length;d++)b.push(new k(e[d]))}},toJson:function(){var d=
{id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},f,k=this.domains,h=this.templates,a=b.fixJson;if(k){var c=d.domains={};for(f in k)k.hasOwnProperty(f)&&(c[f]=k[f]&&k[f].toJson());a(c)}h&&(d.templates=e.map(h,function(a){return a.toJson()}));return a(d)}});r("extend-esri")&&l.setObject("layers.FeatureType",t,q);return t})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(t,l,e,r,q,b){t=
t(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(e){e&&l.isObject(e)&&(this.name=e.name,this.description=e.description,this.drawingTool=e.drawingTool,this.thumbnail=e.thumbnail,e=e.prototype,this.prototype=new b(e.geometry,null,e.attributes))},toJson:function(){return q.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,thumbnail:q.fixJson(l.clone(this.thumbnail)),prototype:this.prototype&&this.prototype.toJson()})}});l.mixin(t,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",
TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",
TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});e("extend-esri")&&l.setObject("layers.FeatureTemplate",t,r);return t})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(t,l,e,r){t=t(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(e){e&&l.isObject(e)&&(this.objectId=e.objectId,this.globalId=e.globalId,this.success=e.success,e.success||(e=e.error,this.error=
Error(),this.error.code=e.code,this.error.message=e.description))}});e("extend-esri")&&l.setObject("layers.FeatureEditResult",t,r);return t})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../srUtils ../tasks/query ./RenderMode ./support/ParallelSnapshot".split(" "),function(t,l,e,r,q,b,u,p,v){t=t([p],{declaredClass:"esri.layers._SnapshotMode",maxFeatures:5E4,_isSuspendedAtStartup:!1,_pendingRefresh:!1,constructor:function(b){this.featureLayer=
b;this._featureMap={};this._hasUpdateError=this._hasPartialFeatures=!1;this._drawFeatures=l.hitch(this,this._drawFeatures);this._queryErrorHandler=l.hitch(this,this._queryErrorHandler);this._handleSuccess=l.hitch(this,this._handleSuccess);this._handleError=l.hitch(this,this._handleError);this._handleProgress=l.hitch(this,this._handleProgress)},startup:function(){if(!this._started||this._isSuspendedAtStartup){this.inherited(arguments);var b=this.featureLayer,e=b.advancedQueryCapabilities,d=b.reHostedFS.test(b.url);
this.pagination=b.queryPagination&&null!=b.maxRecordCount;this._tileQueriesEnabled=d&&e&&e.supportsQueryWithResultType;d&&this.pagination&&(this._parallelSnapshot=new v({layer:b,mode:this,queryTask:b._task}));this._isSuspendedAtStartup=b.suspended;this._startup()}},propertyChangeHandler:function(b){this._init&&(b?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+
this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},destroy:function(){this._isSuspendedAtStartup=this._pendingRefresh=!1;this._cancelPendingRequest(this._pendingRequest);this._parallelSnapshot&&this._parallelSnapshot.destroy();this.inherited(arguments)},drawFeature:function(b){var e=b.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(e,b);this._incRefCount(e)},resume:function(){this._isSuspendedAtStartup||this._pendingRefresh?(this._isSuspendedAtStartup=!1,this._startup()):
this.propertyChangeHandler(0)},refresh:function(){var b=this.featureLayer;b._collection?(b._fireUpdateStart(),b._refresh(!0),b._fireUpdateEnd()):this._fetchAll()},hasAllFeatures:function(){return!this._hasPartialFeatures},hasUpdateError:function(){return this._hasUpdateError},canFetchPBF:function(b){return this.inherited(arguments)&&this.featureLayer._canFetchPBFForQuery(b)},_startup:function(){this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},_fetchAll:function(){var b=this.featureLayer;
b._collection||b.suspended||!b.isQueryable()?this._pendingRefresh=b.suspended:(this._pendingRefresh=!1,b._fireUpdateStart(),this._clearIIf(),this._hasUpdateError=this._hasPartialFeatures=!1,this._parallelSnapshot?this._parallelSnapshot.fetch().then(this._handleSuccess,this._handleError,this._handleProgress):this._sendRequest())},_handleSuccess:function(b){this._hasPartialFeatures=b.hasPartialFeatures;this._hasUpdateError=b.hasUpdateError;this.featureLayer._fireUpdateEnd(null)},_handleError:function(b){this._queryErrorHandler(b)},
_handleProgress:function(b){b.isError?this.featureLayer._errorHandler(b.error):this._addFeatures(b.features)},_getPageSize:function(b){var e=this.featureLayer.tileMaxRecordCount;return"tile"===b.resultType&&e?e:this.featureLayer.maxRecordCount},_sendRequest:function(b){var e=this.featureLayer,d=this._createQueryInfo(),f=d.query;this.pagination&&(this._pageSize=this._getPageSize(f),this._start=f.start=null==b?0:b,f.num=this._pageSize);this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);
this._pendingRequest=e._task.execute(f,this._drawFeatures,this._queryErrorHandler,d.pbf?{format:"pbf"}:null)},_drawFeatures:function(b){this._pendingRequest=null;var e=this.featureLayer,d=b.exceededTransferLimit,f=d&&!e._collection;b=this._checkMaxLimit(b.features);var m=b.maxLimitReached;this._addFeatures(b.features);this.pagination&&f&&!m||(this._hasPartialFeatures=!!d,e._fireUpdateEnd(null,d?{queryLimitExceeded:!0}:null));f&&(this.pagination&&!m&&this._sendRequest(this._start+this._pageSize),e.onQueryLimitExceeded())},
_queryErrorHandler:function(b){this._pendingRequest=null;this._hasUpdateError=this._hasPartialFeatures=!0;var e=this.featureLayer;e._errorHandler(b);e._fireUpdateEnd(b)},_checkMaxLimit:function(b){var e=b?b.length:0,d=this.featureLayer.graphics.length+e,f=d>=this.maxFeatures;if(f){var m=d-this.maxFeatures;m&&b.splice(e-m,m)}return{maxLimitReached:f,featuresDiscarded:d>this.maxFeatures,features:b}},_createQueryInfo:function(){var e=this.featureLayer,k=new u;k.outFields=e.getOutFields();k.where=e.getDefinitionExpression()||
"1\x3d1";k.returnGeometry=!0;k.outSpatialReference=b.createSpatialReference(this.map.spatialReference.toJson());k.timeExtent=e.getTimeDefinition();k.maxAllowableOffset=e._maxOffset;k.quantizationParameters=e._quantizationParameters;k.orderByFields=e.supportsAdvancedQueries?e.getOrderByFields():null;k.multipatchOption=e.multipatchOption;e._ts&&(k._ts=(new Date).getTime());this._tileQueriesEnabled&&(k.resultType="tile");var d=this.canFetchPBF(k);e._enableEditModeQuantization(k,d);return{query:k,pbf:d}},
_addFeatures:function(b){var e=this.featureLayer,d=e.objectIdField,f=b.length,m=e._selectedFeatures,h=e.mode===e.constructor.MODE_AUTO,a,c,n;e._fireUpdateStart();e._sortFeatures(b);for(e=0;e<f;e++)c=b[e],n=c.attributes[d],a=this._addFeatureIIf(n,c),this._incRefCount(n),h&&a!==c&&m[n]&&(a.setGeometry(c.geometry),a.setAttributes(c.attributes));this._applyTimeFilter(!0)}});e("extend-esri")&&l.setObject("layers._SnapshotMode",t,r);return t})},"esri/layers/RenderMode":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","../sniff","../kernel"],function(t,l,e,r,q){var b=!!r("esri-pbf"),u=!!r("esri-featurelayer-pbf");t=t(null,{declaredClass:"esri.layers._RenderMode",enablePBFQuery:b&&u,initialize:function(b){this.map=b;this._init=!0},startup:function(){this._started=!0},propertyChangeHandler:function(b){},destroy:function(){this._init=this._started=!1},drawFeature:function(b){},suspend:function(){},resume:function(){},refresh:function(){},hasAllFeatures:function(){return!0},hasUpdateError:function(){return!1},
canFetchPBF:function(b){return!(!this.featureLayer._canFetchPBF()||!this.enablePBFQuery)},_incRefCount:function(b){(b=this._featureMap[b])&&b._count++},_decRefCount:function(b){(b=this._featureMap[b])&&b._count--},_getFeature:function(b){return this._featureMap[b]},_addFeatureIIf:function(b,e){var m=this._featureMap,k=m[b],d=this.featureLayer;k||(m[b]=e,d._add(e),e._count=0);return k||e},_removeFeatureIIf:function(b){var e=this._featureMap[b],m=this.featureLayer;if(e){if(e._count)return;delete this._featureMap[b];
m._remove(e)}return e},_registerFeature:function(b,e){var m=this._featureMap,k=m[b];k?(k.attributes=e.attributes,k.geometry=e.geometry):(m[b]=e,e._count=0,e._layer=e._graphicsLayer=e._sourceLayer=this.featureLayer);return k||e},_unregisterFeature:function(b){var e=this._featureMap,m=e[b];m&&!m._count&&(delete e[b],m._graphicsLayer=null)},_clearIIf:function(){var b;b=this.featureLayer;var e=b.graphics,m=b._selectedFeatures,k=b.getSelectedFeatures().length,d=b.objectIdField;if(k)for(b=e.length-1;0<=
b;b--){var k=e[b],f=k.attributes[d];f in m?k._count=1:(k._count=0,this._removeFeatureIIf(f))}else b.clear(),this._featureMap={}},_cancelPendingRequest:function(b){if(b)try{b.cancel()}catch(v){}},_toggleVisibility:function(b){var e=this.featureLayer,m=e.graphics,k=b?"show":"hide",d,f=m.length;b=b&&e._ager;for(d=0;d<f;d++){var p=m[d];p[k]();b&&e._repaint(p)}},_applyTimeFilter:function(b){var p=this.featureLayer;if(p.timeInfo&&!p.suspended){b||p._fireUpdateStart();var m=p._trackManager;m&&m.clearTracks();
var k=p.getTimeDefinition(),d=p._getOffsettedTE(p._mapTimeExtent);d?(d=p._getTimeOverlap(k,d))?(k=p._filterByTime(p.graphics,d.startTime,d.endTime),m&&m.addFeatures(k.match),e.forEach(k.match,function(d){var b=d._shape;d.visible||(d.show(),(b=d._shape)&&b._moveToFront());p._ager&&b&&p._repaint(d)}),e.forEach(k.noMatch,function(d){d.visible&&d.hide()})):this._toggleVisibility(!1):(m&&m.addFeatures(p.graphics),this._toggleVisibility(!0));m&&(m.moveLatestToFront(),m.drawTracks());b||p._fireUpdateEnd()}}});
r("extend-esri")&&l.setObject("layers._RenderMode",t,q);return t})},"esri/layers/support/ParallelSnapshot":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/Deferred ../../kernel".split(" "),function(t,l,e,r,q,b){t=t(null,{declaredClass:"esri.layers.support.ParallelSnapshot",layer:null,mode:null,queryTask:null,batchSize:5,_queryInfo:null,_fetchDfd:null,_startPage:null,_lastPage:null,_pageSize:null,_maxPages:null,_requests:null,constructor:function(b){l.mixin(this,
b);this._requests={}},destroy:function(){this.cancel()},fetch:function(){var b=new q;this.cancel(!0);this._queryInfo=this.mode._createQueryInfo();this._pageSize=this.mode._getPageSize(this._queryInfo.query);this._maxPages=Math.ceil(this._getFeatureCount()/this._pageSize);this._fetchDfd=b;this._sendRequests();return b.promise},cancel:function(b){this._cancelPendingRequests(b);this._reset()},_reset:function(){this._startPage=this._lastPage=null;this._requests={}},_getFeatureCount:function(){return this.layer.mode===
this.layer.constructor.MODE_AUTO&&0===this.layer.getLastExceedsLimitResult()?this.layer._getMaxFeaturesForAutoSnapshotMode():this.mode.maxFeatures},_sendRequests:function(b){var e=this._queryInfo.query,u=this.queryTask,m=this._requests,k;b=null==b?1:b;k=b+this.batchSize-1;k>this._maxPages&&(k=this._maxPages);if(!(b>k))for(this._startPage=b,this._lastPage=k;b<=k;b++)e.start=(b-1)*this._pageSize,e.num=this._pageSize,m[b]=u.execute(e,null,null,this._queryInfo.pbf?{format:"pbf"}:null),m[b].then(l.hitch(this,
this._handleSuccess,b)).otherwise(l.hitch(this,this._handleError,b))},_evalNextBatch:function(b){b===this._lastPage&&this._sendRequests(this._lastPage+1)},_handleSuccess:function(b,e){e.exceededTransferLimit||this._cancelLaterRequests(b,!0);var p=this.mode._checkMaxLimit(e.features);this._fetchDfd.progress({features:p.features,isError:!1});p.maxLimitReached?((b=p.featuresDiscarded||this._hasRejectedRequests())||(b=!!this._getResult(this._getLastSuccessfulRequest()).exceededTransferLimit),this._resolveFetch(b)):
(e.exceededTransferLimit&&this._evalNextBatch(b),this._evalResolution())},_handleError:function(b,e){var p=this._requests;p&&p[b]&&(1===b?this._rejectFetch(e):(this._evalNextBatch(b),this._fetchDfd.progress({error:e,isError:!0}),this._evalResolution()))},_evalResolution:function(){this._hasPendingRequests()||this._resolveFetch(this._hasRejectedRequests())},_resolveFetch:function(b){var e=this._hasRejectedRequests();this.cancel(!0);this._fetchDfd.resolve({hasPartialFeatures:b,hasUpdateError:e})},_rejectFetch:function(b){this.cancel(!0);
this._fetchDfd.reject(b)},_getResult:function(b){return b&&b.dfd.results[0]},_hasPendingRequests:function(){return!!this._getPendingRequests().length},_getPendingRequests:function(){var b=this._requests,e,l=[];for(e in b){var m=b[e];m.isFulfilled()||l.push({pageId:Number(e),dfd:m})}return l},_getLastSuccessfulRequest:function(){var b=this._getResolvedRequests(),p=-Infinity,l,b=e.filter(b,function(b){return!!this._getResult(b).features.length||1===b.pageId},this);e.forEach(b,function(b){b.pageId>p&&
(p=b.pageId,l=b)});return l},_getResolvedRequests:function(){var b=this._requests,e,l=[];for(e in b){var m=b[e];m.isResolved()&&l.push({pageId:Number(e),dfd:m})}return l},_hasRejectedRequests:function(){var b=this._getRejectedRequests(),l=this._getLastSuccessfulRequest(),q=this._getResult(l);q&&!q.exceededTransferLimit&&(b=e.filter(b,function(b){return b.pageId<=l.pageId}));return!!b.length},_getRejectedRequests:function(){var b=this._requests,e,l=[];for(e in b){var m=b[e];m.isRejected()&&l.push({pageId:Number(e),
dfd:m})}return l},_cancelPendingRequests:function(b){this._cancelRequests(this._getPendingRequests(),b)},_cancelLaterRequests:function(b,l){var p=e.filter(this._getPendingRequests(),function(e){return e.pageId>b});this._cancelRequests(p,l)},_cancelRequests:function(b,l){var p=this.mode,m=this._requests;e.forEach(b,function(b){l&&delete m[b.pageId];p._cancelPendingRequest(b.dfd)})}});r("extend-esri")&&l.setObject("layers.support.ParallelSnapshot",t,b);return t})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),
function(t,l,e,r,q,b,u,p,v,m){t=t([v],{declaredClass:"esri.layers._OnDemandMode",constructor:function(b){this.featureLayer=b;this._featureMap={}},initialize:function(b){this.inherited(arguments);var d=this.featureLayer,f=d._srInfo;this._gridLayer=new m(new u(f?f.valid[0]:b.extent.xmin,f?f.valid[1]:b.extent.ymax,b.spatialReference),{width:d._tileWidth,height:d._tileHeight},{width:b.width,height:b.height},f);this._cellMap={};this._gridLayer.setResolution(b.extent)},startup:function(){if(!this._started||
this._isSuspendedAtStartup)this.inherited(arguments),this._ioQueue=[],this._isSuspendedAtStartup=this.featureLayer.suspended,this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(b){this._init&&(2>b?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this._processIOQueue(!0);
this.inherited(arguments)},drawFeature:function(b){var d=b.geometry,f=[];if(d){var f=this._gridLayer.getCellsInExtent("point"===d.type?{xmin:d.x,ymin:d.y,xmax:d.x,ymax:d.y}:d.getExtent(),!1).cells,d=this._cellMap,e,h,a=b.attributes[this.featureLayer.objectIdField],c,k,m;for(e=0;e<f.length;e++)h=f[e],c=h.latticeID,k=h.row,m=h.col,c?h=d[c]=d[c]||h:(d[k]=d[k]||{},h=d[k][m]=d[k][m]||h),h.features=h.features||[],h.features.push(b),this._addFeatureIIf(a,b),this._incRefCount(a)}},suspend:function(){this._init&&
this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},hasAllFeatures:function(){var b=!1,d=this._getCurrentCells(),f;for(f=0;f<d.length;f++)if(d[f].hasPartialFeatures){b=!0;break}return!b},hasUpdateError:function(){var b=!1,d=this._getCurrentCells(),f;for(f=0;f<d.length;f++)if(d[f].hasUpdateError){b=!0;break}return b},canFetchPBF:function(b){return this.inherited(arguments)&&this.featureLayer._canFetchPBFForQuery(b)},
_enableConnectors:function(){var b=this.map;this._zoomConnect=l.connect(b,"onZoomEnd",this,this._zoomHandler);this._panConnect=l.connect(b,"onPanEnd",this,this._panHandler);this._resizeConnect=l.connect(b,"onResize",this,this._panHandler)},_disableConnectors:function(){l.disconnect(this._zoomConnect);l.disconnect(this._panConnect);l.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var b=this.featureLayer,d=this.map;!b.suspended&&b.isQueryable()&&(b._fireUpdateStart(),
this._clearIIf(),(b=b._trackManager)&&b.clearTracks(),this._cellMap={},this._gridLayer.setResolution(d.extent),this._sendRequest())},_panHandler:function(b){if(this.featureLayer.isQueryable()){this.featureLayer._fireUpdateStart();var d=this.featureLayer._resized;b=d?b:null;d&&this._gridLayer.setMapState(b,this.map.width,this.map.height);this._sendRequest(b)}},_sendRequest:function(b){this._exceeds=!1;var d=this.featureLayer,f=this.map;b=b||f.extent;f=this._gridLayer.getCellsInExtent(b,d.latticeTiling).cells;
if(!d.isEditable())var k=this._cellMap,f=r.filter(f,function(a){if(a.lattice){if(k[a.latticeID])return!1}else if(k[a.row]&&k[a.row][a.col])return!1;return!0});this._pending=this._pending||0;var h;for(h=0;h<f.length;h++){var a=f[h],c=this._createQuery(a),n=this.canFetchPBF(c);d._enableEditModeQuantization(c,n);this._pending++;this._ioQueue.push(d._task.execute(c,e.hitch(this,this._drawFeatures,a),e.hitch(this,this._queryErrorHandler,a),n?{format:"pbf"}:null))}this._removeOldCells(b);this._endCheck()},
_drawFeatures:function(b,d){b.hasPartialFeatures=!!d.exceededTransferLimit;b.hasUpdateError=!1;this._exceeds=this._exceeds||d.exceededTransferLimit;this._finalizeIO();var f=this.featureLayer,e=this.map.extent,h=b.extent,a=b.row,c=b.col,k=f.objectIdField;d=d.features;var m=this._gridLayer,l=this._cellMap,p=b.latticeID,l=p?l[p]:l[a]&&l[a][c];if(b.resolution==m._resolution&&(p?p===m.getLatticeID(e):m.intersects(h,e)))if(l)f._sortFeatures(d),this._updateCell(l,d);else for(f._sortFeatures(d),b.features=
d,this._addCellToCellMap(b),f=d.length,b=0;b<f;b++)e=d[b],h=e.attributes[k],this._addFeatureIIf(h,e),this._incRefCount(h);else l&&this._removeCell(a,c,p);this._endCheck()},_queryErrorHandler:function(b,d){this._finalizeIO();b.hasPartialFeatures=!0;b.hasUpdateError=!0;this._addCellToCellMap(b);this.featureLayer._errorHandler(d);this._endCheck(d)},_finalizeIO:function(){this._pending--},_endCheck:function(b){if(0===this._pending){this._processIOQueue();var d=this.featureLayer,f=d._trackManager;f&&(f.clearTracks(),
f.addFeatures(d.graphics),d._ager&&r.forEach(d.graphics,function(b){b._shape&&d._repaint(b)}),f.moveLatestToFront(),f.drawTracks());this.featureLayer._fireUpdateEnd(!!b&&Error("FeatureLayer: "+(b.message||"an error occurred while updating the layer.")),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)d.onQueryLimitExceeded()}},_processIOQueue:function(b){this._ioQueue=r.filter(this._ioQueue,function(d){return-1<d.fired?!1:!0});b&&r.forEach(this._ioQueue,this._cancelPendingRequest)},_createQuery:function(b){var d=
this.featureLayer,f=new p;f.outFields=d.getOutFields();f.where=d.getDefinitionExpression();f.returnGeometry=!0;f.geometry=b.extent||b.lattice;d.latticeTiling&&b.extent&&(f.spatialRelationship=p.SPATIAL_REL_CONTAINS);f.timeExtent=d._getOffsettedTE(d._mapTimeExtent);f.maxAllowableOffset=d._maxOffset;f.quantizationParameters=d._quantizationParameters;f.orderByFields=d.supportsAdvancedQueries?d.getOrderByFields():null;f.multipatchOption=d.multipatchOption;d._ts&&(f._ts=(new Date).getTime());(b=d.advancedQueryCapabilities)&&
b.supportsQueryWithResultType&&(f.resultType="tile");return f},_getCurrentCells:function(b){var d=[];b=b||this._cellMap;for(var f in b)if(b.hasOwnProperty(f)){var e=b[f];e&&(e.hasOwnProperty("row")||e.hasOwnProperty("latticeID")?d.push(e):"object"===typeof e&&d.push.apply(d,this._getCurrentCells(e)))}return d},_addCellToCellMap:function(b){var d=this._cellMap;if(b.latticeID)d[b.latticeID]=b;else{var f=b.row,e=b.col;d[f]=d[f]||{};d[f][e]=b}},_removeOldCells:function(b){var d=this._cellMap,f=this._gridLayer,
e,h;for(e in d)if(d[e]){var a=d[e],c=a.latticeID,k=0,m=0;if(c)k++,c!==f.getLatticeID(b)&&(this._removeCell(null,null,c),m++);else for(h in a)a[h]&&(k++,f.intersects(a[h].extent,b)||(this._removeCell(e,h),m++));m===k&&delete d[e]}},_updateCell:function(b,d){var f=this.featureLayer,e=f.objectIdField,f=f._selectedFeatures,h,a=d.length;b.features=b.features||[];for(h=0;h<a;h++){var c=d[h],k=c.attributes[e],m=this._addFeatureIIf(k,c);m===c?(this._incRefCount(k),b.features.push(m)):k in f||(m.setGeometry(c.geometry),
m.setAttributes(c.attributes))}},_removeCell:function(b,d,f){var e=this._cellMap,h=this.featureLayer,a=h.objectIdField,c=f?e[f]:e[b]&&e[b][d];if(c&&(f?delete e[f]:delete e[b][d],b=c.features))for(d=0;d<b.length;d++)f=b[d].attributes[a],this._decRefCount(f),f in h._selectedFeatures||this._removeFeatureIIf(f)}});q("extend-esri")&&e.setObject("layers._OnDemandMode",t,b);return t})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/Polyline ../srUtils".split(" "),
function(t,l,e,r,q,b,u,p,v){t=t(null,{declaredClass:"esri.layers._GridLayout",constructor:function(b,e,d,f){this.origin=b;this.cellWidth=e.width;this.cellHeight=e.height;this.mapWidth=d.width;this.mapHeight=d.height;this.srInfo=f},setResolution:function(b){this._resolution=(b.xmax-b.xmin)/this.mapWidth;this.srInfo&&(b=Math.round(Math.round(2*this.srInfo.valid[1]/this._resolution)/this.cellWidth),this._frameStats=[b,0,b-1])},setMapState:function(b,e,d){this.mapWidth=e;this.mapHeight=d;this.setResolution(b)},
getCellCoordinates:function(b){var e=this._resolution,d=this.origin;return{row:Math.floor((d.y-b.y)/(this.cellHeight*e)),col:Math.floor((b.x-d.x)/(this.cellWidth*e))}},normalize:function(b){var e=this._frameStats;if(e){var d=e[0],f=e[1],e=e[2];b<f?(b%=d,b=b<f?b+d:b):b>e&&(b%=d)}return b},intersects:function(b,k){var d=this.srInfo;return d?e.some(k._getParts(d),function(d){return b.intersects(d.extent)}):b.intersects(k)},getCellExtent:function(b,e){var d=this._resolution,f=this.origin,k=this.cellWidth,
h=this.cellHeight;return new u(e*k*d+f.x,f.y-(b+1)*h*d,(e+1)*k*d+f.x,f.y-b*h*d,v.createSpatialReference(f.spatialReference.toJson()))},getLatticeID:function(b){var e=this.getCellCoordinates({x:b.xmin,y:b.ymax}),d=this.getCellCoordinates({x:b.xmax,y:b.ymin});b=e.row;var f=d.row,e=this.normalize(e.col),d=this.normalize(d.col);return b+"_"+f+"_"+e+"_"+d},sorter:function(b,e){return b<e?-1:1},getCellsInExtent:function(b,k){var d=this.getCellCoordinates({x:b.xmin,y:b.ymax}),f=this.getCellCoordinates({x:b.xmax,
y:b.ymin}),l=d.row,h=f.row,d=d.col,f=f.col,a=[],c,n,m,q=[],r=[],u,t,g=[];for(c=l;c<=h;c++)for(n=d;n<=f;n++)m=this.normalize(n),b=this.getCellExtent(c,m),e.some(a,function(a){return a.row===c&&a.col===m})||a.push({row:c,col:m,extent:b,resolution:this._resolution}),k&&(q.push(b.xmin,b.xmax),r.push(b.ymin,b.ymax));d=this.normalize(d);f=this.normalize(f);q.sort(this.sorter);r.sort(this.sorter);k=q.length;for(c=k-1;0<=c;c--)c<k-1&&q[c]===q[c+1]&&q.splice(c,1);k=r.length;for(c=k-1;0<=c;c--)c<k-1&&r[c]===
r[c+1]&&r.splice(c,1);if(q.length&&r.length){b=q[0];n=q[q.length-1];u=r[0];t=r[r.length-1];k=q.length;for(c=0;c<k;c++)g.push([[q[c],t],[q[c],u]]);k=r.length;for(c=0;c<k;c++)g.push([[b,r[c]],[n,r[c]]]);q=new p({paths:g,spatialReference:this.origin.spatialReference.toJson()});a.push({latticeID:l+"_"+h+"_"+d+"_"+f,lattice:q,resolution:this._resolution})}return{minRow:l,maxRow:h,minCol:d,maxCol:f,cells:a}}});r("extend-esri")&&l.setObject("layers._GridLayout",t,q);return t})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel","./RenderMode"],function(t,l,e,r,q){t=t([q],{declaredClass:"esri.layers._SelectionMode",constructor:function(b){this.featureLayer=b;this._featureMap={}},propertyChangeHandler:function(b){this._init&&0===b&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)},hasAllFeatures:function(){return!this.featureLayer._hasPartialSelectedFeatures},hasUpdateError:function(){return this.featureLayer._hasSelectionError}});e("extend-esri")&&l.setObject("layers._SelectionMode",
t,r);return t})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),function(t,l,e,r,q,b,u,p,v,m,k){t=t([k],{declaredClass:"esri.layers._StreamMode",constructor:function(d,b){this.featureLayer=d;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=l.hitch(this,
this._flushDrawBuffer);this._featuresByTime={};this._lastEndTimeCheck=null;this._maxFeatureAge=0;d.purgeOptions&&d.purgeOptions.age&&"number"===typeof d.purgeOptions.age&&(this._maxFeatureAge=1E3*Math.ceil(60*d.purgeOptions.age));this._drawFeatures=l.hitch(this,this._drawFeatures);this._queryErrorHandler=l.hitch(this,this._queryErrorHandler)},startup:function(){this._started||this.inherited(arguments)},propertyChangeHandler:function(d){this._init&&(0===d?this._applyTimeFilter():3===d?this._redrawAllTracks():
console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id \x3d "+this.featureLayer.id))},destroy:function(){this.inherited(arguments);clearTimeout(this._timeoutId);this._featuresByTime=this._drawBuffer=this._featureMap=null},drawFeature:function(d){var b=this.featureLayer,e=b.objectIdField;this._timeoutId||(this._timeoutId=setTimeout(this._flushDrawBuffer,this._refreshRate));b._joinField&&this._getFeature(d.attributes[e])?this._drawBuffer.updates.push({oid:d.attributes[e],
updates:d}):this._drawBuffer.adds.push(d)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);var d=this.featureLayer;d&&(d._relatedUrl||d._keepLatestUrl?(d._fireUpdateStart(),d._refreshing=!0,d.disconnect(),d.clear(),d._relatedQueried=!1,d._keepLatestQueried=!1,d.connect()):(d._fireUpdateStart(),d.clear(),d._fireUpdateEnd()))},_drawFeatures:function(d,b){var e=this.featureLayer;e._create(d.features||[]);e._fireUpdateEnd(null,
b)},_applyTimeFilter:function(d){this.inherited(arguments);this._redrawAllTracks()},_removeFeatures:function(d){var b=this.featureLayer,k=b.objectIdField;d&&e.forEach(d,function(d){d=d.attributes[k];b._unSelectFeatureIIf(d,this);this._decRefCount(d);this._removeFeatureIIf(d)},this)},_addFeatures:function(d){var b=this.featureLayer,k=b._endTimeField,h=b._startTimeField,a,c,n,l=[],m=[],p=[];a=b._trackManager;c=b.objectIdField;if(a)for(n in d=a.addFeatures(d),d)d.hasOwnProperty(n)&&(l.push(n),d[n].adds&&
(m=m.concat(d[n].adds)),d[n].deletes&&(p=p.concat(d[n].deletes)));else m=d;e.forEach(m,function(a){var d=a.attributes[c],b;b=k&&a.attributes[k];!b&&this._maxFeatureAge&&(b=h&&a.attributes[h]?a.attributes[h]+this._maxFeatureAge:Date.now()+this._maxFeatureAge);b&&(b=1E3*Math.ceil(b/1E3),this._featuresByTime[b]?this._featuresByTime[b].push(d):this._featuresByTime[b]=[d]);this._addFeatureIIf(d,a);this._incRefCount(d)},this);p.length&&this._removeFeatures(p);a&&a.refreshTracks(l)},_updateFeatures:function(d){var b=
this.featureLayer,k,h,a=[];k=b._trackManager;h=b._trackIdField;e.forEach(d,function(c){var d=c.updates;c=this._getFeature(c.oid);var e;if(c){d.geometry&&c.setGeometry(d.geometry);d=d.attributes||{};for(e in d)d.hasOwnProperty(e)&&(c.attributes[e]=d[e]);c.setAttributes(c.attributes);c.visible=this._checkFeatureTimeIntersects(c);k&&c.attributes[h]?a.push(c.attributes[h]):b._repaint(c,null,!0)}},this);a.length&&k.refreshTracks(a)},_redrawAllTracks:function(){var d=this.featureLayer._trackManager,b;d&&
(b=d.trimTracks())&&0<b.length&&(this._removeFeatures(b),d.refreshTracks())},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);var d=this._drawBuffer,b=d.adds.splice(0,d.adds.length),e=d.updates.splice(0,d.updates.length),d=this.featureLayer;if(!d)return!1;d.updating||d._fireUpdateStart();this._addFeatures(b);this._updateFeatures(e);(b=this._getExpiredFeatures())&&b.length&&(this._removeFeatures(b),d._trackManager&&d._trackManager.removeFeatures(b));d._purge();d._fireUpdateEnd();this._timeoutId=
null},_clearDrawBuffer:function(){var d=this._timeoutId,b=this._drawBuffer,e=b.adds,b=b.updates;d&&clearTimeout(d);e.splice(0,e.length);b.splice(0,b.length);this._timeoutId=null},_clearTimeBin:function(){this._featuresByTime={};this._lastEndTimeCheck=1E3*Math.ceil(Date.now()/1E3)},_clearFeatureMap:function(){this._featureMap={}},_setRefreshRate:function(d){d=d||0===d?d:200;0>d&&(d=200);this._refreshRate=d},_checkFeatureTimeIntersects:function(d){var b=this.featureLayer,e=b.getMap();return(e=e?e.timeExtent:
null)&&b.timeInfo&&(b.timeInfo.startTimeField||b.timeInfo.endTimeField)?0<b._filterByTime([d],e.startTime,e.endTime).match.length:!0},_fetchArchive:function(d){var b=new r,e=this.featureLayer,h,a,c,k,l;this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);e._fireUpdateStart();d&&this.map?(d=new v(d),h=new p,a=this.map,c=e.getFilter()||{},k=c.where||"1\x3d1",l=c.geometry?m.fromJson(c.geometry):null,c=c.outFields?c.outFields.split(","):["*"],h.geometry=l,h.where=k,h.outFields=c,h.returnGeometry=
!0,h.outSpatialReference=new u(a.spatialReference.toJson()),this._pendingRequest=d.execute(h).then(function(a){this._pendingRequest=null;var c=this._fixFieldNameCasing(e,a);a.features=c;this._drawFeatures(a);e._fireUpdateEnd();b.resolve()}.bind(this)).otherwise(function(a){this._pendingRequest=null;e._errorHandler(a);e._fireUpdateEnd(a);b.reject(a)}.bind(this))):b.resolve();return b.promise},_queryErrorHandler:function(d){var b=this.featureLayer;b._errorHandler(d);b._fireUpdateEnd(d)},_fixFieldNameCasing:function(d,
b){var e=b.features||[],h=b.fields;if(!h||!e.length)return e;d=this._mapFieldNameDifferences(d.fields,h);for(var h=[],a,c=0,f=b.features.length;c<f;c++)b=e[c],a=this._swizzleResponseAttributes(b.attributes,d),h.push({geometry:b.geometry,attributes:a});return h},_mapFieldNameDifferences:function(d,b){var e=[],h={},a,c;a=0;for(c=b.length;a<c;a++)e.push(b[a].name);a=0;for(c=d.length;a<c;a++){b=d[a].name;var f=this._checkForStreamFieldName(b,e);f&&(h[f]=b)}return h},_checkForStreamFieldName:function(d,
b){d=d.toLowerCase();for(var e,h=0,a=b.length;h<a;h++)if(b[h].toLowerCase()===d){e=b[h];break}return e},_swizzleResponseAttributes:function(d,b){var e={},h;for(h in d)if(d.hasOwnProperty(h)){var a=d[h];b.hasOwnProperty(h)?e[b[h]]=a:e[h]=a}return e},_getExpiredFeatures:function(){var d,b,k,h=[],a=[];if(!this.featureLayer._endTimeField&&!this._maxFeatureAge)return a;d=1E3*Math.floor(this._lastEndTimeCheck/1E3);this._lastEndTimeCheck=b=1E3*Math.ceil(Date.now()/1E3);if(d&&d!==b)for(k=this._featuresByTime;d<=
b;d+=1E3)k[d]&&(h=h.concat(k[d]),delete k[d]);e.forEach(h,function(c){(c=this._getFeature(c))&&a.push(c)},this);return a}});q("extend-esri")&&l.setObject("layers._StreamMode",t,b);return t})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/dom-construct dojox/gfx ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),function(t,l,e,r,q,b,u,p,v,m){var k=-1!==b.renderer.toLowerCase().indexOf("canvas");t=t(null,{declaredClass:"esri.layers._TrackManager",
constructor:function(d){this.layer=d;this.trackMap={};this.trackLineMap={}},initialize:function(d){this.map=d;d=this.layer;this.createTracklineContainer()&&(d.on("visibility-change",l.hitch(this,function(d){this.container.setVisibility(d.visible);this.container.evaluateSuspension()})),d.on("scale-range-change",l.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)})))},createTracklineContainer:function(){var d=this.layer;if("esriGeometryPoint"!==d.geometryType)return null;
var b=this.map,e=d._getRenderer(),e=e&&e.trackRenderer,h=this.container=new m._GraphicsLayer({id:d.id+"_tracks",_child:!0,visible:d.visible,minScale:d.minScale,maxScale:d.maxScale});h.loaded=!0;h.onLoad(h);h._setMap(b,d._div);k||(b=h._div.getNode(),d=d._div.getNode(),b&&d&&q.place(b,d,"first"));h.setRenderer(e);return h},addFeatures:function(d){var b=this.trackMap,k=this.layer,h=k._trackIdField,a=[];e.forEach(d,function(c){var d=c.attributes[h];(b[d]=b[d]||[]).push(c);-1===e.indexOf(a,d)&&a.push(d)});
var c=k._startTimeField,n=k.objectIdField,l=function(a,d){var b=a.attributes[c],h=d.attributes[c];return b===h?a.attributes[n]<d.attributes[n]?-1:1:b<h?-1:1};e.forEach(a,function(a){b[a].sort(l)})},trimTracks:function(d){function b(c){for(c=k[c]||[];c.length>h;)a.push(c.shift())}var k=this.trackMap,h=this.layer.maximumTrackPoints||0,a=[],c;if(!h)return a;if(d)e.forEach(d,function(a){b(a)});else for(c in k)k.hasOwnProperty(c)&&b(c);return a},drawTracks:function(d){function b(d){var b=a[d],e,f,g;f=
k.trackLineMap[d];h.remove(f);delete k.trackLineMap[d];f=null;if(!b||2>b.length)return!1;f=[];for(e=b.length-1;0<=e;e--)(g=b[e].geometry)&&f.push([g.x,g.y]);b={};b[n]=d;1<f.length&&(f=new p(new v({paths:[f],spatialReference:c}),null,b),h.add(f),k.trackLineMap[d]=f)}var k=this,h=this.container,a,c,n,l;if(h)if(a=this.trackMap,c=this.map.spatialReference,n=this.layer._trackIdField,d)e.forEach(d,function(a){b(a)});else for(l in a)a.hasOwnProperty(l)&&b(l)},refreshTracks:function(d){function b(b){var d,
e;k.drawTracks([b]);if(c&&c.latestObservationRenderer)for(b=h[b]||[],d=b.length,e=0;e<d;e++)a._repaint(b[e],null,!0)}var k=this,h=this.trackMap,a=this.layer,c=a._getRenderer(),n;if(d)e.forEach(d,function(a){b(a)});else for(n in h)h.hasOwnProperty(n)&&b(n);this.moveLatestToFront()},moveLatestToFront:function(b){e.forEach(this.getLatestObservations(b),function(b){var d=b._shape;d&&d._moveToFront();this._repaint(b,null,!0)},this.layer)},getLatestObservations:function(b){function d(c){c=a[c];return c[c.length-
1]}var k=[],h=this.layer._getRenderer(),a=this.trackMap,c;if(!h.latestObservationRenderer)return k;if(b)e.forEach(b,function(a){k.push(d(a))});else for(c in a)a.hasOwnProperty(c)&&k.push(d(c));return k},clearTracks:function(b){var d=this.getLatestObservations(b),k=this.container,h=this.trackMap,a,c;if(b)e.forEach(b,function(a){delete this.trackMap[a];k&&(c=this.trackLineMap[a],k.remove(c),delete this.trackLineMap[a])},this);else{if(k)for(a in h)c=this.trackLineMap[a],k.remove(c);this.trackMap={};
this.trackLineMap={}}e.forEach(d,function(a){this._repaint(a,null,!0)},this.layer)},isLatestObservation:function(b){var d=this.trackMap[b.attributes[this.layer._trackIdField]];return d?d[d.length-1]===b:!1},destroy:function(){var b=this.container;b&&(b.clear(),b._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});r("extend-esri")&&l.setObject("layers._TrackManager",t,u);return t})},"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ../geometry/webMercatorUtils ./MapImage ../renderers/HeatmapRenderer ../tasks/query dojo/_base/fx".split(" "),
function(t,l,e,r,q,b,u,p,v,m,k,d,f){function z(){}function h(a){var c=a.layer;return{geometry:a.geometry,attributes:a.attributes,getLayer:function(){return c}}}t=t(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(a){this.sourceLayer=a;this._hndls=[]},initialize:function(a){this.map=a;var c=this.sourceLayer,b=c.renderer;c.setDrawMode(!1);this.imageLayer=a._getMapImageLyr();var d=this;this.heatmapRenderer=
b instanceof k?b:(b.getRendererInfoByZoom(a.getZoom())||b.getRendererInfoByScale(a.getScale())).renderer;this.redraw=this.redraw.bind(this);this.recalculateHeatmap=this.recalculateHeatmap.bind(this);this._removeRenderer=this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._rendererChangeHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);this._handleOpacityChange=this._handleOpacityChange.bind(this);this._reprojectFeature=this._reprojectFeature.bind(this);
q(["../workers/heatmapCalculator"],function(a){d._calculator=new a(l.mixin({width:d.map.width,height:d.map.height},d._getOptions()));d._setupRenderer();d.heatmapRenderer.getStats=a.calculateStats;d.heatmapRenderer.getHistogramData=a.getHistogramData})},destroy:function(){this._removeHandlers();this._rendererChangeHandle&&this._rendererChangeHandle.remove();this._rendererChangeHandle=this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=null},_handleRendererChange:function(a){var c=
a.renderer,b=c instanceof k;this.heatmapRenderer?b?this.heatmapRenderer=c:this._removeRenderer(a):b&&(this.heatmapRenderer=c,this.sourceLayer&&this.map&&this._setupRenderer())},_handleOpacityChange:function(a){a=a.opacity;var c=this._getImageBySourceId(this.sourceLayer.id);c&&c.setOpacity(a)},_setupRenderer:function(){var a=this._hndls,c=this.sourceLayer,b=this.map,d=this;c._originalDraw=c._draw;c._draw=z;c._div.clear();clearTimeout(this._resetTimer);this._resetTimer=setTimeout(this._resetGraphics.bind(this),
250);a.push(c.on("update-end",this.redraw));a.push(c.on("suspend",function(a){(a=d._getImageBySourceId(d.sourceLayer.id))&&a.hide()}));a.push(c.on("resume",function(a){(a=d._getImageBySourceId(d.sourceLayer.id))&&a.show()}));a.push(e.after(c,"redraw",this.redraw));a.push(b.on("layer-remove",function(a){a.layer==c&&((a=d._getImageBySourceId(d.sourceLayer.id))&&d.imageLayer.removeImage(a),d._removeRenderer({target:c}))}));c._collection&&a.push(c.on("graphic-add",function(a){d._reprojectFeature(a.graphic);
d.redraw()}));1!==c.mode&&(a.push(b.on("resize, pan-end",this.redraw)),a.push(b.on("zoom-end",this.redraw)));a.push(c.on("opacity-change",this._handleOpacityChange));this.imageLayer.suspended&&this.imageLayer.resume();c.graphics&&c.graphics.length&&(c.graphics[0].geometry&&!b.spatialReference.equals(c.graphics[0].geometry.spatialReference)&&r.forEach(c.graphics,function(a){this._reprojectFeature(a)}.bind(this)),this.redraw())},redraw:function(){if(!this._drawTimer){var a=this;this._drawTimer=setTimeout(function(){clearTimeout(a._drawTimer);
a._drawTimer=null;a.sourceLayer._getRenderer().isInstanceOf(k)&&a.recalculateHeatmap()},16)}},_removeRenderer:function(a){var c=a.target;c._draw=c._originalDraw;delete c._originalDraw;c.setDrawMode(!0);this._removeHandlers();this._hndls=[];var b=this._getImageBySourceId(this.sourceLayer.id);b&&this.imageLayer.removeImage(b);clearTimeout(this._drawTimer);clearTimeout(this._resetTimer);this._drawTimer=this._resetTimer=null;c.renderer!=a.renderer&&c.renderer.getRendererInfo?this.heatmapRenderer=null:
(this.destroy(),c.renderer&&c.renderer.getRendererInfo&&c.redraw())},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():this._calculatorClient&&this._doWorkerCalculation()},_reprojectFeature:function(a){if(a&&a.geometry){var c=a.geometry,b=this.map.spatialReference;b.equals(c.spatialReference)||(c=v.project(c,b),null==c?console.log("Unable to reproject features to map's spatial reference. Please convert feature geometry before adding to layer"):a.geometry=c)}},_doWorkerCalculation:function(){},
_doMainCalculation:function(){var a=this.sourceLayer,c=this.map,b=this.heatmapRenderer,e=this.map.extent,f=this.map.width,k=this.map.height,p=this._calculator,q=this,g=function(d){d=q._getScreenPoints(d.features,c,a);d=p.calculateImageData(l.mixin({screenPoints:d,mapinfo:{extent:[e.xmin,e.ymin,e.xmax,e.ymax],resolution:c.getResolution()},width:f,height:k},q._getOptions()));d=b.getSymbol(h({geometry:c.extent,attributes:{size:[f,k],imageData:d},layer:a}));d=new m({extent:c.extent,href:d.url,opacity:0,
sourceId:a.id});q._swapMapImages(d,q._getImageBySourceId(a.id));a.suspended&&d.hide()},C={geometry:c.extent,timeExtent:a.useMapTime?c.timeExtent:void 0,spatialRelationship:d.SPATIAL_REL_INTERSECTS};null!=a._canDoClientSideQuery(C)?a.queryFeatures(C,g):g({features:a.graphics})},_getScreenPoints:function(a,c,b){var d=[],h=a.length,e=0,f=0,k,g=new p(c.extent.xmin,c.extent.ymax,c.spatialReference),n=c.toScreen(g),l=n.x,n=n.y,m=c.getResolution(),q;for((f=c.extent.getCacheValue("_parts"))&&(q=r.map(f,function(a){return b._intersects(c,
a.extent)[0]}));h--;)f=a[h],f.geometry&&f.visible&&(k={x:Math.ceil((f.geometry.x-g.x)/m+l),y:Math.floor((g.y-f.geometry.y)/m-n),attributes:f.attributes},q&&(f=1<q.length&&k.x<-q[0]?q[1]:q[0],k.x+=f),d[e++]=k);return d},_getImageBySourceId:function(a){var c=this.imageLayer.getImages(),c=r.filter(c,function(c){return c.sourceId==a});if(c.length)return c[c.length-1]},_swapMapImages:function(a,c){function b(){d.removeImage(c)}var d=this.imageLayer,h=this.sourceLayer.opacity;d.addImage(a);f.anim(a._node,
{opacity:h},null,null,function(){a.opacity=h});null!=c&&f.anim(c._node,{opacity:0},null,null,b)},_removeHandlers:function(){if(null!=this._hndls)for(var a=this._hndls.length;a--;)this._hndls[a].remove()},_getOptions:function(){var a=this.heatmapRenderer;return{blurRadius:a.blurRadius,gradient:a.gradient,maxPixelIntensity:a.maxPixelIntensity,minPixelIntensity:a.minPixelIntensity,field:a.field,fieldOffset:a.fieldOffset}},_resetGraphics:function(){clearTimeout(this._resetTimer);this._resetTimer=null;
for(var a=this.sourceLayer.graphics,c=a.length,b;c--;)b=a[c],b._shape=b._offsets=void 0}});u("extend-esri")&&l.setObject("layers.HeatmapManager",t,b);return t})},"esri/layers/clustering/ClusterManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../kernel ../../Evented ../../graphic ../../lang ../../Color ../../graphicsUtils ../../dijit/PopupTemplate ../../dijit/Legend/utils ../../renderers/ClassBreaksRenderer ../../symbols/SimpleMarkerSymbol ../GraphicsLayer ../Field ./GeohashAggregation ./statUtils dojo/i18n!../../nls/jsapi".split(" "),
function(t,l,e,r,q,b,u,p,v,m,k,d,f,z,h,a,c,n,E){var B=E.layers.clusters,A=E.widgets.popup,y=B.numFeatures,w=Math.pow(2,53)-1;t=t(b,{declaredClass:"esri.layers.clustering.ClusterManager",layer:null,aggregationInfo:null,container:null,defaults:{clusterRadius:80,markerSymbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}}},_initialized:!1,_map:null,_eventHandles:null,_clusterRadius:null,
_renderer:null,_statisticInfos:null,_fields:null,_infoTemplate:null,_clusterGenerator:null,_singleGraphics:null,constructor:function(a){this._eventHandles=[];this.layer=a.layer;this.setAggregationInfo(a.aggregationInfo)},initialize:function(a){this._initialized=!0;this._map=a;this.container=this._createContainer();this._clusterGenerator=this._createClusterGenerator();this._initClusterGenerator();this._createLayerEventListeners();this._createMapEventListeners();this._createPopupEventListeners()},destroy:function(a){this._clearSingleGraphics();
this._removeClusterBoundary();this._destroyEventListeners();this._removeFromPopup(this.container);this._removeFromPopup(this.layer);this._resetClusterNav();this._destroyClusterGenerator(a);this._destroyContainer();this.layer=this.aggregationInfo=this._map=null},setAggregationInfo:function(a){this.aggregationInfo=a?l.mixin({},a):null;this._applyAggregationInfo()},getClusterRenderer:function(){return this._renderer},getClusterFields:function(){return this._fields||[]},getFeaturesInCluster:function(a){a=
a&&a.getAggregationInfo();return this._clusterGenerator?this._clusterGenerator.getFeaturesInCluster(a):[]},getAggregateGraphics:function(){return this.container?this.container.graphics.slice(0):[]},getSingleGraphics:function(){return this._singleGraphics?this._singleGraphics.slice(0):[]},redraw:function(){this.container&&this.container.redraw()},isClusteringEnabled:function(){return!(!this._clusterGenerator||!this._clusterGenerator.clustersEnabled)},isClusteringActive:function(){return!!(this._clusterGenerator&&
0<this._clusterGenerator.getNumFeatures())},toggleFeatureVisibility:function(a){this._clusterGenerator&&this._clusterGenerator.toggleFeatureVisibility(a)},_createContainer:function(){var a=this.layer,c=new h._GraphicsLayer({_child:!0,id:a.id+"_clusters",visible:a.visible,minScale:a.minScale,maxScale:a.maxScale,infoTemplate:this._infoTemplate});c.fields=this._fields;c.setRenderer(this._renderer);c.loaded=!0;c.onLoad(c);c._setMap(this._map,a._div);return a._childLayer=c},_destroyContainer:function(){var a=
this.container;a&&(a.clear(),a._unsetMap(this._map,this.layer._div),this.layer._childLayer=null);this.container=null},_createClusterGenerator:function(){return new c({map:this._map,layer:this.layer,clusterRadius:this._clusterRadius,statisticInfos:this._statisticInfos})},_initClusterGenerator:function(){var a=this._clusterGenerator;a.loaded?this._awaitClusterGenerator():this._eventHandles.push(a.on("load",l.hitch(this,function(){this._awaitClusterGenerator()})),a.on("load-error",l.hitch(this,function(a){console.log(a.error)})))},
_destroyClusterGenerator:function(a){this._clusterGenerator&&this._clusterGenerator.destroy(a);this._clusterGenerator=null},_awaitClusterGenerator:function(){var a=this._clusterGenerator;a.started?(this._applyRenderer(),this._initClusterUpdates()):this._eventHandles.push(a.on("start",l.hitch(this,function(){this._applyRenderer();this._initClusterUpdates()})))},_applyAggregationInfo:function(){this._applyClusterRadius();this._applyRenderer();this._clusterGenerator&&!this._clusterGenerator.isUpdateScheduled()&&
this.redraw()},_applyClusterRadius:function(){var a=this.aggregationInfo;this._clusterRadius=a&&a.clusterRadius||this.defaults.clusterRadius;this._clusterGenerator&&this._clusterGenerator.setClusterRadius(this._clusterRadius);this._computeClusterRadius()},_computeClusterRadius:function(){var a=this.aggregationInfo||{};a.clusterRadius=this._clusterRadius;this.aggregationInfo=a},_applyRenderer:function(){var a=this.container,c=this._getClusterRendererInfo(),b=this._compareStatInfos(this._statisticInfos,
c.statisticInfos);b&&(this._statisticInfos=c.statisticInfos,this._clusterGenerator&&(this._clusterGenerator.setStatisticInfos(e.map(this._statisticInfos,function(a){return{attributeInfo:a.attributeInfo,statisticType:a.statisticType}})),a&&e.forEach(a.graphics,function(a){this._applyClusterAttributes(a,a.getAggregationInfo())},this)));this._renderer=c.renderer;this._applyFields();this._applyInfoTemplate(!!b&&this._initialized);a&&(a.setRenderer(this._renderer),this.emit("renderer-change"))},_applyFields:function(){this._fields=
this._getFields(this._statisticInfos);this.container&&(this.container.fields=this._fields)},_applyInfoTemplate:function(a){if(this.layer.infoTemplate){var c=this.aggregationInfo,c=c&&c.infoTemplate||this._infoTemplate;a=a||!c?this._createInfoTemplate():this._updateInfoTemplate(c)}else a=null;this._infoTemplate=a;this.container&&this.container.setInfoTemplate(this._infoTemplate);this._computeInfoTemplate()},_computeInfoTemplate:function(){var a=this.aggregationInfo||{};a.infoTemplate=this._infoTemplate;
this.aggregationInfo=a},_getClusterRendererInfo:function(){var a=this.layer&&this.layer.renderer;return a?this._createClusterRenderer(a):this._getDefaultClusterRenderer()},_getDefaultClusterRenderer:function(){var a=this._createContinuousCountRenderer();this._addSizeByCountVariable(a);return{renderer:a,statisticInfos:[]}},_createContinuousCountRenderer:function(a){var c=new f(null,"cluster_count");c.addBreak({minValue:-w,maxValue:w,symbol:a?new a.constructor(a.toJson()):new z(l.clone(this.defaults.markerSymbol))});
return c},_createClusterRenderer:function(a){if(!this._isSupportedRenderer(a))return this._getDefaultClusterRenderer();var c,b=[];if(this._isSimpleRenderer(a))c=this._createContinuousCountRenderer(a.symbol);else{c=new a.constructor(a.toJson());var d=this._getRendererAttributeInfo(a),g;this._isCBRenderer(c)?(g=n.getClusterField(d,"avg"),b.push(this._getStatInfo(d,"avg")),c.normalizationType=null,c.normalizationField=null,c.normalizationTotal=null):this._isUVRenderer(c)&&(g=n.getClusterField(d,"type"),
b.push(this._getStatInfo(d,"type")));c.attributeField=g;c.setValueExpression(null);c.valueExpressionTitle=null;c.setVisualVariables(null);this._setRendererTitle(c,a)}a=this._getSupportedVariables(a);d=this._createClusterVariables(a.allVars,b);c.setVisualVariables(d);a.sizeVars.length||this._isCBSizeRenderer(c)||this._addSizeByCountVariable(c);return{renderer:c,statisticInfos:b}},_isSupportedRenderer:function(a){if(this._isSimpleRenderer(a))return!0;if(this._isCBRenderer(a)){var c=a.normalizationType;
return"function"===typeof a.attributeField||c&&"field"!==c?!1:!0}return this._isUVRenderer(a)?"function"===typeof a.attributeField||a.attributeField2?!1:!0:!1},_isSimpleRenderer:function(a){return-1<a.declaredClass.toLowerCase().indexOf("simplerenderer")},_isCBRenderer:function(a){return-1<a.declaredClass.toLowerCase().indexOf("classbreaksrenderer")},_isUVRenderer:function(a){return-1<a.declaredClass.toLowerCase().indexOf("uniquevaluerenderer")},_isCBSizeRenderer:function(a){var c=a.infos;if(!this._isCBRenderer(a)||
!c||2>c.length)return!1;var b=Infinity,d=-Infinity;e.forEach(c,function(a){if(a=a.symbol){var c=0;switch(a.type){case "simplemarkersymbol":c=a.size;break;case "picturemarkersymbol":c=(a.width+a.height)/2}b=Math.min(b,c);d=Math.max(d,c)}});return Infinity!==b&&-Infinity!==d&&b!==d},_getRendererAttributeInfo:function(a){var c=a.attributeField,b=c?this.layer.getField(c):null;return{field:c,attributeType:b&&"esriFieldTypeDate"===b.type?"date":null,rotationType:null,valueExpression:a.valueExpression,valueExpressionTitle:a.valueExpressionTitle,
normalizationField:a.normalizationField}},_setRendererTitle:function(a,c){a.legendOptions=l.clone(c.legendOptions);a.legendOptions&&a.legendOptions.title||(a.legendOptions=a.legendOptions||{},a.legendOptions.title=d.getRendererTitle(c,this.layer))},_getSupportedVariables:function(a){var c=a.getVisualVariablesForType("colorInfo",!1)||[],b=a.getVisualVariablesForType("sizeInfo",!1)||[],d=a.getVisualVariablesForType("opacityInfo",!1)||[];a=a.getVisualVariablesForType("rotationInfo",!1)||[];c=e.filter(c,
this._variableFilter);b=e.filter(b,this._variableFilter);d=e.filter(d,this._variableFilter);a=e.filter(a,this._variableFilter);return{sizeVars:b,allVars:c.concat(b).concat(d).concat(a)}},_variableFilter:function(a){return"function"!==typeof a.field},_createClusterVariables:function(a,c){return e.map(a,function(a){return this._createVarForAvg(a,c)},this)},_createVarForAvg:function(a,c){var b=l.clone(a),d=this._getVariableAttributeInfo(a);b.field=n.getClusterField(d,"avg");b.normalizationField=null;
b.valueExpression=null;b.valueExpressionTitle=null;d=this._getStatInfo(d,"avg");this._addStatInfo(c,d);this._setVariableTitle(b,a);return b},_getVariableAttributeInfo:function(a){var c="rotationInfo"===a.type,b=c?"angle":null,c=c?a.rotationType:null,d=a.legendOptions&&a.legendOptions.title,h=a.field,e=h?this.layer.getField(h):null;e&&"esriFieldTypeDate"===e.type&&(b="date");return{field:h,attributeType:b,rotationType:c,valueExpression:a.valueExpression,valueExpressionTitle:a.valueExpressionTitle||
a.valueExpression&&d,normalizationField:a.normalizationField}},_setVariableTitle:function(a,c){a.legendOptions&&a.legendOptions.title||(a.legendOptions=a.legendOptions||{},a.legendOptions.title=d.getVisualVariableTitle(c,this.layer))},_getStatInfo:function(a,c){return{statisticHash:n.getStatisticHash(a,c),attributeInfo:a,statisticType:c}},_addStatInfo:function(a,c){var b=this._findStatInfo(a,c);b?b.attributeInfo.valueExpressionTitle||(b.attributeInfo.valueExpressionTitle=c.attributeInfo.valueExpressionTitle):
a.push(c)},_findStatInfo:function(a,c){var b;e.some(a,function(a){a.statisticHash===c.statisticHash&&(b=a);return!!b});return b},_compareStatInfos:function(a,c){var b=e.filter(a,function(a){return!this._findStatInfo(c,a)},this),d=e.filter(c,function(c){return!this._findStatInfo(a,c)},this);return d.length||b.length?{added:d,removed:b}:null},_addSizeByCountVariable:function(a){var c=this._createSizeByCountVariable();c&&this._addVariable(a,c)},_getSizeByCountVariable:function(a){a=a.getVisualVariablesForType("sizeInfo",
!1)||[];return e.filter(a,function(a){return"cluster_count"===a.field})[0]},_updateSizeByCountVariable:function(){var a=this._renderer,c=this._getSizeByCountVariable(a);if(c){var b=this._createSizeByCountVariable();b&&this._replaceVariable(a,c,b)}},_createSizeByCountVariable:function(){var a=this._clusterGenerator,c;if(a){var b=a.getCurrentLodStats();if(b){c=a.getNumFeatures();var a=a.clusters,d=b.min,h=b.max;1===b.count&&d===c||1===a.length&&a[0].count===c?(d=1,h=c):d&&d===h&&(h=2*d);c={type:"sizeInfo",
field:"cluster_count",valueUnit:"unknown",minSize:12,maxSize:50,minDataValue:d,maxDataValue:h,legendOptions:{title:y}}}}return c},_addVariable:function(a,c){var b=a.visualVariables||[];b.push(c);a.setVisualVariables(b)},_replaceVariable:function(a,c,b){var d=a.visualVariables;c=e.indexOf(d,c);-1<c&&d.splice(c,1);d.push(b);a.setVisualVariables(d)},_getFields:function(c){var b=[new a({name:"cluster_count",type:"esriFieldTypeInteger"})];e.forEach(c,function(c){var d=c.statisticType;c=c.attributeInfo;
var h;"avg"===d?h="date"===c.attributeType?"esriFieldTypeDate":"esriFieldTypeDouble":"type"===d&&(h=c.field?this.layer.getField(c.field).type:"esriFieldTypeString");b.push(new a({name:n.getClusterField(c,d),type:h}))},this);return b},_createInfoTemplate:function(){var a=this._statisticInfos,c=this._renderer,b=[{fieldName:"cluster_count",label:y,visible:!0,format:{digitSeparator:!0,places:0}}],d=[],h=[p.substitute({count:"{cluster_count}"},B.countSummary)],f=this._isUVRenderer(c)?c.infos:[];e.forEach(a,
function(a){var c,e,g=a.statisticType,k=a.attributeInfo,l=n.getClusterField(k,g),m=this._getFieldLabel(a);"avg"===g?(c={fieldName:l,label:m,visible:!0,format:"date"===k.attributeType?{dateFormat:"shortDateShortTime"}:{digitSeparator:!0,places:1}},e=this._getFieldSummary(a,l)):"type"===g&&(e="expression/"+l,c={fieldName:e,visible:!0},d.push({name:l,title:m,returnType:"string",expression:this._getExpression(f,l)}),e=this._getFieldSummary(a,e));c&&b.push(c);e&&h.push(e)},this);return new k({fieldInfos:b,
expressionInfos:d,description:h.join("\x3cbr/\x3e\x3cbr/\x3e")})},_updateInfoTemplate:function(a){var c=a.toJson(),b=this._isUVRenderer(this._renderer)?this._renderer.infos:[];e.forEach(this._statisticInfos,function(a){var d=a.statisticType;a=n.getClusterField(a.attributeInfo,d);"type"===d&&(d=this._findExpressionInfo(a,c))&&(d.expression=this._getExpression(b,a))},this);return new k(c)},_findExpressionInfo:function(a,c){var b;e.some(c.expressionInfos,function(c){c.name===a&&(b=c);return!!b});return b},
_escapeDoubleQuotes:function(a){return a?a.replace(/"/g,'\\"'):""},_getExpression:function(a,c){return["var uvInfos \x3d ["+this._getObjects(a).join(", ")+"];",'var predominantType \x3d Text($feature["'+c+'"]);','var label \x3d "'+this._escapeDoubleQuotes(B.predominantNoneValue)+'";',"for (var i \x3d 0; i \x3c Count(uvInfos); i++) {\nif (uvInfos[i].value \x3d\x3d predominantType) {\nlabel \x3d uvInfos[i].label;\nbreak;\n}\n}\nreturn label;"].join("\n")},_getObjects:function(a){return e.map(a,function(a){return'{"value": "'+
String(a.value)+'","label": "'+this._escapeDoubleQuotes(String(a.label))+'"}'},this)},_getFieldLabel:function(a){var c=a.statisticType,b=a.attributeInfo,d=b.field;a=b.normalizationField;var h="",e;"avg"===c?e=a?B.avgNormFieldLabel:B.avgFieldLabel:"type"===c&&(e=B.predominantFieldLabel);e&&(c=b.valueExpression?b.valueExpressionTitle:this.layer.getFieldLabel(d),a=a&&this.layer.getFieldLabel(a),h=p.substitute({fieldLabel:c||"",normFieldLabel:a||""},e));return h},_getFieldSummary:function(a,c){var b=
a.statisticType,d=a.attributeInfo,h=d.field;a=d.normalizationField;var e="",g;"avg"===b?g=a?B.avgNormFieldSummary:B.avgFieldSummary:"type"===b&&(g=B.predominantFieldSummary);g&&(b=d.valueExpression?d.valueExpressionTitle:this.layer.getFieldLabel(h),a=a&&this.layer.getFieldLabel(a),e=p.substitute({fieldLabel:b||"",normFieldLabel:a||"",fieldValue:"{"+c+"}"},g));return e},_removeFromPopup:function(a){var c=this._map.infoWindow,b=c.features;if(b&&b.length){var d=e.filter(b,function(c){return c.getLayer()!==
a});d.length<b.length&&(d.length?c.setFeatures(d):(c.clearFeatures(),c.hide()))}},_resetClusterNav:function(){this._resetClusterNavPartial();this._popupClusterGraphic=null},_resetClusterNavPartial:function(){this._map.infoWindow.removeActions(this._popupActions);this._hideSingleGraphic(this._popupSingleGraphic);this._popupSingleGraphic=null},_addClusterBoundary:function(a,c){(c=c.clusterFillSymbol)&&(c=new c.constructor(c.toJson()));a=new u(a,c);this._map.graphics.add(a);this._clusterBoundary=a},
_removeClusterBoundary:function(){this._map.graphics.remove(this._clusterBoundary);this._clusterBoundary=null},_createBrowseFeaturesAction:function(){return this._map.infoWindow.addActions([{title:A.NLS_browseFeatures,className:"browseFeatures",callback:l.hitch(this,function(a){a.preventDefault();a=this._map.infoWindow;var c=a.getSelectedFeature(),b=c.getChildGraphics(),d=a.getCurrentAnchor();a.setFeatures(b,{anchor:d});if(b=m.graphicsExtent(b))this._addClusterBoundary(b,a),a.show(this._getPopupLocation(b,
d));this._popupClusterGraphic=c})}])[0]},_getPopupLocation:function(a,c){var b=a.getCenter();c=c.toLowerCase();-1<c.indexOf("top")?b.update(b.x,a.ymax):-1<c.indexOf("bottom")?b.update(b.x,a.ymin):-1<c.indexOf("left")?b.update(a.xmin,b.y):b.update(a.xmax,b.y);return b},_createViewSummaryAction:function(){return this._map.infoWindow.addActions([{title:A.NLS_viewSummary,className:"viewSummary",callback:l.hitch(this,function(a){a.preventDefault();a=this._popupClusterGraphic;var c=this._map.infoWindow;
c.setFeatures([a]);c.show(a.geometry);this._popupClusterGraphic=null})}])[0]},_initClusterUpdates:function(){this._updateSizeVariable();this._updateClusterGraphics();this._eventHandles.push(this._clusterGenerator.on("update-end",l.hitch(this,function(a){(a.mapLevelChange||a.indexChange)&&this._updateSizeVariable();this._updateClusterGraphics()})),this._clusterGenerator.on("index-complete",l.hitch(this,function(){this._updateSizeVariable()})))},_updateClusterGraphics:function(){this._hideSingleGraphics();
var a=[],c=[];e.forEach(this._clusterGenerator.clusters,function(b){var d=new u(b.centroid);d.setAggregationSourceLayer(this.layer);d.setAggregationInfo(b);this._applyClusterAttributes(d,b);1===b.count?(b=this._getSingleGraphic(d),c.push(b)):a.push(d)},this);this._showSingleGraphics(c);this._addGraphics(a)},_addGraphics:function(a){var c=this.container;c.clear();e.forEach(a,function(a){c.add(a)})},_getSingleGraphic:function(a){var c=this._clusterGenerator.getCell(a.getAggregationInfo().primary).features[0],
b=this.layer.renderer,b=b&&b.getSymbol(c),d=this._getSizeByCountVariable(this._renderer);b&&d&&(a=d?this._renderer.getSize(a,{sizeInfo:d,shape:b.style,resolution:this._map.getResolutionInMeters(),scale:this._map.getScale()}):null,c.setSize(a));return c},_showSingleGraphics:function(a){e.forEach(a,this._showSingleGraphic);this._singleGraphics=a},_hideSingleGraphics:function(){e.forEach(this._singleGraphics,function(a){a.setSize(null);this._hideSingleGraphic(a)},this);this._singleGraphics=null},_clearSingleGraphics:function(){e.forEach(this._singleGraphics,
function(a){a.setSize(null)});this._singleGraphics=null},_showSingleGraphic:function(a){a&&a._resume()},_hideSingleGraphic:function(a){a&&a._suspend()},_updateSizeVariable:function(){this.isClusteringEnabled()&&(this._updateSizeByCountVariable(),this.emit("renderer-change"))},_applyClusterAttributes:function(a,c){a.setAttributes(c.attributes)},_createLayerEventListeners:function(){var a=this.layer;this._eventHandles.push(a.on("visibility-change",l.hitch(this,function(a){this.container.setVisibility(a.visible)})),
a.on("scale-range-change",l.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)})),a.on("renderer-change",l.hitch(this,function(){this._applyRenderer()})),a.on("info-template-change",l.hitch(this,function(){this._applyInfoTemplate()})))},_createMapEventListeners:function(){this._eventHandles.push(this._map.on("zoom-start",l.hitch(this,function(){this._removeClusterBoundary();this._removeFromPopup(this.container);this._removeFromPopup(this.layer);this._resetClusterNav();
this.container.clear();this._hideSingleGraphics()})))},_createPopupEventListeners:function(){var a=this._map.infoWindow;this._eventHandles.push(a.on("selection-change",l.hitch(this,function(){this._resetClusterNavPartial();var a=this._map.infoWindow.getSelectedFeature(),c=a&&a.getLayer();if(c){var b;c===this.container?(this._removeClusterBoundary(),b=this._createBrowseFeaturesAction()):c===this.layer&&a._isSuspended()?(b=this._createViewSummaryAction(),this._popupSingleGraphic=a,this._showSingleGraphic(this._popupSingleGraphic)):
this._removeClusterBoundary();this._popupActions=b?[b]:null}})),a.on("clear-features",l.hitch(this,function(a){this._resetClusterNav();a.isIntermediate||this._removeClusterBoundary()})),a.on("hide",l.hitch(this,function(){this._popupSingleGraphic&&this._popupSingleGraphic._suspend();this._clusterBoundary&&this._clusterBoundary.hide()})),a.on("show",l.hitch(this,function(){this._popupSingleGraphic&&this._popupSingleGraphic._resume();this._clusterBoundary&&this._clusterBoundary.show()})))},_destroyEventListeners:function(){e.forEach(this._eventHandles,
function(a){a.remove()})}});r("extend-esri")&&l.setObject("layers.clustering.ClusterManager",t,q);return t})},"esri/dijit/Legend/utils":function(){define(["dojo/_base/lang","../../lang","dojo/i18n!../../nls/jsapi"],function(t,l,e){var r=e.widgets.legend;return{getVisualVariableTitle:function(e,b){var q,p=e.field,v=e.normalizationField,m=!1,k=!1,d=!1,p=t.isFunction(p)?null:p,v=t.isFunction(v)?null:v;if(e.legendOptions&&e.legendOptions.title)q=e.legendOptions.title;else if(e.valueExpressionTitle)q=
e.valueExpressionTitle;else{if(b.renderer&&b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables){var f=b.renderer.authoringInfo.visualVariables;for(e=0;e<f.length;e++){var z=f[e];if("colorInfo"===z.type&&"ratio"===z.style){m=!0;break}else if("colorInfo"===z.type&&"percent"===z.style){k=!0;break}else if("colorInfo"===z.type&&"percentTotal"===z.style){d=!0;break}}}(m=d&&"showRatioPercentTotal"||k&&"showRatioPercent"||m&&"showRatio"||v&&"showNormField"||p&&"showField"||null)&&(q=l.substitute({field:p&&
b.getFieldLabel(p),normField:v&&b.getFieldLabel(v)},"showField"===m?"${field}":r[m]))}return q},getRendererTitle:function(e,b){var q;if(e){var p,v,m;"esri.renderer.ClassBreaksRenderer"===e.declaredClass&&(p=e.attributeField,v=e.normalizationField,m="percent-of-total"===e.normalizationType);p=t.isFunction(p)?null:p;v=t.isFunction(v)?null:v;e.legendOptions&&e.legendOptions.title?q=e.legendOptions.title:e.valueExpressionTitle?q=e.valueExpressionTitle:(e=v&&"showNormField"||(m?"showNormPct":null)||p&&
"showField"||null)&&(q=l.substitute({field:p&&b.getFieldLabel(p),normField:v&&b.getFieldLabel(v)},"showField"===e?"${field}":r[e]))}return q}}})},"esri/layers/clustering/GeohashAggregation":function(){define("dojo/has dojo/_base/declare dojo/_base/lang dojo/_base/array ../../kernel ../../Evented ../../geometry/Point ../../geometry/Extent ../../geometry/mathUtils ../../support/expressionUtils ../../core/timerUtils ../support/attributeUtils ./geohashUtils ./statUtils".split(" "),function(t,l,e,r,q,
b,u,p,v,m,k,d,f,z){l=l(b,{loaded:!1,started:!1,map:null,layer:null,lod:null,tolerance:null,clusterMode:null,clusterRadius:null,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0,clusters:null,clustersEnabled:!0,statisticInfos:null,defaults:{lod:1,tolerance:0,clusterMode:"auto",clusterRadius:80,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0},_eventHandles:null,_updateHandle:null,_indexHandle:null,_cellIndex:null,_globalIndex:null,_perfProfile:null,_indexUpdated:!1,
_cellSizeScaleFactor:1.5,_extentScaleFactor:1.25,_maxGeohashLength:12,_minClusterRadius:15,_levelChange:!0,_clusterFieldPrefix:"cluster_",_mapLevelChange:!1,constructor:function(b){this._update=e.hitch(this,this._update);this._indexFeatures=e.hitch(this,this._indexFeatures);this._eventHandles=[];this._globalIndex={numFeatures:null,fullExtent:null,lodStats:null};this._perfProfile={lastIndex:{total:null,numFeatures:0},lastUpdate:{cells:null,clusters:null,total:null}};this.clusters=[];this.map=b.map;
this.layer=b.layer;this.setLod(b.lod);this.setTolerance(b.tolerance);this.setClusterMode(b.clusterMode);this.setClusterRadius(b.clusterRadius);this.setSortEnabled(b.sortEnabled);this.setFilterEnabled(b.filterEnabled);this.setBufferEnabled(b.bufferEnabled);this.setUpdateEnabled(b.updateEnabled);this.setStatisticInfos(b.statisticInfos);this._load();this.loaded?this._startup():this._eventHandles.push(this.on("load",e.hitch(this,this._startup)))},destroy:function(b){this._displayFeatures(!0,b);r.forEach(this._eventHandles,
function(a){a.remove()});k.clearTimeout(this._updateHandle);k.clearTimeout(this._indexHandle);this._cellIndex=this._globalIndex=this._eventHandles=this._updateHandle=this._indexHandle=this.map=this.layer=this.clusters=null},setLod:function(b){var a=this.lod;this.lod=b||this.defaults.lod;a!==this.lod&&this.update()},setTolerance:function(b){var a=this.tolerance;this.tolerance=b||this.defaults.tolerance;a!==this.tolerance&&this.update()},setClusterMode:function(b){var a=this.clusterMode;this.clusterMode=
b||this.defaults.clusterMode;this._evalClusterParams();a!==this.clusterMode&&this.update()},setClusterRadius:function(b){var a=this.clusterRadius;this.clusterRadius=null!=b?b:this.defaults.clusterRadius;this._evalClusterParams();a!==this.clusterRadius&&this.update()},setSortEnabled:function(b){var a=this.sortEnabled;this.sortEnabled=null!=b?!!b:this.defaults.sortEnabled;a!==this.sortEnabled&&this.update()},setFilterEnabled:function(b){var a=this.filterEnabled;this.filterEnabled=null!=b?!!b:this.defaults.filterEnabled;
a!==this.filterEnabled&&this.update()},setBufferEnabled:function(b){var a=this.bufferEnabled;this.bufferEnabled=null!=b?!!b:this.defaults.bufferEnabled;a!==this.bufferEnabled&&this.update()},setUpdateEnabled:function(b){var a=this.updateEnabled;(this.updateEnabled=null!=b?!!b:this.defaults.updateEnabled)&&a!==this.updateEnabled&&(this._mapLevelChange=!0,this.update())},setStatisticInfos:function(b){this.statisticInfos=b||[];this.loaded&&this._applyStatInfos(this.statisticInfos)},update:function(){this.loaded&&
null==this._updateHandle&&(this._updateHandle=k.setTimeout(this._update,k.priority.HIGH))},isUpdateScheduled:function(){return null!=this._updateHandle},index:function(){this.loaded&&null==this._indexHandle&&(this._indexHandle=k.setTimeout(this._indexFeatures,k.priority.HIGH))},getCell:function(b){return this._cellIndex[b.length][b]},getCluster:function(b){var a;r.some(this.clusters,function(c){-1<r.indexOf(c.geohashes,b)&&(a=c);return!!a});return a},getCellsInCluster:function(b){var a=[];r.forEach(b&&
b.geohashes,function(c){(c=this.getCell(c))&&a.push(c)},this);return a},getFeaturesInCluster:function(b){var a=[];b=this.getCellsInCluster(b);r.forEach(b,function(c){Array.prototype.push.apply(a,c.features)});return a},toggleFeatureVisibility:function(b){this.index()},getCurrentLodStats:function(){var b=this._globalIndex.lodStats;return b&&b[this.lod]},getNumFeatures:function(){return this._globalIndex.numFeatures},getFullExtent:function(){var b=this._globalIndex.fullExtent;return b&&Infinity!==b.xmin?
new p(b):null},_load:function(){this._displayFeatures(!1);this._checkLoadStatus();this.map.loaded||this._eventHandles.push(this.map.on("load",e.hitch(this,this._checkLoadStatus)));this.layer.loaded||this._eventHandles.push(this.layer.on("load",e.hitch(this,this._checkLoadStatus)))},_checkLoadStatus:function(){if(this.map.loaded&&this.layer.loaded){var b;if("esriGeometryPoint"!==this.layer.geometryType)b=Error("GeohashAggregation is supported only for points");else{var a=this.map.spatialReference;
a.isWebMercator()||4326===a.wkid||(b=Error("GeohashAggregation is supported only when map spatial reference is WGS84 or WebMercator"))}b?(this.loadError=b,this.emit("load-error",{error:b})):(this.loaded=!0,this.emit("load"))}},_startup:function(){this._evalUpdateStatus();this.index();this._processExtentChange();this._eventHandles.push(this.layer.on("update-end",e.hitch(this,this.index)),this.layer.on("edits-complete",e.hitch(this,this.index)),this.layer.on("graphics-clear",e.hitch(this,this.index)),
this.layer.on("suspend",e.hitch(this,this._evalUpdateStatus)),this.layer.on("resume",e.hitch(this,this._evalUpdateStatus)),this.map.on("extent-change",e.hitch(this,this._processExtentChange)))},_evalUpdateStatus:function(){this.setUpdateEnabled(!this.layer.suspended)},_processExtentChange:function(b){this._mapLevelChange=!(!b||!b.levelChange);this._evalClusterParams();this.update()},_update:function(){this._updateHandle=null;if(this.updateEnabled){this.emit("update-start");if(this.clustersEnabled){var b=
this.map.geographicExtent;if(b){var a=this._getIntersectingCells(b),b=this._getClusters(a.cells,b);this.clusters=b.clusters;this._applyStatInfosToClusters();var a=a.profile,b=b.profile,c=a.total+b.total;a.total=this._getElapsedTime(a.total);b.total=this._getElapsedTime(b.total);var d=this._perfProfile.lastUpdate={};d.cells=a;d.clusters=b;d.total=this._getElapsedTime(c)}}else this.clusters=[],this._perfProfile.lastUpdate=null;a=this._indexUpdated;this._indexUpdated=!1;b=this._mapLevelChange;this._mapLevelChange=
!1;this.emit("update-end",{levelChange:this._levelChange,mapLevelChange:b,indexChange:a})}},_displayFeatures:function(b,a){var c=this.layer;b=!b;c.suspendGraphics(b);!1!==a&&(b?c.clearNodes():c.redraw())},_indexFeatures:function(){this._indexHandle=null;var b=this._getTime();this._initializeIndexing();var a=0,c=this._globalIndex.fullExtent;r.forEach(this.layer.graphics,function(b){if(b.visible){var d=b.geometry,e=this._getLngLat(d),h;e&&(h=d.getCacheValue("_geohash"),void 0===h&&(h=f.pointToGeohash(e),
d.setCacheValue("_geohash",h||null)));h&&(this._addGeohashToIndex(h,b,e),a++,this._updateExtent(c,e))}},this);this._applyStatInfosToIndex();this._globalIndex.numFeatures=a;for(var d=this._globalIndex.lodStats,e=1;e<=this._maxGeohashLength;e++)d[e]=this._getLODStats(e,a);this._perfProfile.lastIndex.total=this._getElapsedTime(b,this._getTime());this._perfProfile.lastIndex.numFeatures=a;this._indexUpdated=!0;this.emit("index-complete");this.started||(this.started=!0,this.emit("start"));this.update()},
_initializeIndexing:function(){this._globalIndex={numFeatures:0,fullExtent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},lodStats:{}};for(var b=this._cellIndex=[],a=1;a<=this._maxGeohashLength;a++)b[a]={}},_getLngLat:function(b){if(b){var a=b.getLongitude();b=b.getLatitude();b=null!=a&&null!=b?{x:a,y:b}:null}return b},_addGeohashToIndex:function(b,a,c){for(var d=this._cellIndex,e="",h=0;h<this._maxGeohashLength;h++){var e=e+b[h],f=d[e.length],k=f[e];k||(k=f[e]={count:0,centroid:{x:null,
y:null},extent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},features:[],geohash:e,statistics:null});this._updateItem(k,1,c,!0);k.features.push(a)}},_getLODStats:function(b,a){var c=this._cellIndex[b],d=0,e=Infinity,h=-Infinity,f=null,k;for(k in c){var l=c[k];d++;l.count<e&&(e=l.count);l.count>h&&(h=l.count)}0<d&&(f=Number((a/d).toFixed(2)));return{lod:b,count:d,min:Infinity===e?null:e,max:-Infinity===h?null:h,avg:f}},_evalClusterParams:function(){if(this.loaded&&"auto"===this.clusterMode){var b=
this._getClusterParams(this.map.getResolutionInMeters(),this.clusterRadius,this._minClusterRadius);this._levelChange=this.lod!==b.lod;this.lod=b.lod;this.tolerance=b.tolerance}},_getClusterParams:function(b,a,c){a<c&&(a=c);b=Math.ceil(b*a);a=this._getClosestLODRange(b).max;do c=this._getCellSize(a),(c=b>=this._cellSizeScaleFactor*c||1===c)||(a+=1);while(!c);c=b/this._getCellSize(a);return{lod:a,tolerance:b,multiplier:Number(c.toFixed(2))}},_getClosestLODRange:function(b){for(var a,c=this._maxGeohashLength;1<=
c;c--)if(this._getCellSize(c)>=b){a=c;break}null==a&&(a=1);b=a+1;b>this._maxGeohashLength&&(b=this._maxGeohashLength);return{min:a,max:b}},_getCellSize:function(b){b=f.getCellSizeInMeters(b);return Math.ceil(Math.min(b.width,b.height))},_sorter:function(b,a){var c=b.centroid,d=a.centroid;return b.count>a.count?-1:b.count<a.count?1:c.x>d.x?-1:c.x<d.x?1:0},_getIntersectingCells:function(b){var a=this._getTime();b=b.expand(this._extentScaleFactor);var c=f.getIntersecting(b,this.lod,this.bufferEnabled?
this.tolerance:0);b=this._getTime();var d=[],e=this.tolerance,h=this.sortEnabled;r.forEach(c,function(a){(a=this.getCell(a))&&d.push(a)},this);e&&h&&d.sort(this._sorter);c=this._getTime();return{cells:d,profile:{findCells:this._getElapsedTime(a,b),scanAndSortCells:this._getElapsedTime(b,c),total:c-a}}},_getClusters:function(b,a){var c=this._getTime(),d=[],e={},h={findCells:0};r.forEach(b,function(a,b){(a=this._createCluster(a,e,h))&&d.push(a)},this);this._markIntersecting(d,a);this.filterEnabled&&
(d=this._getIntersectingClusters(d));b=this._getTime();return{clusters:d,profile:{findCellsInCluster:this._getElapsedTime(h.findCells),total:b-c}}},_markIntersecting:function(b,a){var c=a.normalize();r.forEach(b,function(a){var b=a.centroid.x,d=a.centroid.y;a.isIntersecting=r.some(c,function(a){return b>=a.xmin&&b<=a.xmax&&d>=a.ymin&&d<=a.ymax})})},_getIntersectingClusters:function(b){return r.filter(b,function(a){return a.isIntersecting})},_createCluster:function(b,a,c){if(!a[b.geohash]){var d=[{cell:b,
distance:0}];if(this.tolerance){var e=this._getTime(),h=f.getNeighborsWithinDistance(b.centroid,this.lod,this.tolerance);c.findCells+=this._getTime()-e;r.forEach(h,function(a){if(a!==b.geohash&&(a=this.getCell(a))){var c=this._calculateDistance(b.centroid,a.centroid);c<=this.tolerance&&d.push({cell:a,distance:c})}},this)}return this._mergeCells(d,a)}},_calculateDistance:function(b,a){return v.getLength(f.geographicToWebMercator(b),f.geographicToWebMercator(a))},_mergeCells:function(b,a){var c=this._initializeCluster({},
b[0].cell.geohash);r.forEach(b,function(b){var d=b.cell,e=d.geohash;b=b.distance;var h=a[e];if(h)if(b<h.distance)this._removeCellFromCluster(e,a);else return;a[e]={cluster:c,distance:b};this._updateItem(c,d.count,d.centroid);c.geohashes.push(e)},this);return c},_removeCellFromCluster:function(b,a){var c=a[b].cluster;delete a[b];b=r.indexOf(c.geohashes,b);-1<b&&c.geohashes.splice(b,1);this._reevaluateCluster(c)},_reevaluateCluster:function(b){var a=b.geohashes;b=this._initializeCluster(b,b.primary);
r.forEach(a,function(a){var c=this.getCell(a);c&&(this._updateItem(b,c.count,c.centroid),b.geohashes.push(a))},this)},_initializeCluster:function(b,a){b.count=0;b.centroid=new u(null,null);b.geohashes=[];b.primary=a;b.statistics=null;return b},_applyStatInfos:function(b){b=this._getValidStatInfos(b);this._applyStatInfosToIndex(b);this._applyStatInfosToClusters(b)},_getValidStatInfos:function(b){var a=[];r.forEach(b,function(b){var c=b.attributeInfo;b=b.statisticType;var e="angle"===c.attributeType;
if(z.isSupportedStatisticType(b)&&(!e||"avg"===b)){var h="arithmetic"===c.rotationType;a.push({attributeCache:d.createAttributeCache(c,"type"===b),identifier:z.getStatisticId(c,b),statFunctions:z.getStatisticFunctions(b),isAngular:e,isDate:"date"===c.attributeType,isArithmetic:h})}});return a},_applyStatInfosToIndex:function(b){b=b||this._getValidStatInfos(this.statisticInfos);var a=this._cellIndex;if(a)for(var c=1;c<=this._maxGeohashLength;c++){var d=a[c],e;for(e in d)this._applyStatInfosToCell(d[e],
b)}},_applyStatInfosToCell:function(b,a){var c=this._initializeStats(b,a);r.forEach(b.features,function(b){this._calcFeatureStats(b,a,c)},this);this._summarizeStats(b,c,a)},_calcFeatureStats:function(b,a,c){b.attributes&&r.forEach(a,function(a){var d=c[a.identifier],e=a.attributeCache,e=e?b._getDataValue(e.attributeInfo,e,m):null;a.statFunctions.updateCellStat(d,e,a)})},_applyStatInfosToClusters:function(b){b=b||this._getValidStatInfos(this.statisticInfos);var a=this._clusterFieldPrefix;r.forEach(this.clusters,
function(c){var d=this._initializeStats(c,b);r.forEach(this.getCellsInCluster(c),function(a){this._calcCellStats(a,b,d)},this);this._summarizeStats(c,d,b,a);c.attributes[a+"id"]=c.primary},this)},_calcCellStats:function(b,a,c){var d=b.statistics;r.forEach(a,function(a){var b=a.identifier;a.statFunctions.updateClusterStat(c[b],d[b],a)})},_initializeStats:function(b,a){var c=b.statistics={};r.forEach(a,function(a){c[a.identifier]=a.statFunctions.initialize(a)});return c},_summarizeStats:function(b,
a,c,d){var e=b.attributes={};d=d||"";e[d+"count"]=b.count;r.forEach(c,function(b){var c=this._getStatFieldName(b,d);e[c]=b.statFunctions.summarize(a[b.identifier],b)},this)},_getStatFieldName:function(b,a){return(a||"")+b.identifier},_updateItem:function(b,a,c,d){var e=c.y,f=b.centroid,h=b.count;f.x=(h*f.x+a*c.x)/(h+a);f.y=(h*f.y+a*e)/(h+a);b.count+=a;d&&this._updateExtent(b.extent,c)},_updateExtent:function(b,a){var c=a.x;a=a.y;c<b.xmin&&(b.xmin=c);c>b.xmax&&(b.xmax=c);a<b.ymin&&(b.ymin=a);a>b.ymax&&
(b.ymax=a)},_getTime:function(){return window.performance?window.performance.now():(new Date).getTime()},_getElapsedTime:function(b,a){var c;b=null!=b&&null!=a?a-b:b;null!=b&&(c="millisecond",1E3<=b&&(b/=1E3,c="second",60<=b&&(b/=60,c="minute")),c={value:Number(b.toFixed(2)),unit:c});return c}});t("extend-esri")&&e.setObject("layers.clustering.GeohashAggregation",l,q);return l})},"esri/core/timerUtils":function(){define([],function(){function t(b){var e,l=b.length;for(e=0;e<l;e++)b[e]()}var l={LOW:1,
HIGH:2},e,r={};r[l.LOW]=[];r[l.HIGH]=[];var q=function(){clearTimeout(e);e=null;var b=r[l.HIGH];r[l.HIGH]=[];t(b);b=r[l.LOW];r[l.LOW]=[];t(b)};return{priority:l,callbackQueue:r,setTimeout:function(b,l){b=[l,r[l].push(b)-1];e||(e=setTimeout(q,0));return b},clearTimeout:function(b){b&&r[b[0]].splice(b[1],1)}}})},"esri/layers/clustering/geohashUtils":function(){define("dojo/has dojo/string dojo/_base/lang dojo/_base/array ../../kernel ../../geometry/Point ../../geometry/Extent ../../SpatialReference ../../geometry/webMercatorUtils".split(" "),
function(t,l,e,r,q,b,u,p,v){function m(a){var b=a.spatialReference;if(!b)return{x:a.x,y:a.y};var c=b.isWebMercator(),d;4326===b.wkid?d={x:a.x,y:a.y}:c&&(d={x:a.getLongitude(),y:a.getLatitude()});return d}function k(a){var b=a.spatialReference,c=!(!b||!b.isWebMercator()),d;b&&4326===b.wkid?d=new u(a.toJson()):c&&(d=v.webMercatorToGeographic(a,!0));return d}function d(a,c){c.x=b.prototype._normalizeX(a.x,p.prototype._info[4326]);c.y=a.y;return c}function f(a){a=H.decimals[a].toString(2);return l.pad(a,
H.bitsPerBase32Char,"0")}function z(a,b){var c;b=b.slice();b.splice(1,0,0);for(var d=b[0],e=b[2],f=0;f<a.length;f++)Number(a[f])?b[0]=b[1]:b[2]=b[1],c=b[1]=(b[0]+b[2])/2,d=b[0],e=b[2];return{value:c,min:d,max:e}}function h(a,b,c){var d=[];b=b.slice();b.splice(1,0,0);for(var e=b[0],f=b[2],g=0;g<c;g++)a>=b[1]?(b[0]=b[1],e=1):(b[2]=b[1],e=0),b[1]=(b[0]+b[2])/2,d.push(e),e=b[0],f=b[2];return{value:d.join(""),min:e,max:f}}function a(a){var b=a*H.bitsPerBase32Char;0===b%2?a=b/=2:(a=(b+1)/2,b-=a);return{lon:a,
lat:b}}function c(a){var b=0;a=a.split("").reverse().join("");for(var c=0;c<a.length;c++)b+=Number(a[c])*Math.pow(2,c);return H.base32[b]}function n(a,b){var c={x:a.xmin,y:a.ymax},d={x:a.xmax,y:a.ymin},e={x:a.xmax,y:a.ymax};return{sw:K.pointToGeohash({x:a.xmin,y:a.ymin},b),nw:K.pointToGeohash(c,b),se:K.pointToGeohash(d,b),ne:K.pointToGeohash(e,b)}}function E(a,b,c,d,e){var f=a;do e[f]||(e[f]=!0,d.push(f)),(a=f===b)||(f=J(f,c));while(!a)}function B(a,b,c,d){var e=n(a,b);a=[];E(e.sw,e.nw,"n",a,{});
b=[];E(e.se,e.ne,"n",b,{});for(e=0;e<a.length;e++)E(a[e],b[e],"e",c,d)}function A(a){return r.filter(a,function(a){return 180===a.xmax?!0:!1})[0]}function y(a){return r.filter(a,function(a){return-180===a.xmin?!0:!1})[0]}function w(a,b,c,d){var e=K.geographicToWebMercator(a);a={x:e.x-b,y:e.y-b};b=K.webMercatorToGeographic({x:e.x+b,y:e.y+b},!0);a=K.webMercatorToGeographic(a,!0);return new u(null!=c?c:a.x,a.y,null!=d?d:b.x,b.y)}function g(a,b,c,d){var e;a=n(a,b);var f,g;"min"===d?g=180:"max"===d&&(f=
-180);var h=f;d=g;e=K.geohashToCell(a.sw).extent;b=K.geohashToCell(a.ne).extent;a=null!=h?h:e.xmin;e=e.ymin;d=null!=d?d:b.xmax;b=b.ymax;a=w({x:a,y:e},c,f,g);c=w({x:d,y:b},c,f,g);return new u(a.xmin,a.ymin,c.xmax,c.ymax)}function C(a,b,c){var d=a,e=0;do e++,(a=d===b)||(d=J(d,c));while(!a);return e}function x(a,b){a=n(a,b);b=C(a.nw,a.ne,"e");return{rows:C(a.nw,a.sw,"s"),cols:b}}function J(a,b){var c=a.length%2,d=a.slice(-1),e=H.decimals[d];a=a.slice(0,-1);-1!=H.borders[b][c].indexOf(d)&&a&&(a=J(a,b));
return a+H.neighbors[b][c][e]}var H={base32:"0123456789bcdefghjkmnpqrstuvwxyz",decimals:function(){for(var a={},b=0;32>b;b++)a["0123456789bcdefghjkmnpqrstuvwxyz"[b]]=b;return a}(),neighbors:{n:[null,"238967debc01fg45kmstqrwxuvhjyznp"],s:[null,"bc01fg45238967deuvhjyznpkmstqrwx"],e:[null,"14365h7k9dcfesgujnmqp0r2twvyx8zb"],w:[null,"p0r21436x8zb9dcf5h7kjnmqesgutwvy"]},borders:{n:[null,"bcfguvyz"],s:[null,"0145hjnp"],e:[null,"prxz"],w:[null,"028b"]},bitsPerBase32Char:5,maxGeohashLength:12,longitudeRange:[-180,
180],latitudeRange:[-90,90]};H.neighbors.n[0]="14365h7k9dcfesgujnmqp0r2twvyx8zb";H.neighbors.s[0]="p0r21436x8zb9dcf5h7kjnmqesgutwvy";H.neighbors.e[0]="238967debc01fg45kmstqrwxuvhjyznp";H.neighbors.w[0]="bc01fg45238967deuvhjyznpkmstqrwx";H.borders.n[0]="prxz";H.borders.s[0]="028b";H.borders.e[0]="bcfguvyz";H.borders.w[0]="0145hjnp";var K={geographicToWebMercator:function(a){a=b.lngLatToXY(a.x,a.y);return{x:a[0],y:a[1]}},webMercatorToGeographic:function(a,c){a=b.xyToLngLat(a.x,a.y,c);return{x:a[0],
y:a[1]}},geohashToCell:function(a){for(var b=[],c=0;c<a.length;c++)b.push(f(a[c]));for(var b=b.join(""),c=[],d=[],e=0;e<b.length;e++)0===e%2?c.push(b[e]):d.push(b[e]);c=c.join("");d=d.join("");c=[c,d];b=z(c[0],H.longitudeRange);c=z(c[1],H.latitudeRange);return{point:{x:b.value,y:c.value},extent:{xmin:b.min,xmax:b.max,ymin:c.min,ymax:c.max},geohash:a}},pointToCell:function(b,e){var f,g;e=e||H.maxGeohashLength;if(b=m(b)){b=d(b,b);f=a(e);e=h(b.x,H.longitudeRange,f.lon);var k=h(b.y,H.latitudeRange,f.lat);
f=e.value;g=k.value;e={xmin:e.min,xmax:e.max,ymin:k.min,ymax:k.max};for(var k=[],l=Math.ceil((f.length+g.length)/H.bitsPerBase32Char),p=0,n=0,q=0;q<l*H.bitsPerBase32Char;q++){var r=0===q%2?f[p++]:g[n++];null==r&&(r=0);k.push(r)}f=k.join("");g=H.bitsPerBase32Char;k=f.length/g;l=[];for(p=0;p<k;p++)n=f.substr(p*g,g),l.push(c(n));f=l.join("");return{point:b,extent:e,geohash:f}}},geohashToPoint:function(a){return K.geohashToCell(a).point},pointToGeohash:function(a,b){return(a=K.pointToCell(a,b))&&a.geohash},
getCells:function(a){return r.map(a,function(a){return K.geohashToCell(a)})},getCellSize:function(b){var c=H.longitudeRange,d=H.latitudeRange,c=Math.abs(c[1]-c[0]),d=Math.abs(d[1]-d[0]);b=a(b||1);return{width:c/Math.pow(2,b.lon),height:d/Math.pow(2,b.lat)}},getCellSizeInMeters:function(a){a=K.getCellSize(a);var b=v.metersPerDegree;a.width*=b;a.height*=b;return a},getIntersecting:function(a,b,c){b=b||1;c=c||0;var d=[],e=k(a);if(e){c&&(e=K.expandExtent(a,b,c));a=e.normalize();var f={};r.forEach(a,function(a){B(a,
b,d,f)})}return d},countIntersecting:function(a,b,c){b=b||1;c=c||0;var e=0,f=k(a);if(f){c&&(f=K.expandExtent(a,b,c));a=f.normalize();if(2===a.length){e=A(a);f=y(a);c=x(e,b);var g=x(f,b);a=c.rows;c=c.cols+g.cols;e={x:e.xmin,y:e.ymax};f={x:f.xmax,y:f.ymax};e=d(e,{});f=d(f,{});e=K.pointToGeohash(e,b);b=K.pointToGeohash(f,b);e===b&&c--;b={rows:a,cols:c}}else b=x(a[0],b);e=b.cols*b.rows}return e},getChildren:function(a){a=a||"";var b=[],c;for(c in H.decimals)b.push(a+c);return b},getNeighbors:function(a){var b=
J(a,"n"),c=J(a,"s");return[b,J(b,"e"),J(b,"w"),c,J(c,"e"),J(c,"w"),J(a,"e"),J(a,"w")]},getExtentFromDistance:function(a,b){b=b||1E3;var c;(a=m(a))&&(c=w(a,b));return c},expandExtent:function(a,b,c){b=b||1;c=c||0;if(a=k(a)){if(c){a=a.normalize();if(2===a.length){var d=c;c=A(a);a=y(a);c=g(c,b,d,"min");a=g(a,b,d,"max");360<=c.getWidth()+a.getWidth()?(b=-180,a=180):(b=c.xmin,a=a.xmax);return new u(b,c.ymin,a,c.ymax)}return g(a[0],b,c)}return a}},getNeighborsWithinDistance:function(a,b,c){c=c||1E3;b=b||
1;var d=[];if(a=m(a)){c=w(a,c).normalize();var e={};r.forEach(c,function(a){B(a,b,d,e)})}return d}};t("extend-esri")&&e.setObject("layers.clustering.geohashUtils",K,q);return K})},"esri/layers/clustering/statUtils":function(){define(["dojo/_base/lang","../support/attributeUtils"],function(t,l){function e(b){return"number"===typeof b&&!isNaN(b)&&Infinity!==b&&-Infinity!==b}var r={sum:{initialize:function(){return{count:0,sum:null}},updateCellStat:function(b,l){e(l)&&(b.count++,b.sum+=l)},updateClusterStat:function(b,
e){e.count&&(b.count+=e.count,b.sum+=e.sum)},summarize:function(b){return b.sum}},avg:{initialize:function(b){return{count:0,sum:null,avg:null,sum_cosine:null,sum_sine:null}},updateCellStat:function(b,l,p){e(l)&&(b.count++,p.isAngular?(p.isArithmetic||(l=-1*l+90),b.sum_cosine+=Math.cos(l*Math.PI/180),b.sum_sine+=Math.sin(l*Math.PI/180)):b.sum+=l)},updateClusterStat:function(b,e,l){e.count&&(b.count+=e.count,l.isAngular?(b.sum_cosine+=e.sum_cosine,b.sum_sine+=e.sum_sine):b.sum+=e.sum)},summarize:function(b,
e){if(0<b.count){var l=b.count;e.isAngular?(l=180*Math.atan2(b.sum_sine/l,b.sum_cosine/l)/Math.PI,e.isArithmetic||(l=-1*(l-90)),b.avg=0>l?l+360:l):(b.avg=b.sum/l,e.isDate&&(b.avg=Math.ceil(b.avg)))}return b.avg}},type:{initialize:function(){return{uvInfos:{}}},updateCellStat:function(b,e){if(null==e||""===e||"string"===typeof e&&""===t.trim(e))e=null;b=b.uvInfos;null==b[e]?b[e]={count:1,value:e}:b[e].count++},updateClusterStat:function(b,e){b=b.uvInfos;e=e.uvInfos;for(var l in e){var q=e[l];null==
b[l]?b[l]={count:q.count,value:q.value}:b[l].count+=q.count}},summarize:function(b){b=b.uvInfos;var e,l=-Infinity,q;for(e in b){var m=b[e];m.count>l?(l=m.count,q=m.value):m.count===l&&(q=null)}return q}}},q={isSupportedStatisticType:function(b){return r.hasOwnProperty(b)},getStatisticFunctions:function(b){return r[b]},getStatisticId:function(b,e){var p=l.getAttributeIdSource(b);b=p&&l.getAttributeId(p)||b.field;return e+"_"+b},getClusterField:function(b,e){return"cluster_"+q.getStatisticId(b,e)},
getStatisticHash:function(b,e){e=[q.getStatisticId(b,e)];b.attributeType&&e.push(b.attributeType.toLowerCase());b.rotationType&&e.push(b.rotationType.toLowerCase());return e.join("_")}};return q})},"*noref":1}});
define("esri/arcgis/utils","require dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/on dojo/DeferredList dojo/dom-construct dojo/sniff dojox/gfx/_base ../kernel ../config ../Color ../lang ../request ../SpatialReference ../map ../urlUtils ../geometry/ScreenPoint ../geometry/Extent ../geometry/webMercatorUtils ../symbols/jsonUtils ../renderers/jsonUtils ../dijit/PopupTemplate ../dijit/Popup ../tasks/query ../tasks/GeometryService ../layers/ArcGISTiledMapServiceLayer ../layers/FeatureLayer dojo/i18n!../nls/jsapi".split(" "),function(t,
l,e,r,q,b,u,p,v,m,k,d,f,z,h,a,c,n,E,B,A,y,w,g,C,x,J,H,K,aa,I,fa){function U(a){return c({url:M.arcgisUrl+"/"+a.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function X(a,b){var d={f:"json"};b&&(d.token=b);return c({url:a,content:d,callbackParamName:"callback"},{disableIdentityLookup:!0})}function ga(b){!b.layerDefinition||b.layerDefinition.drawingInfo&&b.layerDefinition.drawingInfo.labelingInfo||(b.showLabels=!1);b.itemProperties.layerDefinition&&
(b.layerDefinition?(b.layerDefinition.drawingInfo||(b.layerDefinition.drawingInfo=b.itemProperties.layerDefinition.drawingInfo),a.isDefined(b.layerDefinition.definitionExpression)||(b.layerDefinition.definitionExpression=b.itemProperties.layerDefinition.definitionExpression),a.isDefined(b.layerDefinition.minScale)||(b.layerDefinition.minScale=b.itemProperties.layerDefinition.minScale),a.isDefined(b.layerDefinition.maxScale)||(b.layerDefinition.maxScale=b.itemProperties.layerDefinition.maxScale)):
b.layerDefinition=b.itemProperties.layerDefinition);!b.itemProperties.popupInfo||b.popupInfo||b.disablePopup||(b.popupInfo=b.itemProperties.popupInfo);a.isDefined(b.itemProperties.showLabels)&&!a.isDefined(b.showLabels)&&(b.showLabels=b.itemProperties.showLabels);a.isDefined(b.itemProperties.showLegend)&&!a.isDefined(b.showLegend)&&(b.showLegend=b.itemProperties.showLegend);a.isDefined(b.itemProperties.refreshInterval)&&!a.isDefined(b.refreshInterval)&&(b.refreshInterval=b.itemProperties.refreshInterval)}
function ha(b){ga(b);b.itemProperties.layerDefinition&&b.layerDefinition&&(!a.isDefined(b.layerDefinition.maximumTrackPoints)&&a.isDefined(b.itemProperties.layerDefinition.maximumTrackPoints)&&(b.layerDefinition.maximumTrackPoints=b.itemProperties.layerDefinition.maximumTrackPoints),!b.layerDefinition.definitionGeometry&&b.itemProperties.layerDefinition.definitionGeometry&&(b.layerDefinition.definitionGeometry=b.itemProperties.layerDefinition.definitionGeometry));b.itemProperties.purgeOptions&&!b.purgeOptions&&
(b.purgeOptions=b.itemProperties.purgeOptions)}function ba(b,c){var d=new q;c=b.itemData;var f=[],g=[];e.forEach(c.operationalLayers,function(b){if(b.itemId&&!b.type){var c=b.url.toLowerCase();-1<c.indexOf("/featureserver")||-1<c.indexOf("/mapserver/")?(g.push(b),f.push(U(b))):-1<c.indexOf("/mapserver")&&-1===c.indexOf("/mapserver/")&&(!b.layers||!a.isDefined(b.minScale)&&!a.isDefined(b.maxScale))?(g.push(b),f.push(U(b))):-1<c.indexOf("/imageserver")&&!a.isDefined(b.minScale)&&!a.isDefined(b.maxScale)?
(g.push(b),f.push(U(b))):-1<c.indexOf("/streamserver")&&(g.push(b),f.push(U(b)))}});c.baseMap&&c.baseMap.baseMapLayers&&e.forEach(c.baseMap.baseMapLayers,function(a){a.itemId&&"VectorTileLayer"!==a.layerType&&(g.push(a),f.push(U(a)))});if(0<f.length){var h={};(new v(f)).addCallback(function(c){e.forEach(g,function(b,d){if((d=c[d][1])&&!(d instanceof Error)&&(h[b.itemId]=d,!b.type)){var f=b.url.toLowerCase();(-1<f.indexOf("/featureserver")||-1<f.indexOf("/mapserver/"))&&d.layers?e.forEach(d.layers,
function(a){var c="/featureserver/"+a.id;(c=f.match(c+"$")==c)||(c="/mapserver/"+a.id,c=f.match(c+"$")==c);c&&(b.itemProperties=a,ga(b))}):-1<f.indexOf("/streamserver")?(b.itemProperties=d,ha(b)):-1<f.indexOf("/mapserver")?(d.layers&&!b.layers&&(b.layers=d.layers),a.isDefined(d.minScale)&&!a.isDefined(b.minScale)&&(b.minScale=d.minScale),a.isDefined(d.maxScale)&&!a.isDefined(b.maxScale)&&(b.maxScale=d.maxScale),a.isDefined(d.refreshInterval)&&!a.isDefined(b.refreshInterval)&&(b.refreshInterval=d.refreshInterval),
d.visibleLayers&&!b.visibleLayers&&(b.visibleLayers=d.visibleLayers)):-1<f.indexOf("/imageserver")&&(a.isDefined(d.minScale)&&!a.isDefined(b.minScale)&&(b.minScale=d.minScale),a.isDefined(d.maxScale)&&!a.isDefined(b.maxScale)&&(b.maxScale=d.maxScale),a.isDefined(d.refreshInterval)&&!a.isDefined(b.refreshInterval)&&(b.refreshInterval=d.refreshInterval),!d.popupInfo||b.popupInfo||b.disablePopup||(b.popupInfo=d.popupInfo),d.renderingRule&&!b.renderingRule&&(b.renderingRule=d.renderingRule,d.renderingRule.functionName&&
(b.renderingRule.rasterFunction=d.renderingRule.functionName)),d.bandIds&&!b.bandIds&&(b.bandIds=d.bandIds),d.mosaicRule&&!b.mosaicRule&&(b.mosaicRule=d.mosaicRule),d.format&&!b.format&&(b.format=d.format),a.isDefined(d.compressionQuality)&&!a.isDefined(b.compressionQuality)&&(b.compressionQuality=d.compressionQuality),!d.layerDefinition||!d.layerDefinition.definitionExpression||a.isDefined(b.layerDefinition)&&a.isDefined(b.layerDefinition.definitionExpression)||(b.layerDefinition=b.layerDefinition||
{},b.layerDefinition.definitionExpression=d.layerDefinition.definitionExpression))}});b.relatedItemsData=h;d.callback(b)})}else d.callback(b);return d}function L(a,b){var c=new q,d=a.itemData,e=d.baseMap.baseMapLayers[0];if("BingMapsAerial"===e.type||"BingMapsRoad"===e.type||"BingMapsHybrid"===e.type)if(e.portalUrl&&f.id)delete b.bingMapsKey,f.id.checkSignInStatus(B.urlToObject(M.arcgisUrl).path).then(l.hitch(null,function(a,b,c,d,f){X(e.portalUrl,f.token).then(l.hitch(null,P,a,b,c,d),l.hitch(null,
V,a,b,c,d))},a,b,d,c),l.hitch(null,function(a,b,c,d,f){X(e.portalUrl).then(l.hitch(null,P,a,b,c,d),l.hitch(null,V,a,b,c,d))},a,b,d,c));else if(b.bingMapsKey){var g=new W({bingMapsKey:b.bingMapsKey,mapStyle:W.MAP_STYLE_AERIAL});r.connect(g,"onLoad",l.hitch(this,function(){c.callback([a,b])}));r.connect(g,"onError",function(f){delete b.bingMapsKey;a.itemData=R(d);e=a.itemData.baseMap.baseMapLayers[0];e.errors=[];e.errors.push({message:"The owner of the application has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});
c.callback([a,b])})}else a.itemData=R(d),e=a.itemData.baseMap.baseMapLayers[0],e.errors=[],e.errors.push({message:"The owner of the application has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),c.callback([a,b]);else c.callback([a,b]);return c}function Q(a){var b=new q,c,d;a=a.itemData;var e=a.baseMap&&a.baseMap.baseMapLayers;if(wa&&!wa.supported())for(a=0;a<e.length;a++){var f=e[a];if(!f.isReference){"VectorTileLayer"===f.layerType&&(c=f.itemId,d=a);break}}c?
za(c,!1).addBoth(function(a){var c=/^https?:\/\/basemaps(dev)?\.arcgis\.com\/arcgis\/rest\/services\/World_Basemap\/VectorTileServer/i;a&&a.item&&c.test(a.item.url)&&(e[d]={id:"FB_"+f.id,layerType:"ArcGISTiledMapServiceLayer",opacity:"opacity"in f?f.opacity:1,visibility:"visibility"in f?f.visibility:!0,url:"https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer"});b.resolve()}):b.resolve();return b}function P(a,b,c,d,e){e.bingKey?(b.bingMapsKey=e.bingKey,e=new W({bingMapsKey:b.bingMapsKey,
mapStyle:W.MAP_STYLE_AERIAL}),r.connect(e,"onLoad",l.hitch(this,function(){d.callback([a,b])})),r.connect(e,"onError",function(e){delete b.bingMapsKey;a.itemData=R(c);e=a.itemData.baseMap.baseMapLayers[0];e.errors=[];e.errors.push({message:"The owner of the map has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});d.callback([a,b])})):V(a,b,c,d)}function V(a,b,c,d){delete b.bingMapsKey;a.itemData=R(c);c=a.itemData.baseMap.baseMapLayers[0];c.errors=[];c.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."});
d.callback([a,b])}function R(a){a.baseMap="BingMapsAerial"===a.baseMap.baseMapLayers[0].type?{title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:"BingMapsRoad"===a.baseMap.baseMapLayers[0].type?{title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:{title:"Imagery with Labels",
baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};return a}function S(b,c,d,f){var g=b.dynamicLayerInfos||b.layerInfos,h=c.layers;if(h&&g)if(f.usePopupManager){var D;e.forEach(g,function(a){var b=a.id;if(!a.subLayerIds)for(a=
0;a<h.length;a++){var c=h[a];if(c.id===b&&c.popupInfo){D||(D={});D[b]={infoTemplate:new d(c.popupInfo),layerUrl:c.layerUrl};break}}});D&&b.setInfoTemplates(D)}else{var k=[],l=[],m=[],n=[],p=[],q=[];e.forEach(g,function(c){var d=c.id;if(!c.subLayerIds&&-1!==e.indexOf(b.visibleLayers,d))for(c=0;c<h.length;c++){var f=h[c];if(f.id===d){l.push(d);k.push(f.popupInfo);m.push(f.layerUrl||"");f.layerDefinition&&f.layerDefinition.definitionExpression?n.push(f.layerDefinition.definitionExpression):n.push("");
p.push(a.isDefined(f.minScale)?f.minScale:null);q.push(a.isDefined(f.maxScale)?f.maxScale:null);break}}});k.length&&(b.__popups=k,b.__popupIds=l,b.__popupUrls=m,b.__popupWhereClauses=n,b.__popupMinScales=p,b.__popupMaxScales=q,b.__resourceInfo=c.resourceInfo)}}function ca(a){if(!a)return!1;var b=(new u(M.arcgisUrl)).authority;return-1!==a.indexOf(".arcgis.com/")||-1!==a.indexOf(b)}function oa(a){return a?-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/"):!1}
function N(a){"https:"===location.protocol&&(ca(a)||oa(a))&&(a=a.replace("http:","https:"));return a}function ia(a,b,c){var d=[],f;a.displayLevels||(d=e.map(a.resourceInfo.tileInfo.lods,function(a){return a.level}));a.exclusionAreas&&(f=l.clone(a.exclusionAreas),f=e.map(f,function(a){a.geometry=new y(a.geometry);return a}));d=new aa(N(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,displayLevels:a.displayLevels||d,id:a.id,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval,
exclusionAreas:f});c.ignorePopups||S(d,a,b,c);return d}function Y(a,b){if(!a||!b||0===b.length)return[];b=","+b+",";var c=[],d,e=",";for(d=0;d<a.length;d++)if(null!==a[d].subLayerIds){if(-1===b.indexOf(","+a[d].id+",")||-1<e.indexOf(","+a[d].id+","))e+=a[d].subLayerIds.toString()+","}else-1<b.indexOf(","+a[d].id+",")&&-1===e.indexOf(","+a[d].id+",")&&c.push(a[d].id);return c}function ja(a,b,c){var d=new La;d.format="png24";a.resourceInfo&&a.resourceInfo.supportedImageFormatTypes&&-1<a.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")&&
(d.format="png32");var d=new Ja(N(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageParameters:d,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval}),f=a.visibleLayers;if(!a.visibleLayers){var g="";e.forEach(d.layerInfos,function(a){a.defaultVisibility&&(g+=(0<g.length?",":"")+a.id)});f=g}if(a.layers&&0<a.layers.length){var h=[],k=[],D,m=[],n,p;e.forEach(a.layers,function(b){var c=b.layerDefinition;c&&c.definitionExpression&&(h[b.id]=c.definitionExpression);
if(c&&c.source){D=null;p=c.source;if("mapLayer"===p.type){var d=e.filter(a.resourceInfo.layers,function(a){return a.id===p.mapLayerId});d.length&&(D=l.mixin(d[0],b))}else D=l.mixin({},b);D&&(D.source=p,delete D.popupInfo,D=new Ma(D),a.visibleLayers&&(d="string"==typeof a.visibleLayers?a.visibleLayers.split(","):a.visibleLayers,-1<e.indexOf(d,b.id)?D.defaultVisibility=!0:D.defaultVisibility=!1),k.push(D))}c&&null!=c.transparency&&(d=c.drawingInfo||{},null==d.transparency&&(d.transparency=c.transparency,
c.drawingInfo=d));c&&c.source&&c.drawingInfo&&(n=new Na(c.drawingInfo),m[b.id]=n)},this);0<h.length&&d.setLayerDefinitions(h);0<k.length?(d.setDynamicLayerInfos(k,!0),0<m.length&&d.setLayerDrawingOptions(m,!0)):(f=Y(d.layerInfos,f),d.setVisibleLayers(f))}else f=Y(d.layerInfos,f),d.setVisibleLayers(f);c.ignorePopups||S(d,a,b,c);return d}function xa(b,c,d){var e=new Oa;e.bandIds=b.bandIds;null!=b.format&&(e.format=b.format,null!=b.compressionQuality&&(e.compressionQuality=b.compressionQuality));if(b.renderingRule&&
b.renderingRule.rasterFunction){var f=new Pa(b.renderingRule);e.renderingRule=f}b.mosaicRule&&(f=new Qa(b.mosaicRule),e.mosaicRule=f);a.isDefined(b.noData)&&(e.noData=b.noData);a.isDefined(b.noDataInterpretation)&&(e.noDataInterpretation=b.noDataInterpretation);a.isDefined(b.interpolation)&&(e.interpolation=b.interpolation);f=b.layerType?"ArcGISImageServiceVectorLayer"===b.layerType:!1;a.isDefined(b.layerType)||(f=b.resourceInfo.hasMultidimensions&&("esriImageServiceDataTypeVector-UV"===b.resourceInfo.serviceDataType||
"esriImageServiceDataTypeVector-MagDir"===b.resourceInfo.serviceDataType));e={resourceInfo:b.resourceInfo,opacity:b.opacity,visible:b.visibility,id:b.id,imageServiceParameters:e,minScale:b.minScale,maxScale:b.maxScale,refreshInterval:b.refreshInterval};e=f?new Ra(N(b.url),e):new Sa(N(b.url),e);b.layerDefinition&&(b.layerDefinition.drawingInfo&&b.layerDefinition.drawingInfo.renderer&&(f=C.fromJson(b.layerDefinition.drawingInfo.renderer),e.setRenderer(f)),b.layerDefinition.definitionExpression&&e.setDefinitionExpression(b.layerDefinition.definitionExpression,
!0));!d.ignorePopups&&b.popupInfo&&e.setInfoTemplate(new c(b.popupInfo));return e}function ka(b,c,d){var f=[102113,102100,3857],g=d||new n(c[0].layerObject.fullExtent.spatialReference),h=new n(b.resourceInfo.fullExtent.spatialReference);return g.wkt==h.wkt&&(g.wkid==h.wkid||a.isDefined(g.latestWkid)&&g.latestWkid==h.wkid||a.isDefined(h.latestWkid)&&g.wkid==h.latestWkid||a.isDefined(g.latestWkid)&&g.latestWkid==h.latestWkid)||g.wkid&&h.wkid&&e.some(f,function(a){return a===h.wkid})&&e.some(f,function(a){return a===
g.wkid})?!0:!1}function da(a,b,c){if(!b[0].layerObject.tileInfo)return!1;a=a.resourceInfo.tileInfo;b=b[0].layerObject.tileInfo;c=c.width>c.height?c.width:c.height;for(var d=!1,e=!1,f=0;f<a.lods.length;f++){for(var g=a.lods[f].scale/a.dpi,h=0;h<b.lods.length;h++){var k=b.lods[h].scale/b.dpi;if(Math.abs(k-g)/k<1/c)if(d){e=!0;break}else d=!0}if(e)break}return e||d&&(1===a.lods.length||1===b.lods.length)?!0:!1}function la(c,h,k,m,q,t){var D,u,T=k._clazz;if("OpenStreetMap"===c.type)D=new Ta({id:c.id,opacity:c.opacity,
visible:null!==c.visibility&&void 0!==c.visibility?c.visibility:!0});else if("WFS"===c.type)m={customParameters:c.wfsInfo.customParameters,geometryType:c.layerDefinition.geometryType,id:c.id,labelingInfo:c.layerDefinition.drawingInfo.labelingInfo,maxFeatures:c.wfsInfo.maxFeatures,mode:c.mode,name:c.wfsInfo.name,showLabels:!0,swapXY:c.wfsInfo.swapXY,title:c.title,url:c.url,version:c.wfsInfo.version,visible:c.visibility,wkid:c.layerDefinition.spatialReference.wkid},D=new Ua,D.fromJson(m,function(){a.isDefined(c.opacity)&&
D.setOpacity(c.opacity);a.isDefined(c.visibility)&&D.setVisibility(c.visibility);(c.minScale||c.maxScale)&&D.setScaleRange(c.minScale,c.maxScale);D.renderer=C.fromJson(c.layerDefinition.drawingInfo.renderer);!k.ignorePopups&&c.popupInfo&&D.setInfoTemplate(new T(c.popupInfo));D.emit("fromJsonComplete")});else if("WMS"===c.type){var v=[],Ka=[];e.forEach(c.layers,function(a){Ka.push(new Va({name:a.name,title:a.title,legendURL:a.legendURL,queryable:a.queryable,showPopup:a.showPopup}));v.push(a.name)},
this);c.visibleLayers&&(v=c.visibleLayers);m=new y(c.extent[0][0],c.extent[0][1],c.extent[1][0],c.extent[1][1],new n({wkid:4326}));m={customLayerParameters:c.customLayerParameters,customParameters:c.customParameters,extent:m,layerInfos:Ka,version:c.version,maxWidth:c.maxWidth,maxHeight:c.maxHeight,featureInfoFormat:c.featureInfoFormat,getFeatureInfoURL:c.featureInfoUrl,getMapURL:c.mapUrl,spatialReferences:c.spatialReferences,title:c.title,copyright:c.copyright,minScale:c.minScale||0,maxScale:c.maxScale||
0,format:c.format};D=new Wa(c.url,{id:c.id,visibleLayers:v,format:"png",transparent:c.firstLayer?!1:!0,opacity:c.opacity,visible:null!==c.visibility?c.visibility:!0,resourceInfo:m,refreshInterval:c.refreshInterval});D.spatialReference.wkid=m.spatialReferences[0]}else if("KML"===c.type){u=c.url;if(f.id){var ea=f.id.findCredential(B.urlToObject(M.arcgisUrl).path);ea&&(h=M.arcgisUrl.substring(M.arcgisUrl.indexOf("//")+2,M.arcgisUrl.indexOf("/",M.arcgisUrl.indexOf("//")+3)),q=h.split("."),q=q[q.length-
2]+"."+q[q.length-1],t=u.indexOf(q),-1<t&&(u="https://"+h+u.substring(t+q.length),u+="?token\x3d"+ea.token))}D=new Xa(u,{id:c.id,visible:null!==c.visibility?c.visibility:!0,outSR:m,refreshInterval:c.refreshInterval});r.connect(D,"onLoad",function(){(c.opacity||0===c.opacity)&&D.setOpacity(c.opacity);a.isDefined(c.minScale)&&a.isDefined(c.maxScale)&&D.setScaleRange(c.minScale,c.maxScale);c.visibleFolders&&e.forEach(D.folders,function(a){-1<e.indexOf(c.visibleFolders,a.id)?D.setFolderVisibility(a,!0):
D.setFolderVisibility(a,!1)},this)})}else if("WebTiledLayer"===c.type){if(D=new Ya(c.templateUrl,{id:c.id,visible:null!==c.visibility?c.visibility:!0,opacity:c.opacity,copyright:c.copyright,fullExtent:c.fullExtent&&new y(c.fullExtent),initialExtent:c.fullExtent&&new y(c.fullExtent),subDomains:c.subDomains,tileInfo:c.tileInfo?new Za(c.tileInfo):null,refreshInterval:c.refreshInterval,wmtsInfo:c.wmtsInfo}),a.isDefined(c.minScale)||a.isDefined(c.maxScale))D.loaded?D.setScaleRange(c.minScale,c.maxScale):
r.connect(D,"onLoad",function(){D.setScaleRange(c.minScale,c.maxScale)})}else if("GeoRSS"===c.type)D=new $a(c.url,{id:c.id,opacity:c.opacity,outSpatialReference:m,refreshInterval:c.refreshInterval}),r.connect(D,"onLoad",function(){!1===c.visibility&&D.hide();a.isDefined(c.minScale)&&a.isDefined(c.maxScale)&&D.setScaleRange(c.minScale,c.maxScale);var b=D.getFeatureLayers();e.forEach(b,function(a){c.pointSymbol&&"esriGeometryPoint"===a.geometryType?(a.renderer.symbol=g.fromJson(c.pointSymbol),1===b.length&&
(D.pointSymbol=g.fromJson(c.pointSymbol))):c.lineSymbol&&"esriGeometryPolyline"===a.geometryType?(a.renderer.symbol=g.fromJson(c.lineSymbol),1===b.length&&(D.polylineSymbol=g.fromJson(c.lineSymbol))):c.polygonSymbol&&"esriGeometryPolygon"===a.geometryType&&(a.renderer.symbol=g.fromJson(c.polygonSymbol),1===b.length&&(D.polygonSymbol=g.fromJson(c.polygonSymbol)))})});else if("CSV"==c.type&&c.url)m={layerDefinition:c.layerDefinition,columnDelimiter:c.columnDelimiter,id:c.id?c.id:null,visible:null!==
c.visibility?c.visibility:!0,opacity:c.opacity,refreshInterval:c.refreshInterval},c.locationInfo&&(m.latitudeFieldName=c.locationInfo.latitudeFieldName,m.longitudeFieldName=c.locationInfo.longitudeFieldName),k.ignorePopups||(m.infoTemplate=new x(c.popupInfo?c.popupInfo:ab.generateDefaultPopupInfo(c))),D=new bb(c.url,m);else if("VectorTileLayer"===c.layerType&&c.styleUrl)D=new wa(c.styleUrl,{id:c.id,minScale:c.minScale,maxScale:c.maxScale,opacity:c.opacity,visible:c.visibility});else if(c.layerDefinition&&
!c.url)m=b.fromJson(b.toJson(c)),delete m.id,delete m.opacity,delete m.visibility,D=new I(m,{id:c.id,opacity:c.opacity,visible:c.visibility,outFields:["*"],autoGeneralize:!0}),!k.ignorePopups&&m.popupInfo&&D.setInfoTemplate(new T(m.popupInfo)),qa(D);else if("BingMapsAerial"===c.type||"BingMapsRoad"===c.type||"BingMapsHybrid"===c.type)k.bingMapsKey?(m=W.MAP_STYLE_AERIAL_WITH_LABELS,"BingMapsAerial"===c.type?m=W.MAP_STYLE_AERIAL:"BingMapsRoad"===c.type&&(m=W.MAP_STYLE_ROAD),D=new W({bingMapsKey:k.bingMapsKey,
mapStyle:m,opacity:c.opacity,id:c.id}),r.connect(D,"onError",l.hitch(this,function(a){a.errors=a.errors||[];a.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})},c))):(c.errors=c.errors||[],c.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+c.type+"]"}));else if(c.resourceInfo&&c.resourceInfo.mapName)D=!0===c.resourceInfo.singleFusedMapCache&&
(c.baseMapLayer||ka(c,h,m)&&da(c,q,t))?ia(c,T,k):ja(c,T,k);else if(c.resourceInfo&&c.resourceInfo.pixelSizeX)D=!0===c.resourceInfo.singleFusedMapCache&&(c.baseMapLayer||ka(c,h,m)&&da(c,q,t))?ia(c,T,k):xa(c,T,k);else if(c.resourceInfo&&"Feature Layer"===c.resourceInfo.type){c.capabilities&&(c.resourceInfo.capabilities=c.capabilities);var Aa;!1===k.editable?Aa=!1:k.privileges&&-1===e.indexOf(k.privileges,"features:user:edit")&&f.id&&f.id.findCredential(c.url)&&(Aa=!1);D=new I(N(c.url),{resourceInfo:c.resourceInfo,
opacity:c.opacity,visible:c.visibility,id:c.id,mode:c.mode===I.MODE_SELECTION?I.MODE_SELECTION:I.MODE_AUTO,editable:Aa,outFields:["*"],autoGeneralize:!0,refreshInterval:c.refreshInterval});!k.ignorePopups&&c.popupInfo&&D.setInfoTemplate(new T(c.popupInfo));c.layerDefinition&&(c.layerDefinition.drawingInfo&&c.layerDefinition.drawingInfo.renderer&&(m=C.fromJson(c.layerDefinition.drawingInfo.renderer),m.isMaxInclusive=!0,D.setRenderer(m)),c.layerDefinition.drawingInfo&&c.layerDefinition.drawingInfo.labelingInfo&&
(m=e.map(c.layerDefinition.drawingInfo.labelingInfo,function(a){return new cb(a)}),D.setLabelingInfo(m)),c.layerDefinition.definitionExpression&&D.setDefinitionExpression(c.layerDefinition.definitionExpression),a.isDefined(c.layerDefinition.minScale)&&D.setMinScale(c.layerDefinition.minScale),a.isDefined(c.layerDefinition.maxScale)&&D.setMaxScale(c.layerDefinition.maxScale));qa(D)}else c.resourceInfo&&c.resourceInfo.streamUrls&&(m={resourceInfo:c.resourceInfo,opacity:c.opacity,visible:c.visibility,
id:c.id},c.layerDefinition&&(ea=c.layerDefinition.drawingInfo,c.layerDefinition.definitionGeometry&&(u=u||{},u.geometry=c.layerDefinition.definitionGeometry),a.isDefined(c.layerDefinition.definitionExpression)&&(u=u||{},u.where=c.layerDefinition.definitionExpression),a.isDefined(c.layerDefinition.maximumTrackPoints)&&(m.maximumTrackPoints=c.layerDefinition.maximumTrackPoints)),u&&(m.filter=u),c.purgeOptions&&(m.purgeOptions=c.purgeOptions),D=new db(N(c.url),m),ea&&ea.renderer&&(m=ea.renderer,D.setRenderer(C.fromJson(m))),
!k.ignorePopups&&c.popupInfo&&D.setInfoTemplate(new T(c.popupInfo)),c.layerDefinition&&(a.isDefined(c.layerDefinition.minScale)&&D.setMinScale(c.layerDefinition.minScale),a.isDefined(c.layerDefinition.maxScale)&&D.setMaxScale(c.layerDefinition.maxScale)),p.once(D,"error",function(a){c.errors.push({message:"Error loading stream layer. Check websocket url"})}));D&&(D.arcgisProps={title:c.title},c.baseMapLayer&&(c.isReference?(D.attr("data-reference",!0),D._basemapGalleryLayerType="reference"):D._basemapGalleryLayerType=
"basemap"),D instanceof I&&c.layerDefinition&&c.layerDefinition.featureReduction&&"cluster"===c.layerDefinition.featureReduction.type&&(m=c.layerDefinition.featureReduction,m.clusterSize&&(m.clusterSize=d.pt2px(m.clusterSize)),m.clusterRadius&&(m.clusterRadius=d.pt2px(m.clusterRadius)),m.popupInfo&&(m.infoTemplate=new x(m.popupInfo),delete m.popupInfo),D.setFeatureReduction(m)));return D}function ma(a,b,c,d,f){e.forEach(a,function(e){e.layerObject=la(e,a,b,c,d,f)});var g=e.filter(a,function(a){return!a.isReference}),
h=e.filter(a,function(a){return!!a.isReference});return a=g.concat(h)}function na(a){var b=null;a=a[0];a.url&&!a.type?a.resourceInfo.spatialReference&&(b=new n,a.resourceInfo.spatialReference.wkid&&(b.wkid=a.resourceInfo.spatialReference.wkid),a.resourceInfo.spatialReference.wkt&&(b.wkt=a.resourceInfo.spatialReference.wkt)):a.type&&(-1<a.type.indexOf("BingMaps")||"OpenStreetMap"==a.type?b=new n({wkid:102100}):"WMS"==a.type&&(b=new n({wkid:a.spatialReferences[0]})));return b}function pa(a,b,c,d,f,
g,h,k){e.forEach(b,function(b){b.url&&!b.type&&(b.resourceInfo=a[b.deferredsPos][1],delete b.deferredsPos)});g=g||na(b);b=ma(b,c,g,h,k);f.callback(b);return f}function qa(a){!window.CanvasRenderingContext2D&&a.renderer&&"esri.renderer.HeatmapRenderer"===a.renderer.declaredClass&&a.setRenderer(C.fromJson({type:"simple",symbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}}}))}
function ra(a,b){var d=N(a);return c({url:d,content:{f:"json"},callbackParamName:"callback",error:function(a,c){a.message=a.message?a.message+(" [url:"+d+"]"):"[url:"+d+"]";b.push(a);z.defaults.io.errorHandler(a,c)}})}function G(a){var b=M.arcgisUrl+"/"+a.itemId+"/data";return c({url:b,content:{f:"json"},callbackParamName:"callback",error:function(c,d){c.message=c.message?c.message+(" [url:"+b+"]"):"[url:"+b+"]";a.errors=a.errors||[];a.errors.push(c);z.defaults.io.errorHandler(c,d)}})}function F(c,
d,f){var g=new q;if(!(f.featureCollection&&f.featureCollection.layers||f.layers))return console.log("Invalid Feature Collection item data [item id: "+c.itemId+"]: ",f),c.errors=c.errors||[],c.errors.push({message:"Invalid Feature Collection item data. [item id: "+c.itemId+"]"}),g.errback(),g;f.layers&&(f.featureCollection={layers:f.layers},delete f.layers,a.isDefined(f.showLegend)&&(f.featureCollection.showLegend=f.showLegend,delete f.showLegend));O(c,f.featureCollection,d).then(function(d){f.featureCollection=
d;c.featureCollection&&c.featureCollection.layers?e.forEach(f.featureCollection.layers,function(d,e){e=c.featureCollection.layers[e];e.popupInfo||e.layerDefinition?e.layerDefinition?(a.isDefined(e.layerDefinition.minScale)&&a.isDefined(e.layerDefinition.maxScale)&&(e.layerDefinition.minScale!==d.layerDefinition.minScale||e.layerDefinition.maxScale!==d.layerDefinition.maxScale)&&(delete d.layerDefinition.minScale,delete d.layerDefinition.maxScale),e.layerDefinition.drawingInfo&&b.toJson(e.layerDefinition.drawingInfo)!==
b.toJson(d.layerDefinition.drawingInfo)&&delete d.layerDefinition.drawingInfo,e.layerDefinition.showLegend!==d.layerDefinition.showLegend&&delete d.layerDefinition.showLegend,e.layerDefinition=l.mixin(e.layerDefinition,d.layerDefinition)):e.layerDefinition=d.layerDefinition:(e.popupInfo=d.popupInfo,e.layerDefinition=d.layerDefinition);e.featureSet=d.featureSet;e.nextObjectId=d.nextObjectId}):(c.featureCollection=c.featureCollection||{},c.featureCollection=l.mixin(c.featureCollection,f.featureCollection));
g.callback(c)});return g}function O(b,c,d){var f=new q;t(["./csv"],function(g){var h=[];e.forEach(c.layers,function(a){a.featureSet&&a.featureSet.features&&a.featureSet.features.length&&a.featureSet.features[0].geometry&&a.featureSet.features[0].geometry.spatialReference&&(a.deferredsPos=h.length,h.push(g.projectFeatureCollection(a,d,a.featureSet.features[0].geometry.spatialReference)))});(new v(h)).addCallback(function(){e.forEach(c.layers,function(c){a.isDefined(c.deferredsPos)&&(h[c.deferredsPos].results&&
h[c.deferredsPos].results.length?c=h[c.deferredsPos].results[0]:(console.log("Errors projecting feature collection. ["+b.title+" - "+c.layerDefinition.name+"]"),c.errors=c.errors||[],c.errors.push({message:"Errors projecting feature collection. ["+b.title+" - "+c.layerDefinition.name+"]"})),delete c.deferredsPos)});f.callback(c)})});return f}function sa(a,b,c,d,f){var g=new q,h=new q,k=[],m;e.forEach(a.operationalLayers,function(a){a.itemId&&"Feature Collection"==a.type&&k.push(G(a).then(l.hitch(null,
F,a,c)))});0===k.length?Ba(a,b,c,d,h,f):(m=new v(k),m.addCallback(function(e){Ba(a,b,c,d,h,f)}));h.then(function(a){k=[];e.forEach(a,function(a){var b;a=a.layerObject;a instanceof I&&!a.loaded&&!a.loadError?(b=new q,p.once(a,"load, error",function(){b.callback(a)}),k.push(b)):a&&"esri.layers.WFSLayer"===a.declaredClass&&!a.loadError&&(b=new q,p.once(a,"fromJsonComplete, error",function(c){b.callback(a)}),k.push(b))});if(k.length){var b=new q;m=new v(k);m.addCallback(function(){b.callback(a)});return b.promise}return a}).then(function(a){var b=
[];e.forEach(a,function(a){var c=a.layerObject;c instanceof I?c.loaded&&c.labelingInfo&&(a.showLabels||c._collection)&&b.push(c):c&&"esri.layers.WFSLayer"===c.declaredClass&&c.loaded&&c.labelingInfo&&b.push(c)});b.length?t(["../layers/LabelLayer"],function(c){var d=new c;e.forEach(b,function(a){d.addFeatureLayer(a)});a.push({layerObject:d});g.callback(a)}):g.callback(a)});return g}function Ba(a,b,c,d,f,g){var h=[],k=[],m=[];e.forEach(a.operationalLayers,function(a,b){if(a.featureCollection&&a.featureCollection.layers){var c=
a.featureCollection.layers.length;e.forEach(a.featureCollection.layers,function(d,f){var g=!0;a.visibleLayers&&-1==e.indexOf(a.visibleLayers,f)&&(g=!1);d.visibility=a.visibility&&g;d.opacity=a.opacity;d.id=(a.id||"operational"+b)+"_"+f;a.title&&(d.title=1!==c&&d.layerDefinition.name&&a.title!==d.layerDefinition.name?a.title+" - "+d.layerDefinition.name:a.title);m.push(d)},this)}else m.push(a)});e.forEach(a.baseMap.baseMapLayers,function(a,b){a.baseMapLayer=!0;a.id=a.id||"base"+b;h.push(a)});e.forEach(m,
function(a,b){a.id=a.id||"operational"+b;h.push(a)});e.forEach(h,function(a){a.url&&!a.type&&(a.deferredsPos=k.length,a.errors=a.errors||[],k.push(ra(a.url,a.errors)))});0===k.length?(c=c||na(h),h=ma(h,b,c,d,g),f.callback(h)):(new v(k)).addCallback(function(a){pa(a,h,b,k,f,c,d,g)});return f}function ta(a,b,c,d){var f=a.minScale,g=a.maxScale;if(10.1>=c.version&&b)for(a=b.length-1;0<=a;a--){if(b[a].id==d)if(0==f&&0<b[a].minScale?f=b[a].minScale:0<f&&0==b[a].minScale?f=c.minScale:0<f&&0<b[a].minScale&&
(f=Math.min(f,b[a].minScale)),g=Math.max(c.maxScale||0,b[a].maxScale||0),c.setScaleRange(f,g),-1<b[a].parentLayerId)d=b[a].parentLayerId;else break}else 10.1<c.version&&(e.forEach(a.layerInfos,function(a){a.id==d&&(0==f&&0<a.minScale?f=a.minScale:0<f&&0==a.minScale||0<f&&0<a.minScale&&(f=Math.min(f,a.minScale)),g=Math.max(g||0,a.maxScale||0))}),c.setScaleRange(f,g))}function ua(b,c,d,f){var g=b.url,h=b.__popupIds,k=b.__popupUrls,m=b.__popupWhereClauses,n=b.__popupMinScales,p=b.__popupMaxScales,q=
b.__resourceInfo,t=[];e.forEach(b.__popups,function(f,l){if(f){var u,D=[];e.forEach(f.fieldInfos,function(a){"shape"!==a.fieldName.toLowerCase()&&D.push(a.fieldName)});if(b.dynamicLayerInfos&&0<b.dynamicLayerInfos.length){var v=e.filter(b.dynamicLayerInfos,function(a){return h[l]==a.id})[0].source;u=new I(g+"/dynamicLayer",{id:b.id+"_"+h[l],source:v,outFields:D,mode:I.MODE_SELECTION,infoTemplate:f&&new d(f),drawMode:!1,visible:b.visible,autoGeneralize:!0});var T=function(d,e){0<m[d].length&&e.setDefinitionExpression(m[d]);
if(a.isDefined(n[d])||a.isDefined(p[d]))if(a.isDefined(b.minScale)||a.isDefined(b.maxScale)){var f=b.minScale,g=b.maxScale;0==f&&0<n[d]?f=n[d]:0<f&&0==n[d]||0<f&&0<n[d]&&(f=Math.min(f,n[d]));g=Math.max(g||0,p[d]||0);e.setScaleRange(f,g)}else e.setScaleRange(n[d],p[d]);else ta(b,c||q.layers,e,h[d])};u.loaded?T(l,u):r.connect(u,"onLoad",function(a){T(l,u)})}else{var w=null,x=g+"/"+h[l];if(k[l].length)x=k[l];else if(c)for(v=0;v<c.length;v++)if(c[v].id===h[l]){w=c[v];break}u=new I(N(x),{id:b.id+"_"+h[l],
outFields:D,mode:I.MODE_SELECTION,infoTemplate:f&&new d(f),drawMode:!1,visible:b.visible,resourceInfo:w,autoGeneralize:!0});u.loaded?(0<m[l].length&&u.setDefinitionExpression(m[l]),ta(b,c||q.layers,u,h[l])):r.connect(u,"onLoad",function(a){0<m[l].length&&u.setDefinitionExpression(m[l]);ta(b,c||q.layers,a,h[l])})}t.push(u)}});0<t.length&&(r.connect(b,"onVisibilityChange",l.hitch(this,function(a,b){e.forEach(a,function(a){b?a.show():a.hide()})},t)),r.connect(f,"onLayerRemove",l.hitch(this,function(a,
b,c){a.id===c.id&&e.forEach(b,function(a){f.removeLayer(a)})},b,t)));delete b.__popups;delete b.__popupIds;delete b.__popupUrls;delete b.__popupWhereClauses;delete b.__popupMinScales;delete b.__popupMaxScales;delete b.__resourceInfo;return t}function Ca(a){return c({url:N(a.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}})}function Da(a,b,c){var d=[];e.forEach(a,function(a){var b=a.__popups;b&&1<b.length&&10<=a.version&&(a.__deferredsPos=d.length,d.push(Ca(a)))});
var f=[];0<d.length?(new v(d)).addCallback(function(d){e.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(a.__deferredsPos||0===a.__deferredsPos?(f=f.concat(ua(a,d[a.__deferredsPos][1].layers,c,b)),delete a.__deferredsPos):f=f.concat(ua(a,null,c,b)))});b.addLayers(f)}):(e.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(f=f.concat(ua(a,null,c,b)))}),b.addLayers(f))}function Ea(a){e.forEach(a,function(a){var b=a.layer;b.toJson&&(a=b.toJson(),a.featureSet&&b.name&&-1<b.name.indexOf("Text")&&
e.forEach(a.featureSet.features,function(a,c){a.attributes.TEXT&&(c=b.graphics[c],c.symbol.setText(a.attributes.TEXT),a.symbol.horizontalAlignment&&(c.symbol.align=a.symbol.horizontalAlignment),c.setSymbol(c.symbol),c.setAttributes(a.attributes))},this))})}function Fa(a){var b=6;e.forEach(a,function(a){if(a=a.renderer)"esri.renderer.SimpleRenderer"===a.declaredClass?((a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset))),a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))):"esri.renderer.UniqueValueRenderer"!==
a.declaredClass&&"esri.renderer.ClassBreaksRenderer"!==a.declaredClass||e.forEach(a.infos,function(a){(a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset)));a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))})});return b}function ya(a){var b=this,c=b.infoWindow,d=a.graphic;if(b.loaded){c.hide();c.clearFeatures();var f=[];e.forEach(b.graphicsLayerIds,function(a){(a=b.getLayer(a))&&a instanceof I&&a.loaded&&a.visible&&(a.clearSelection(),a.infoTemplate&&!a.suspended&&f.push(a))});e.forEach(b.layerIds,
function(a){(a=b.getLayer(a))&&-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")&&a.loaded&&a.visible&&a.infoTemplate&&f.push(a)});d=d&&d.getInfoTemplate()?d:null;if(f.length||d){var g=Fa(f),h=a.screenPoint,k=b.toMap(new A(h.x-g,h.y+g)),g=b.toMap(new A(h.x+g,h.y-g)),l=new y(k.x,k.y,g.x,g.y,b.spatialReference),m=new H;m.geometry=l;m.timeExtent=b.timeExtent;var n=!0,k=e.map(f,function(b){b=b&&b.isFeatureReductionActive&&b.isFeatureReductionActive()?b.getFeatureReductionLayer():b;var c;if(-1!==
b.declaredClass.indexOf("ArcGISImageServiceLayer"))m.geometry=a.mapPoint,n=!1,c=b.queryVisibleRasters(m,{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),c.addCallback(function(){return b.getVisibleRasters()});else if("function"===typeof b.selectFeatures)c=b.selectFeatures(m),c.addCallback(function(){return b.getSelectedFeatures()});else{c=new q;var d=e.filter(b.graphics,function(a){return a&&a.visible&&l.intersects(a.geometry)});c.resolve(d)}return c});d&&(g=new q,g.callback([d]),
k.splice(0,0,g));if(!e.some(k,function(a){return-1===a.fired})){var p=d?1:0;e.forEach(f,function(a){p=-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?p+a.getVisibleRasters().length:p+a.getSelectedFeatures().length});if(!p)return}c.setFeatures(k);c.show(a.mapPoint,{closestFirst:n})}}}function eb(b,c){var d=c.mapOptions||{},e;d.infoWindow||(e=new J({visibleWhenEmpty:!1},m.create("div")),d.infoWindow=e);a.isDefined(d.showInfoWindowOnClick)||c.usePopupManager||(d.showInfoWindowOnClick=!1);b=new E(b,
d);r.connect(b,"onLayersAddResult",Ea);return b}function Z(a,b,c,d,f,g){var h,k,l,m;d.map?(h=d.map,k=d.clickEventHandle,l=d.clickEventListener,m=d.errors):(h=eb(d,f),f.ignorePopups||f.disableClickBehavior||f.usePopupManager||(k=r.connect(h,"onClick",ya),l=ya));h.addLayers(a);f.ignorePopups||f.usePopupManager||Da(a,h,f._clazz);var n=m||[];e.forEach(b,function(a){a.errors&&(n=n.concat(a.errors))},this);h.loaded?g.callback({map:h,itemInfo:c,errors:n,clickEventHandle:k,clickEventListener:l}):r.connect(h,
"onLoad",function(){g.callback({map:h,itemInfo:c,errors:n,clickEventHandle:k,clickEventListener:l})})}function va(a,b,c,d,f){var g=[];e.forEach(f,function(a){l.isArray(a.layerObject)?e.forEach(a.layerObject,function(a){g.push(a)}):g.push(a.layerObject)});if("BingMapsAerial"===f[0].type||"BingMapsRoad"===f[0].type||"BingMapsHybrid"===f[0].type)var h=setInterval(function(){if(f[0].layerObject&&f[0].layerObject.loaded)clearInterval(h),Ha(a,b,c,d,f,g);else if(f[0].errors){clearInterval(h);var e="";f[0].errors&&
f[0].errors.length&&(e=" ("+f[0].errors[0].message+")");d.errback(Error(fa.arcgis.utils.baseLayerError+e))}},10);else if(!g[0]&&f[0].baseMapLayer){var k="";f[0].errors&&f[0].errors.length&&(k=" ("+f[0].errors[0].message+")");d.errback(Error(fa.arcgis.utils.baseLayerError+k))}else Ha(a,b,c,d,f,g)}function Ha(b,c,d,f,g,k){try{var l=d.mapOptions||{};d.mapOptions=l;var m=b.item,p=b.itemData;!l.backgroundColor&&p.background&&p.background.color&&null!=p.background.color[0]&&(l.backgroundColor=h.toDojoColor(p.background.color));
k=e.filter(k,a.isDefined);if(m)if(m.extent&&m.extent.length)if(l.extent)Z(k,g,b,c,d,f);else{var q=new y(m.extent[0][0],m.extent[0][1],m.extent[1][0],m.extent[1][1],new n({wkid:4326})),r=k[0].spatialReference;4326===r.wkid?(l.extent=q,Z(k,g,b,c,d,f)):102100===r.wkid||102113===r.wkid||3857===r.wkid?(q.xmin=Math.max(q.xmin,-180),q.xmax=Math.min(q.xmax,180),q.ymin=Math.max(q.ymin,-89.99),q.ymax=Math.min(q.ymax,89.99),l.extent=w.geographicToWebMercator(q),Z(k,g,b,c,d,f)):d.geometryServiceURL||z.defaults.geometryService?
(d.geometryServiceURL?new K(d.geometryServiceURL):z.defaults.geometryService).project([q],r,function(a){a=a[0];l.extent=l.extent||a;Z(k,g,b,c,d,f)},function(){Z(k,g,b,c,d,f)}):f.errback(Error(fa.arcgis.utils.geometryServiceError))}else Z(k,g,b,c,d,f);else Z(k,g,b,c,d,f)}catch(hb){f.errback(hb)}}function gb(a){var b=[];e.forEach(a.operationalLayers,function(a){a.featureCollection?b.push({featureCollection:a.featureCollection,visibility:a.visibility,title:a.title}):a.layerObject&&b.push({layer:a.layerObject,
visibility:a.visibility,title:a.title})});return b}function Ga(a){var b=[],c=a.baseMap.baseMapLayers;a.operationalLayers&&(c=c.concat(a.operationalLayers));e.forEach(c,function(a){var c={};if(a.featureCollection&&"CSV"!==a.type)!0===a.featureCollection.showLegend&&e.forEach(a.featureCollection.layers,function(d){if(!1!==d.showLegend){var e=d.layerObject.renderer;c={layer:d.layerObject,title:a.title,defaultSymbol:e&&e.defaultSymbol&&e.defaultLabel?!0:!1};1<a.featureCollection.layers.length&&(c.title+=
" - "+d.layerDefinition.name);b.push(c)}});else if(a.baseMapLayer&&!0===a.showLegend&&a.layerObject||!a.baseMapLayer&&!1!==a.showLegend&&a.layerObject&&!(a.layerObject instanceof I&&a.layerObject.mode===I.MODE_SELECTION)){var d=a.layerObject.renderer,f=a.layerObject.declaredClass,d=!d||d&&d.defaultSymbol&&d.defaultLabel?!0:!1;if(10.1>a.layerObject.version&&("esri.layers.ArcGISDynamicMapServiceLayer"===f||"esri.layers.ArcGISTiledMapServiceLayer"===f)||"esri.layers.ArcGISImageServiceLayer"===f)d=!0;
c={layer:a.layerObject,title:a.title,defaultSymbol:d};a.layers&&(f=e.map(e.filter(a.layers,function(a){return!1===a.showLegend}),function(a){return a.id}),f.length&&(c.hideLayers=f));b.push(c)}});return b}function fb(a,b){function c(a,b){e.forEach(a,function(a,c){switch(a){case "../layers/ArcGISDynamicMapServiceLayer":Ja=b[c];break;case "../layers/ArcGISImageServiceLayer":Sa=b[c];break;case "../layers/ArcGISImageServiceVectorLayer":Ra=b[c];break;case "./csv":ab=b[c];break;case "../layers/CSVLayer":bb=
b[c];break;case "../layers/DynamicLayerInfo":Ma=b[c];break;case "../layers/GeoRSSLayer":$a=b[c];break;case "../layers/ImageParameters":La=b[c];break;case "../layers/ImageServiceParameters":Oa=b[c];break;case "../layers/KMLLayer":Xa=b[c];break;case "../layers/LabelClass":cb=b[c];break;case "../layers/LayerDrawingOptions":Na=b[c];break;case "../layers/MosaicRule":Qa=b[c];break;case "../layers/OpenStreetMapLayer":Ta=b[c];break;case "../layers/RasterFunction":Pa=b[c];break;case "../layers/StreamLayer":db=
b[c];break;case "../layers/TileInfo":Za=b[c];break;case "../layers/VectorTileLayer":wa=b[c];break;case "../virtualearth/VETiledLayer":W=b[c];break;case "../layers/WebTiledLayer":Ya=b[c];break;case "../layers/WFSLayer":Ua=b[c];break;case "../layers/WMSLayer":Wa=b[c];break;case "../layers/WMSLayerInfo":Va=b[c]}})}var d=new q;a=a.itemData;b=[];a.baseMap&&a.baseMap.baseMapLayers&&(b=b.concat(a.baseMap.baseMapLayers));a.operationalLayers&&(b=b.concat(a.operationalLayers));a=e.map(b,function(a){return a&&
a.layerType});var f=[],g=[];b=!1;for(var h=0;h<a.length;h++){switch(a[h]){case "ArcGISFeatureLayer":-1===e.indexOf(f,"../layers/LabelClass")&&f.push("../layers/LabelClass");break;case "ArcGISImageServiceLayer":case "ArcGISTiledImageServiceLayer":-1===e.indexOf(f,"../layers/ArcGISImageServiceLayer")&&(f.push("../layers/ArcGISImageServiceLayer"),g.push("../layers/ImageServiceParameters"),g.push("../layers/MosaicRule"),g.push("../layers/RasterFunction"));break;case "ArcGISImageServiceVectorLayer":-1===
e.indexOf(f,"../layers/ArcGISImageServiceVectorLayer")&&(f.push("../layers/ArcGISImageServiceVectorLayer"),g.push("../layers/ImageServiceParameters"),g.push("../layers/MosaicRule"),g.push("../layers/RasterFunction"));break;case "ArcGISMapServiceLayer":case "ArcGISTiledMapServiceLayer":-1===e.indexOf(f,"../layers/ArcGISDynamicMapServiceLayer")&&(f.push("../layers/ArcGISDynamicMapServiceLayer"),g.push("../layers/DynamicLayerInfo"),g.push("../layers/ImageParameters"),g.push("../layers/LayerDrawingOptions"));
break;case "ArcGISStreamLayer":-1===e.indexOf(f,"../layers/StreamLayer")&&f.push("../layers/StreamLayer");break;case "BingMapsAerial":case "BingMapsHybrid":case "BingMapsRoad":-1===e.indexOf(f,"../virtualearth/VETiledLayer")&&f.push("../virtualearth/VETiledLayer");break;case "CSV":-1===e.indexOf(f,"../layers/CSVLayer")&&(f.push("../layers/CSVLayer"),g.push("./csv"));break;case "GeoRSS":-1===e.indexOf(f,"../layers/GeoRSSLayer")&&f.push("../layers/GeoRSSLayer");break;case "KML":-1===e.indexOf(f,"../layers/KMLLayer")&&
f.push("../layers/KMLLayer");break;case "OpenStreetMap":-1===e.indexOf(f,"../layers/OpenStreetMapLayer")&&f.push("../layers/OpenStreetMapLayer");break;case "VectorTileLayer":-1===e.indexOf(f,"../layers/VectorTileLayer")&&f.push("../layers/VectorTileLayer");break;case "WebTiledLayer":-1===e.indexOf(f,"../layers/WebTiledLayer")&&(f.push("../layers/WebTiledLayer"),g.push("../layers/TileInfo"));break;case "WFS":-1===e.indexOf(f,"../layers/WFSLayer")&&f.push("../layers/WFSLayer");break;case "WMS":-1===
e.indexOf(f,"../layers/WMSLayer")&&(f.push("../layers/WMSLayer"),g.push("../layers/WMSLayerInfo"));break;default:b=!0}if(b)break}b&&(f=ib,g=jb);f.length?t(f,function(){c(f,arguments);g.length?t(g,function(){c(g,arguments);d.resolve()}):d.resolve()}):d.resolve();return d}function Ia(a,b,c,d){var f=d.itemData;f.baseMap&&f.baseMap.baseMapLayers&&f.baseMap.baseMapLayers.length&&(f.baseMap.baseMapLayers[0].firstLayer=!0);var g=b.layerMixins,h=g&&g.length;if(h){var k=function(a){for(var b=0;b<h;b++){var c=
g[b];if(c.mixin)if(c.hasOwnProperty("id")){if(a.id===c.id){l.mixin(a,c.mixin);break}}else if(a.url===c.url){l.mixin(a,c.mixin);break}}};e.forEach(f.baseMap&&f.baseMap.baseMapLayers,k);e.forEach(f.operationalLayers,k)}fb(d,b).then(function(){return Q(d,b)}).then(function(){return L(d,b)}).then(function(b){var d=b[0],f=b[1];if(d.itemData.operationalLayers&&0!==d.itemData.operationalLayers.length){var g=new q,h=d.itemData.baseMap.baseMapLayers.slice(),k=e.filter(d.itemData.baseMap.baseMapLayers,function(a){return!a.isReference});
b={item:d.item,itemData:{baseMap:{baseMapLayers:k}}};d.itemData.baseMap.baseMapLayers=e.filter(d.itemData.baseMap.baseMapLayers,function(a){return a.isReference});ba(b,f).addCallback(function(b){sa(b.itemData,f).addCallback(l.hitch(null,va,b,a,f,g))});g.then(function(a){ba(d,f).addCallback(function(b){sa(b.itemData,f,a.map.spatialReference,k,a.map).addCallback(function(d){b.itemData.baseMap.baseMapLayers=h;va(b,a,f,c,d)})})},l.hitch(c,c.errback))}else ba(d,f).addCallback(function(b){sa(b.itemData,
f).addCallback(l.hitch(null,va,b,a,f,c))})})}function za(a,b){"undefined"===typeof b&&(b=!0);M._arcgisUrl&&0<M._arcgisUrl.length&&(M.arcgisUrl=M._arcgisUrl);var d=M.arcgisUrl+"/"+a,e={},f=new q;c({url:d,content:{f:"json"},callbackParamName:"callback",load:function(a){e.item=a;b?c({url:d+"/data",content:{f:"json"},callbackParamName:"callback",load:function(a){e.itemData=a;f.callback(e)},error:function(a){f.errback(a)}}):f.callback(e)},error:function(a){f.errback(a)}});return f}var M,Ja,Sa,Ra,ab,bb,
Ma,$a,La,Oa,Xa,cb,Na,Qa,Ta,Pa,db,Za,wa,W,Ya,Ua,Wa,Va,ib="../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/ArcGISImageServiceVectorLayer ../layers/CSVLayer ../layers/GeoRSSLayer ../layers/KMLLayer ../layers/LabelClass ../layers/OpenStreetMapLayer ../layers/StreamLayer ../layers/VectorTileLayer ../virtualearth/VETiledLayer ../layers/WebTiledLayer ../layers/WFSLayer ../layers/WMSLayer".split(" "),jb="./csv ../layers/DynamicLayerInfo ../layers/ImageParameters ../layers/ImageServiceParameters ../layers/LayerDrawingOptions ../layers/MosaicRule ../layers/RasterFunction ../layers/TileInfo ../layers/WMSLayerInfo".split(" ");
M={arcgisUrl:B.getProtocolForWebResource()+"//www.arcgis.com/sharing/rest/content/items",getItem:za,createMap:function(a,b,c){var d=new q;c=c||{};var e=c.infoTemplateClass;c._clazz=e&&(l.isObject(e)?e:l.getObject(e))||x;l.isString(a)?za(a).addCallback(l.hitch(null,Ia,b,c,d)).addErrback(l.hitch(d,d.errback)):Ia(b,c,d,a);return d},getLayerList:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?gb(a.itemInfo.itemData):[]},getLegendLayers:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?Ga(a.itemInfo.itemData):
[]},_arcgisUrl:null,_getItemProps:ba,_getItemData:U,_getBingKey:X,_portalUrlResponse:P,_portalUrlFailure:V,_processFSItemProperties:ga,_processSSItemProperties:ha,_getLayers:sa,_preBuildLayerObjects:pa,_buildLayerObjects:ma,_preCreateMap:va,_getMapSR:na,_createMap:Z,_addSelectionLayers:Da,_createSelectionFeatureLayers:ua,_getServiceInfo:ra,_getFeatureCollectionItem:G,_mergeFeatureCollectionItem:F,_projectFeatureCollection:O,_getLayersInfo:Ca,_initLayer:la,_loadAsCached:ia,_loadAsDynamic:ja,_processPopups:S,
_onLayersAddResult:Ea,_sameSpatialReferenceAsBasemap:ka,_sameTilingSchemeAsBasemap:da,_showPopup:ya,_calculateClickTolerance:Fa,_getVisibleFeatureLayers:Y,_updateLayerScaleInfo:ta,_checkUrl:N,_isHostedService:ca,_isAgolService:oa,_getLegendLayers:Ga};l.setObject("arcgis.utils",M,f);return M});
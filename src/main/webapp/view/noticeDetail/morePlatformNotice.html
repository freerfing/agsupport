<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<title>通知公告</title>
	<link href="../../lib/3rdparty/jquery-easyui/themes/gray/easyui.css" rel="stylesheet" type="text/css"/>
	<link href="../../lib/3rdparty/jquery-easyui/themes/icon.css" rel="stylesheet" type="text/css"/>
	<link href="platformNotice/css/release.css" type="text/css" rel="stylesheet">
	<script src="../../lib/3rdparty/jquery-easyui/jquery.min.js" type="text/javascript"></script>
	<script src="../../lib/3rdparty/jquery-easyui/jquery.easyui.min.js" type="text/javascript"></script>
	<script src="../../lib/3rdparty/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
	<script src="../../lib/3rdparty/jquery-easyui/jquery.form.js" type="text/javascript"></script>
	<script type="text/javascript" src="../../lib/3rdparty/layer/layer.js"></script>
	<style>
		html, body {
			width: 100%;
			height: 100%;
			padding: 0;
			margin: 0;
			overflow: hidden;
		}

		textarea{
			overflow:hidden;
		}

		a {
			text-decoration: none;
			cursor: pointer;
		}

		a:hover {
			text-decoration: underline;
			color: #F60;
		}
	</style>
	<script type="text/javascript">
		function openNoticeDetailPage(value, row, index) {
			if(row.isTop === '1') {
				value = '<font style="color: #F60;">[置顶]&nbsp;' + value + '</font>';
			}

			return '<a href=noticeDetail.html?id=' + row.id + ' target="_blank">' + value + '</a>';
		};

		function getSenderUserName(value, row, index) {
			if(!row.sender) {
				return "";
			}

			return row.sender.userName;
		};

		function getSenderOrgNames(value, row, index) {
			var retOrgNames = '';
			for(var i=0; i<row.senderOrgs.length; i++) {
				if(i != 0) {
					retOrgNames += '、';
				}
				retOrgNames += row.senderOrgs[i].name;
			}

			return retOrgNames;
		};

		function getEmergencyLvlInfo(value, row, index) {
			var emergencyLvlAry = ['<font style="color: green;">低</font>', '<font style="color: #F60;">中</font>', '<font style="color: red;">高</font>'];
			return emergencyLvlAry[value] || '';
		};

		$(function() {
			$("#publishDg").datagrid({
				url : '/agsupport/platformNotice/list',
				method: 'post',
				queryParams: {
					isManagePage: false,
					loginName: top.loginName
				},
				pagination:true,
				loadMsg : '数据装载中......',
				rownumbers : false,// 行号
				singleSelect:true,
				pageSize: 20,
				nowrap:false,
				idField:'id',
				columns : [ [  {
					field:'title',
					title : '通知公告标题',
					width:'23%',
					align:'left',
					formatter: openNoticeDetailPage
				}, {
					field:'keyWord',
					title : '通知公告关键字',
					width:'14%',
					align:'center'
				}, {
					field:'emergencyLvl',
					title : '紧急程度',
					width:'10%',
					align:'center',
					formatter: getEmergencyLvlInfo
				}, {
					field:'userName',
					title : '创建者',
					width:'15%',
					align:'center',
					formatter: getSenderUserName
				}, {
					field:'orgNames',
					title : '创建者所在单位',
					width:'20%',
					align:'center',
					formatter: getSenderOrgNames
				}, {
					field :'noticeTime',
					title : '发布时间',
					width:'15%',
					align:'center'
				}, {
					field:'id',
					hidden:true
				}, {
					field:'searchText',
					hidden:true
				}, {
					field:'isTop',
					hidden:true
				}]],
				onClickRow: function(rowIndex, rowData){
					window.open('noticeDetail.html?id=' + rowData.id);
				}
			});
		});

		function search() {
			$('#publishDg').datagrid('load',{searchText: $("#searchTx").val(), loginName: top.loginName});
		}
	</script>
</head>
<body>
<div class="easyui-layout" style="width:100%;height:100%">
	<div data-options="region:'north',collapsible:false" style="height:50px">
		<div style="margin-top:8px;margin-left:20px">
			<input class="easyui-textbox" id="searchTx" data-options="onClickButton:search,buttonIcon:'icon-search',buttonAlign:'right',buttonText:'查询',prompt:'请输入要搜索的内容'"
				   style="width:400px;height:30px">
		</div>
	</div>
	<div data-options="region:'center',split:true" style="height:50px;">
		<table id="publishDg" class="easyui-datagrid" style="width:100%;height:100%" >
		</table>
	</div>
</div>
</body>
</html>

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>广州水务一体化平台</title>
    <link rel="stylesheet" href="../../lib/3rdparty/bootstrap/css/bootstrap.css" />
	<link href="../../lib/3rdparty/jquery-easyui/themes/gray/easyui.css" rel="stylesheet" type="text/css"/>
    <link href="../../lib/3rdparty/jquery-easyui/themes/icon.css" rel="stylesheet" type="text/css"/>
    <link href="css/chooseOrgs.css" rel="stylesheet" type="text/css"/>
    <script src="../../lib/3rdparty/jquery-easyui/jquery.min.js" type="text/javascript"></script>
	<script src="../../lib/3rdparty/jquery-easyui/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../../lib/3rdparty/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../lib/3rdparty/jquery-easyui/jquery.easyui.search.js" type="text/javascript"></script>
</head>
<body style="overflow-y: hidden;">
<div class="choose-orgs-container">
	<div class="orgs-search">
		<label>机构名:</label>
		<input type="text" name="searchText" placeholder="请输入机构名" />
		<button class="btn btn-primary btn-sm" onclick="searchOrgs();">查询</button>
	</div>
	<div class="orgs">
		<div class="orgs-title">选择机构</div>
		<ul id="org-tree">

		</ul>
	</div>
	<div class="choose-btns">
		<ul class="btns-ul">
			<li><button class="btn btn-primary btn-sm" onclick="addOrgs();">选择&gt;&gt;</button></li>
			<li><button class="btn btn-primary btn-sm" onclick="addAllOrgs();">全选&gt;&gt;</button></li>
			<li><button class="btn btn-primary btn-sm" onclick="removeOrgs();">删除&lt;&lt;</button></li>
			<li><button class="btn btn-primary btn-sm" onclick="removeAllOrgs();">全删&lt;&lt;</button></li>
		</ul>
	</div>
	<div class="selectedOrgs">
		<div class="orgs-title">已选列表</div>
		<ul id="orgs-ul">

		</ul>
	</div>
</div>

<script>
	$(function() {
		$('#org-tree').tree({
			animate: true,
			checkbox: true,
			method: 'GET',
			lines: true,
			url: "/agsupport/swuser/tree/all",
			formatter: function (node) {
				return node.text;
			},
			onBeforeExpand: function (node) {
				//$("#org_tree").tree("options").url = "http://127.0.0.1/agsupport/swuser/tree/" + node.id; //查找该节点子节点
			},
			onClick: function (node) {
			},
			onCheck: function(node){

			}
		});

	});

	function addOrgs() {
		var ulHtmlContent = '';
		var nodes = $('#org-tree').tree('getChecked');
		for (var i = 0; i < nodes.length; i++) {
			if ($('#org-tree').tree('isLeaf', nodes[i].target)) {
				ulHtmlContent += '<li id="' + nodes[i].id + '" onclick="toggleOrg(\'' + nodes[i].id + '\');">' + nodes[i].text + '</li>'
			}
		}
		$("#orgs-ul").html(ulHtmlContent);
	}

	function addAllOrgs() {
		var roots = $('#org-tree').tree('getRoots');
		for (var i = 0; i < roots.length; i++) {
			$('#org-tree').tree('check', roots[i].target);
		}

		var ulHtmlContent = '';
		var nodes = $('#org-tree').tree('getChecked');
		for (var i = 0; i < nodes.length; i++) {
			if ($('#org-tree').tree('isLeaf', nodes[i].target)) {
				ulHtmlContent += '<li id="' + nodes[i].id + '" onclick="toggleOrg(\'' + nodes[i].id + '\');">' + nodes[i].text + '</li>'
			}
		}
		$("#orgs-ul").html(ulHtmlContent);
	}

	function removeOrgs() {
		var nodes = $('#org-tree').tree('getChecked');

		$('#orgs-ul li.org-selected').each(function(index, item) {
			for (var i = 0; i < nodes.length; i++) {
				if ($('#org-tree').tree('isLeaf', nodes[i].target) && $(item).attr('id') === nodes[i].id) {
					$('#org-tree').tree('uncheck', nodes[i].target);
				}
			}
		});

		$('#orgs-ul li.org-selected').remove();
	}

	function removeAllOrgs() {
		var roots = $('#org-tree').tree('getRoots');

		for (var i = 0; i < roots.length; i++) {
			$('#org-tree').tree('uncheck', roots[i].target);
		}

		$('#orgs-ul li').remove();
	}

	function toggleOrg(id) {
		if($('#' + id).hasClass('org-selected')) {
			$('#' + id).removeClass('org-selected');
		} else {
			$('#' + id).addClass('org-selected');
		}
	}

	function callbackdata() {
		var result = {orgIds: '', orgNames: ''};

		var isFirstTime = true;
		$('#orgs-ul li').each(function(index, item) {
			if(!isFirstTime) {
				result.orgIds += ',';
				result.orgNames += ',';
			} else {
				isFirstTime = false;
			}

			result.orgIds += $(item).attr('id');
			result.orgNames += $(item).text();
		});

		return result;
	}

	function searchOrgs() {
		$('#org-tree').tree("search", $('input[name="searchText"]').val());
	}
</script>
</body>
</html>
